/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
function Equation(f){this.editor=f;var d=f.config;var g=this;d.registerButton({id:"equation",tooltip:this._lc("Formula Editor"),image:f.imgURL("equation.gif","Equation"),textMode:false,action:function(b,a){g.buttonPress(b,a)}});d.addToolbarElement("equation","inserthorizontalrule",-1);mathcolor=d.Equation.mathcolor;mathfontfamily=d.Equation.mathfontfamily;this.enabled=!Xinha.is_ie;if(this.enabled){this.onBeforeSubmit=this.onBeforeUnload=function(){g.unParse()}}if(typeof AMprocessNode!="function"){Xinha._loadback(Xinha.getPluginDir("Equation")+"/ASCIIMathML.js",function(){translate()})}}Xinha.Config.prototype.Equation={mathcolor:"black",mathfontfamily:"serif"};Equation._pluginInfo={name:"ASCIIMathML Formula Editor",version:"2.3 (2008-01-26)",developer:"Raimund Meyer",developer_url:"http://x-webservice.net",c_owner:"",sponsor:"",sponsor_url:"",license:"GNU/LGPL"};Equation.prototype._lc=function(b){return Xinha._lc(b,"Equation")};Equation.prototype.onGenerate=function(){this.parse()};Equation.prototype.onKeyPress=function(c){if(this.enabled){e=this.editor;var d=e._getFirstAncestor(e.getSelection(),["span"]);if(d&&d.className=="AM"){if(c.keyCode==8||c.keyCode==46||c.charCode){Xinha._stopEvent(c);return true}}}return false};Equation.prototype.onBeforeMode=function(b){if(this.enabled&&b=="textmode"){this.unParse()}};Equation.prototype.onMode=function(b){if(this.enabled&&b=="wysiwyg"){this.parse()}};Equation.prototype.parse=function(){if(this.enabled){var m=this.editor._doc;var j=m.getElementsByTagName("span");for(var k=0;k<j.length;k++){var i=j[k];if(i.className!="AM"){continue}if(i.innerHTML.indexOf(this.editor.cc)!=-1){i.innerHTML=i.innerHTML.replace(this.editor.cc,"");i.parentNode.insertBefore(m.createTextNode(this.editor.cc),i)}i.title=i.innerHTML;var l=i.cloneNode(true);try{document.adoptNode(l)}catch(h){}AMprocessNode(l,false);try{m.adoptNode(l)}catch(h){}i.parentNode.replaceChild(l,i);l.parentNode.insertBefore(m.createTextNode(String.fromCharCode(32)),l);l.parentNode.insertBefore(m.createTextNode(String.fromCharCode(32)),l.nextSibling)}}};Equation.prototype.unParse=function(){var k=this.editor._doc;var i=k.getElementsByTagName("span");for(var j=0;j<i.length;j++){var h=i[j];if(h.className.indexOf("AM")==-1||h.getElementsByTagName("math").length==0){continue}var g="`"+h.getElementsByTagName("math")[0].getAttribute("title")+"`";h.innerHTML=g;h.setAttribute("title",null)}};Equation.prototype.buttonPress=function(){var g=this;var h=this.editor;var f={};f.editor=h;var i=h._getFirstAncestor(h.getSelection(),["span"]);if(i){f.editedNode=i}Dialog(Xinha.getPluginDir("Equation")+"/popups/dialog.html",function(a){g.insert(a)},f)};Equation.prototype.insert=function(f){if(typeof f=="undefined"||f==null){return}if(typeof f.formula!="undefined"){var g=(f.formula!="")?f.formula.replace(/^`?(.*)`?$/m,"`$1`"):"";if(f.editedNode&&(f.editedNode.tagName.toLowerCase()=="span")){var d=f.editedNode;if(g!=""){d.innerHTML=g;if(this.enabled){d.title=g}}else{d.parentNode.removeChild(d)}}else{if(!f.editedNode&&g!=""){if(this.enabled){var d=document.createElement("span");d.className="AM";this.editor.insertNodeAtSelection(d);d.innerHTML=g;d.title=g}else{this.editor.insertHTML('<span class="AM">'+g+"</span>")}}}if(this.enabled){this.parse()}}};