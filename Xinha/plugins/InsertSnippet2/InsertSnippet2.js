/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
function InsertSnippet2(e){this.editor=e;var d=e.config;var f=this;d.registerButton({id:"InsertSnippet2",tooltip:this._lc("Insert Snippet"),image:e.imgURL("ed_snippet.gif","InsertSnippet2"),textMode:false,action:function(a){f.buttonPress(a)}});d.addToolbarElement("InsertSnippet2","insertimage",-1);this.snippets=null;this.categories=null;this.html=null;Xinha._getback(d.InsertSnippet2.snippets,function(q,c){var o=c.responseXML;var i=o.getElementsByTagName("c");f.categories=[];for(var p=0;p<i.length;p++){f.categories.push(i[p].getAttribute("n"))}var a=o.getElementsByTagName("s");f.snippets=[];var j,b;for(var p=0;p<a.length;p++){b={};for(var r=0;r<a[p].attributes.length;r++){b[a[p].attributes[r].nodeName]=a[p].attributes[r].nodeValue}b.html=a[p].text||a[p].textContent;f.snippets.push(b)}});Xinha.loadStyle("InsertSnippet.css","InsertSnippet2","IScss")}InsertSnippet2.prototype.onUpdateToolbar=function(){if(!this.snippets){this.editor._toolbarObjects.InsertSnippet2.state("enabled",false)}else{InsertSnippet2.prototype.onUpdateToolbar=null}};InsertSnippet2._pluginInfo={name:"InsertSnippet2",version:"1.2",developer:"Raimund Meyer",developer_url:"http://x-webservice.net",c_owner:"Raimund Meyer",sponsor:"",sponsor_url:"",license:"htmlArea"};Xinha.Config.prototype.InsertSnippet2={snippets:Xinha.getPluginDir("InsertSnippet2")+"/snippets.xml"};InsertSnippet2.prototype._lc=function(b){return Xinha._lc(b,"InsertSnippet2")};InsertSnippet2.prototype.onGenerateOnce=function(){this._prepareDialog()};InsertSnippet2.prototype._prepareDialog=function(){var g=this;if(!this.html){Xinha._getback(Xinha.getPluginDir("InsertSnippet2")+"/dialog.html",function(a){g.html=a;g._prepareDialog()});return}if(!this.snippets){setTimeout(function(){g._prepareDialog()},50);return}var h=this.editor;var k=this;this.dialog=new Xinha.Dialog(h,this.html,"InsertSnippet2",{width:800,height:400},{modal:true});Xinha._addClass(this.dialog.rootElem,"InsertSnippet2");var l=this.dialog;var j=this.dialog.main;var i=this.dialog.captionBar;this.snippetTable=l.getElementById("snippettable");this.drawCatTabs();this.drawSnippetTable();this.preparePreview();l.onresize=function(){g.resize()};this.dialog.getElementById("search").onkeyup=function(){g.search()};this.dialog.getElementById("wordbegin").onclick=function(){g.search()};this.dialog.getElementById("cancel").onclick=function(){g.dialog.hide()}};InsertSnippet2.prototype.drawSnippetTable=function(){if(!this.snippets.length){return}var A=this;var s=this.snippetTable;var y=this.snippets;while(s.hasChildNodes()){s.removeChild(s.lastChild)}var x,w,r,B,q,p,t,i,v;for(var u=0,z=0;u<y.length;u++){x=u;w=y[u]["n"];B=y[u]["c"];q=y[u]["v"];r=y[u]["html"];if(this.categoryFilter&&B!=this.categoryFilter&&this.categoryFilter!="all"){continue}p=s.insertRow(z);z++;i=0;t=p.insertCell(i);t.onmouseover=function(a){return A.preview(a||window.event)};t.onmouseout=function(){return A.preview()};t.appendChild(document.createTextNode(w));t.snID=x;t.id="cell"+x;i++;t=p.insertCell(i);t.style.whiteSpace="nowrap";v=document.createElement("button");v.snID=x;v._insAs="html";v.onclick=function(a){A.doInsert(a||window.event);return false};v.appendChild(document.createTextNode(this._lc("HTML")));v.title=this._lc("Insert as HTML");t.appendChild(v);if(q){t.appendChild(document.createTextNode(" "));var v=document.createElement("button");v.snID=x;v._insAs="variable";v.onclick=function(a){A.doInsert(a||window.event);return false};v.appendChild(document.createTextNode(this._lc("Variable")));v.title=this._lc("Insert as template variable");t.appendChild(v)}i++}};InsertSnippet2.prototype.drawCatTabs=function(){if(!this.categories.length){return}var i=this;var k=this.dialog.getElementById("cattabs");while(k.hasChildNodes()){k.removeChild(k.lastChild)}var j=1;var l=document.createElement("a");l.href="javascript:void(0);";l.appendChild(document.createTextNode(this._lc("All Categories")));l.cat="all";l.className="tab"+j;l.onclick=function(){i.categoryFilter=i.cat;i.drawCatTabs();i.drawSnippetTable();i.search()};if(!this.categoryFilter||this.categoryFilter=="all"){Xinha._addClass(l,"active");l.onclick=null}k.appendChild(l);j++;for(var g=0;g<this.categories.length;g++){var h=this.categories[g];var l=document.createElement("a");l.href="javascript:void(0);";l.appendChild(document.createTextNode(h));l.cat=h;l.className="tab"+j;l.onclick=function(){i.categoryFilter=this.cat;i.drawCatTabs();i.drawSnippetTable();i.search()};if(h==this.categoryFilter){Xinha._addClass(l,"active");l.onclick=null}k.appendChild(l);if(Xinha.is_gecko){k.appendChild(document.createTextNode(String.fromCharCode(8203)))}j=(j<16)?j+1:1}if(!this.catTabsH){this.catTabsH=k.offsetHeight}};InsertSnippet2.prototype.search=function(){var o=this.dialog.getElementById("snippettable");var i=this.dialog.getElementById("search");if(i.value){var p=i.value;p=p.replace(/\.?([*?+])/g,".$1");var q=(this.dialog.getElementById("wordbegin").checked)?"^":"";try{var e=new RegExp(q+p,"i")}catch(m){var e=null}}else{var e=null}for(var n=0;n<o.childNodes.length;n++){var l=o.childNodes[n];var r=l.firstChild.firstChild.data;if(e&&!r.match(e)){l.style.display="none"}else{l.style.display=""}}};InsertSnippet2.prototype.preview=function(d){if(!d){this.previewBody.innerHTML="";return}var e=d.target||d.srcElement;var f=e.snID;if(!this.previewBody){this.preparePreview();return}if(this.previewIframe.style.display=="none"){this.previewIframe.style.display="block"}this.previewBody.innerHTML=this.snippets[f].html};InsertSnippet2.prototype.preparePreview=function(){var k=this.editor;var l=this;var m=this.previewIframe=this.dialog.getElementById("preview_iframe");var n=null;try{if(m.contentDocument){n=m.contentDocument}else{n=m.contentWindow.document}if(!n){if(Xinha.is_gecko){setTimeout(function(){l.preparePreview(snID)},50);return false}else{throw ("ERROR: IFRAME can't be initialized.")}}}catch(h){setTimeout(function(){l.preparePreview(snID)},50)}n.open("text/html","replace");var i="<html><head><title></title>";i+='<meta http-equiv="Content-Type" content="text/html; charset='+k.config.charSet+'">\n';i+='<style type="text/css">body {background-color:#fff} </style>';if(typeof k.config.baseHref!="undefined"&&k.config.baseHref!==null){i+='<base href="'+k.config.baseHref+'"/>\n'}if(k.config.pageStyle){i+='<style type="text/css">\n'+k.config.pageStyle+"\n</style>"}if(typeof k.config.pageStyleSheets!=="undefined"){for(var j=0;j<k.config.pageStyleSheets.length;j++){if(k.config.pageStyleSheets[j].length>0){i+='<link rel="stylesheet" type="text/css" href="'+k.config.pageStyleSheets[j]+'">'}}}i+="</head>\n";i+="<body>\n";i+="</body>\n";i+="</html>";n.write(i);n.close();setTimeout(function(){l.previewBody=n.getElementsByTagName("body")[0]},100)};InsertSnippet2.prototype.buttonPress=function(b){this.dialog.toggle()};InsertSnippet2.prototype.doInsert=function(g){var e=g.target||g.srcElement;var f=this.snippets[e.snID];this.dialog.hide();var h=this.editor.config.InsertSnippet2;if(e._insAs=="variable"){this.editor.insertHTML(f.v)}else{this.editor.insertHTML(f.html)}};InsertSnippet2.prototype.resize=function(){var h=this.dialog.getElementById("insert_div");var e=this.dialog.getElementById("preview_iframe");var f={h:this.dialog.height,w:this.dialog.width};var g=f.h-90;if(this.categories.length){g-=this.catTabsH}h.style.height=e.style.height=g+"px";return true};