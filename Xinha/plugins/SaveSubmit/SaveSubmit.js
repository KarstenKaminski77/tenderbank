/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
function SaveSubmit(e){this.editor=e;this.changed=false;var f=this;var d=e.config;this.textarea=this.editor._textArea;d.registerIcon("savesubmitchanged",Xinha.getPluginDir("SaveSubmit")+"/img/ed_save_red.gif");d.registerIcon("savesubmitunchanged",Xinha.getPluginDir("SaveSubmit")+"/img/ed_save_green.gif");d.registerButton({id:"savesubmit",tooltip:f._lc("Save"),image:d.iconList.savesubmitunchanged,textMode:false,action:function(){f.save()}});d.addToolbarElement("savesubmit","popupeditor",-1)}SaveSubmit.prototype._lc=function(b){return Xinha._lc(b,"SaveSubmit")};SaveSubmit._pluginInfo={name:"SaveSubmit",version:"1.0",developer:"Raimund Meyer",developer_url:"http://x-webservice.net",c_owner:"Raimund Meyer",sponsor:"",sponsor_url:"",license:"htmlArea"};SaveSubmit.prototype.onKeyPress=function(b){if(b.ctrlKey&&this.editor.getKey(b)=="s"){this.save(this.editor);Xinha._stopEvent(b);return true}else{if(!this.changed){if(this.getChanged()){this.setChanged()}return false}}};SaveSubmit.prototype.onExecCommand=function(b){if(this.changed&&b=="undo"){if(this.initial_html==this.editor.getInnerHTML()){this.setUnChanged()}return false}};SaveSubmit.prototype.onUpdateToolbar=function(){if(!this.initial_html){this.initial_html=this.editor.getInnerHTML()}if(!this.changed){if(this.getChanged()){this.setChanged()}return false}};SaveSubmit.prototype.getChanged=function(){if(this.initial_html===null){this.initial_html=this.editor.getInnerHTML()}if(this.initial_html!=this.editor.getInnerHTML()&&this.changed==false){this.changed=true;return true}else{return false}};SaveSubmit.prototype.setChanged=function(){this.editor._toolbarObjects.savesubmit.swapImage(this.editor.config.iconList.savesubmitchanged);this.editor.updateToolbar()};SaveSubmit.prototype.setUnChanged=function(){this.changed=false;this.editor._toolbarObjects.savesubmit.swapImage(this.editor.config.iconList.savesubmitunchanged)};SaveSubmit.prototype.changedReset=function(){this.initial_html=null;this.setUnChanged()};SaveSubmit.prototype.save=function(){this.buildMessage();var n=this.editor;var o=this;var i=n._textArea.form;i.onsubmit();var l,p,j="";for(var k=0;k<i.elements.length;k++){if((i.elements[k].type=="checkbox"||i.elements[k].type=="radio")&&!i.elements[k].checked){continue}j+=((k>0)?"&":"")+i.elements[k].name+"="+encodeURIComponent(i.elements[k].value)}var m=n._textArea.form.action||window.location.href;Xinha._postback(m,j,function(a){if(a){o.setMessage(a);o.changedReset()}removeMessage=function(){o.removeMessage()};window.setTimeout("removeMessage()",1000)})};SaveSubmit.prototype.setMessage=function(f){var e=this.textarea;if(!document.getElementById("message_sub_"+e.id)){return}var d=document.getElementById("message_sub_"+e.id);d.innerHTML=Xinha._lc(f,"SaveSubmit")};SaveSubmit.prototype.removeMessage=function(){var b=this.textarea;if(!document.getElementById("message_"+b.id)){return}document.body.removeChild(document.getElementById("message_"+b.id))};SaveSubmit.prototype.buildMessage=function(){var f=this.textarea;var j=this.editor._htmlArea;var i=document.createElement("div");i.id="message_"+f.id;i.className="loading";i.style.width=j.offsetWidth+"px";i.style.left=Xinha.findPosX(j)+"px";i.style.top=(Xinha.findPosY(j)+parseInt(j.offsetHeight)/2)-50+"px";var h=document.createElement("div");h.className="loading_main";h.id="loading_main_"+f.id;h.appendChild(document.createTextNode(this._lc("Saving...")));var g=document.createElement("div");g.className="loading_sub";g.id="message_sub_"+f.id;g.appendChild(document.createTextNode(this._lc("in progress")));i.appendChild(h);i.appendChild(g);document.body.appendChild(i)};