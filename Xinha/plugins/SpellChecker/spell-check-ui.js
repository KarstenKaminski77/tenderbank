/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
var SpellChecker=window.opener.SpellChecker;var Xinha=window.opener.Xinha;var _editor_url=window.opener._editor_url;var is_ie=Xinha.is_ie;var editor=SpellChecker.editor;var frame=null;var currentElement=null;var wrongWords=null;var modified=false;var allWords={};var fixedWords=[];var suggested_words={};var to_p_dict=[];var to_r_list=[];function _lc(b){return Xinha._lc(b,"SpellChecker")}function makeCleanDoc(e){var f=wrongWords.concat(fixedWords);for(var h=f.length;--h>=0;){var g=f[h];if(!(e&&/HA-spellcheck-fixed/.test(g.className))){if(g.firstChild){g.parentNode.insertBefore(g.firstChild,g)}g.parentNode.removeChild(g)}else{g.className="HA-spellcheck-fixed"}}return Xinha.getHTML(frame.contentWindow.document.body,true,editor)}function recheckClicked(){document.getElementById("status").innerHTML=_lc("Please wait: changing dictionary to")+': "'+document.getElementById("f_dictionary").value+'".';var b=document.getElementById("f_content");b.value=makeCleanDoc(true);b.form.submit()}function saveClicked(){if(modified){editor.setHTML(makeCleanDoc(false))}if(to_p_dict.length||to_r_list.length&&editor.config.SpellChecker.backend=="php"){var c={};for(var d=0;d<to_p_dict.length;d++){c["to_p_dict["+d+"]"]=to_p_dict[d]}for(var d=0;d<to_r_list.length;d++){c["to_r_list["+d+"][0]"]=to_r_list[d][0];c["to_r_list["+d+"][1]"]=to_r_list[d][1]}window.opener.Xinha._postback(Xinha.getPluginDir("SpellChecker")+"/spell-check-savedicts.php",c);window.close()}else{window.close()}return false}function cancelClicked(){var b=true;if(modified){b=confirm(_lc("This will drop changes and quit spell checker.  Please confirm."))}if(b){window.close()}return false}function replaceWord(f){var d=document.getElementById("v_replacement").value;var e=(f.innerHTML!=d);if(e){modified=true}if(f){f.className=f.className.replace(/\s*HA-spellcheck-(hover|fixed)\s*/g," ")}f.className+=" HA-spellcheck-fixed";f.__msh_fixed=true;if(!e){return false}to_r_list.push([f.innerHTML,d]);f.innerHTML=d}function replaceClicked(){replaceWord(currentElement);var c=currentElement.__msh_id;var d=c;do{++d;if(d==wrongWords.length){d=0}}while((d!=c)&&wrongWords[d].__msh_fixed);if(d==c){d=0;alert(_lc("Finished list of mispelled words"))}wrongWords[d].__msh_wordClicked(true);return false}function revertClicked(){document.getElementById("v_replacement").value=currentElement.__msh_origWord;replaceWord(currentElement);currentElement.className="HA-spellcheck-error HA-spellcheck-current";return false}function replaceAllClicked(){var e=document.getElementById("v_replacement").value;var f=true;var g=allWords[currentElement.__msh_origWord];if(g.length==0){alert("An impossible condition just happened.  Call FBI.  ;-)")}else{if(g.length==1){replaceClicked();return false}}if(f){for(var h=0;h<g.length;++h){if(g[h]!=currentElement){replaceWord(g[h])}}replaceClicked()}return false}function ignoreClicked(){document.getElementById("v_replacement").value=currentElement.__msh_origWord;replaceClicked();return false}function ignoreAllClicked(){document.getElementById("v_replacement").value=currentElement.__msh_origWord;replaceAllClicked();return false}function learnClicked(){to_p_dict.push(currentElement.__msh_origWord);return ignoreAllClicked()}function internationalizeWindow(){var n=["div","span","button"];for(var h=0;h<n.length;++h){var k=n[h];var i=document.getElementsByTagName(k);for(var j=i.length;--j>=0;){var m=i[j];if(m.childNodes.length==1&&/\S/.test(m.innerHTML)){var l=m.innerHTML;m.innerHTML=_lc(l)}}}}function initDocument(){internationalizeWindow();modified=false;frame=document.getElementById("i_framecontent");var f=document.getElementById("f_content");f.value=Xinha.getHTML(editor._doc.body,false,editor);var e=document.getElementById("f_dictionary");if(typeof editor.config.SpellChecker.defaultDictionary!="undefined"&&editor.config.SpellChecker.defaultDictionary!=""){e.value=editor.config.SpellChecker.defaultDictionary}else{e.value="en_GB"}if(editor.config.SpellChecker.backend=="php"){f.form.action=Xinha.getPluginDir("SpellChecker")+"/spell-check-logic.php"}if(editor.config.SpellChecker.utf8_to_entities){document.getElementById("utf8_to_entities").value=1}else{document.getElementById("utf8_to_entities").value=0}f.form.submit();document.getElementById("f_init").value="0";var d=document.getElementById("v_suggestions");d.onchange=function(){document.getElementById("v_replacement").value=this.value};if(is_ie){d.attachEvent("ondblclick",replaceClicked)}else{d.addEventListener("dblclick",replaceClicked,true)}document.getElementById("b_replace").onclick=replaceClicked;if(editor.config.SpellChecker.backend=="php"){document.getElementById("b_learn").onclick=learnClicked}else{document.getElementById("b_learn").parentNode.removeChild(document.getElementById("b_learn"))}document.getElementById("b_replall").onclick=replaceAllClicked;document.getElementById("b_ignore").onclick=ignoreClicked;document.getElementById("b_ignall").onclick=ignoreAllClicked;document.getElementById("b_recheck").onclick=recheckClicked;document.getElementById("b_revert").onclick=revertClicked;document.getElementById("b_info").onclick=displayInfo;document.getElementById("b_ok").onclick=saveClicked;document.getElementById("b_cancel").onclick=cancelClicked;d=document.getElementById("v_dictionaries");d.onchange=function(){document.getElementById("f_dictionary").value=this.value}}function getAbsolutePos(f){var e={x:f.offsetLeft,y:f.offsetTop};if(f.offsetParent){var d=getAbsolutePos(f.offsetParent);e.x+=d.x;e.y+=d.y}return e}function wordClicked(a){var l=this;if(a){(function(){var c=getAbsolutePos(l);var b={x:frame.offsetWidth-4,y:frame.offsetHeight-4};var d={x:frame.contentWindow.document.body.scrollLeft,y:frame.contentWindow.document.body.scrollTop};c.x-=Math.round(b.x/2);if(c.x<0){c.x=0}c.y-=Math.round(b.y/2);if(c.y<0){c.y=0}frame.contentWindow.scrollTo(c.x,c.y)})()}if(currentElement){var m=allWords[currentElement.__msh_origWord];currentElement.className=currentElement.className.replace(/\s*HA-spellcheck-current\s*/g," ");for(var n=0;n<m.length;++n){var r=m[n];if(r!=currentElement){r.className=r.className.replace(/\s*HA-spellcheck-same\s*/g," ")}}}currentElement=this;this.className+=" HA-spellcheck-current";var m=allWords[currentElement.__msh_origWord];for(var n=0;n<m.length;++n){var r=m[n];if(r!=currentElement){r.className+=" HA-spellcheck-same"}}var o;if(m.length==1){o="one occurrence"}else{if(m.length==2){o="two occurrences"}else{o=m.length+" occurrences"}}var q=suggested_words[this.__msh_origWord];if(q){q=q.split(/,/)}else{q=[]}var i=document.getElementById("v_suggestions");document.getElementById("statusbar").innerHTML="Found "+o+' for word "<b>'+currentElement.__msh_origWord+'</b>"';for(var n=i.length;--n>=0;){i.remove(n)}for(var n=0;n<q.length;++n){var o=q[n];var p=document.createElement("option");p.value=o;p.appendChild(document.createTextNode(o));i.appendChild(p)}document.getElementById("v_currentWord").innerHTML=this.__msh_origWord;if(q.length>0){i.selectedIndex=0;i.onchange()}else{document.getElementById("v_replacement").value=this.innerHTML}i.style.display="none";i.style.display="block";return false}function wordMouseOver(){this.className+=" HA-spellcheck-hover"}function wordMouseOut(){this.className=this.className.replace(/\s*HA-spellcheck-hover\s*/g," ")}function displayInfo(){var e=frame.contentWindow.spellcheck_info;if(!e){alert("No information available")}else{var d="** Document information **";for(var f in e){d+="\n"+f+" : "+e[f]}alert(d)}return false}function finishedSpellChecking(){currentElement=null;wrongWords=null;allWords={};fixedWords=[];suggested_words=frame.contentWindow.suggested_words;document.getElementById("status").innerHTML='Xinha Spell Checker (<a href="readme-tech.html" onclick="window.open(this.href,\'_blank\');return false;" title="Technical information">info</a>)';var w=frame.contentWindow.document;var z=w.getElementsByTagName("span");var v=[];var s=0;for(var a=0;a<z.length;++a){var r=z[a];if(/HA-spellcheck-error/.test(r.className)){v.push(r);r.__msh_wordClicked=wordClicked;r.onclick=function(b){b||(b=window.event);b&&Xinha._stopEvent(b);return this.__msh_wordClicked(false)};r.onmouseover=wordMouseOver;r.onmouseout=wordMouseOut;r.__msh_id=s++;var i=(r.__msh_origWord=r.firstChild.data);r.__msh_fixed=false;if(typeof allWords[i]=="undefined"){allWords[i]=[r]}else{allWords[i].push(r)}}else{if(/HA-spellcheck-fixed/.test(r.className)){fixedWords.push(r)}}}var u=w.getElementById("HA-spellcheck-dictionaries");if(u){u.parentNode.removeChild(u);u=u.innerHTML.split(/,/);var t=document.getElementById("v_dictionaries");for(var a=t.length;--a>=0;){t.remove(a)}var y=document.getElementById("f_dictionary").value;for(var a=0;a<u.length;++a){var i=u[a];var p=document.createElement("option");if(i==y){p.selected=true}p.value=i;p.appendChild(document.createTextNode(i));t.appendChild(p)}}wrongWords=v;if(v.length==0){if(!modified){alert(_lc("No mispelled words found with the selected dictionary."))}else{alert(_lc("No mispelled words found with the selected dictionary."))}return false}(currentElement=v[0]).__msh_wordClicked(true);var q=w.getElementsByTagName("a");for(var a=q.length;--a>=0;){var x=q[a];x.onclick=function(){if(confirm(_lc("Please confirm that you want to open this link")+":\n"+this.href+"\n"+_lc("I will open it in a new page."))){window.open(this.href)}return false}}};