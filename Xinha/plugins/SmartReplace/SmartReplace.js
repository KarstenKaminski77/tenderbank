/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
function SmartReplace(e){this.editor=e;var d=e.config;var f=this;d.registerButton({id:"smartreplace",tooltip:this._lc("SmartReplace"),image:[_editor_url+"iconsets/Tango/ed_buttons_main.png",3,8],textMode:false,action:function(b,c,a){f.buttonPress(null,a)}});d.addToolbarElement("smartreplace","htmlmode",1)}SmartReplace._pluginInfo={name:"SmartReplace",version:"1.0",developer:"Raimund Meyer",developer_url:"http://x-webservice.net",c_owner:"Raimund Meyer",sponsor:"",sponsor_url:"",license:"htmlArea"};SmartReplace.prototype._lc=function(b){return Xinha._lc(b,"SmartReplace")};Xinha.Config.prototype.SmartReplace={defaultActive:true,quotes:null};SmartReplace.prototype.toggleActivity=function(b){if(typeof b!="undefined"){this.active=b}else{this.active=this.active?false:true}this.editor._toolbarObjects.smartreplace.state("active",this.active)};SmartReplace.prototype.onUpdateToolbar=function(){this.editor._toolbarObjects.smartreplace.state("active",this.active)};SmartReplace.prototype.onGenerate=function(){this.active=this.editor.config.SmartReplace.defaultActive;this.editor._toolbarObjects.smartreplace.state("active",this.active);var d=this;Xinha._addEvent(d.editor._doc,"keypress",function(a){return d.keyEvent(Xinha.is_ie?d.editor._iframe.contentWindow.event:a)});var c=this.editor.config.SmartReplace.quotes;if(c&&typeof c=="object"){this.openingQuotes=c[0];this.closingQuotes=c[1];this.openingQuote=c[2];this.closingQuote=c[3]}else{this.openingQuotes=this._lc("OpeningDoubleQuotes");this.closingQuote=this._lc("ClosingSingleQuote");this.closingQuotes=this._lc("ClosingDoubleQuotes");this.openingQuote=this._lc("OpeningSingleQuote")}if(this.openingQuotes=="OpeningDoubleQuotes"){this.openingQuotes=String.fromCharCode(8220);this.closingQuotes=String.fromCharCode(8221);this.openingQuote=String.fromCharCode(8216);this.closingQuote=String.fromCharCode(8217)}};SmartReplace.prototype.keyEvent=function(e){if(!this.active){return true}var g=this.editor;var h=Xinha.is_ie?e.keyCode:e.which;var f=String.fromCharCode(h);if(f=='"'||f=="'"){Xinha._stopEvent(e);return this.smartQuotes(f)}if(h==32){return this.smartReplace(e,2,/^\s-/," "+String.fromCharCode(8211),false)}if(f=="."){return this.smartReplace(e,2,/\.\./,String.fromCharCode(8230),true)}return true};SmartReplace.prototype.smartQuotes=function(h){if(h=="'"){var k=this.openingQuote;var i=this.closingQuote}else{var k=this.openingQuotes;var i=this.closingQuotes}var j=this.editor;var l=j.getSelection();if(Xinha.is_ie){var g=j.createRange(l);if(g.text!==""){g.text=""}g.moveStart("character",-1);if(g.text.match(/\S/)){g.moveStart("character",+1);g.text=i}else{g.moveStart("character",+1);g.text=k}}else{var g=j.createRange(l);if(!g.collapsed){j.insertNodeAtSelection(document.createTextNode(""))}if(g.startOffset>0){g.setStart(g.startContainer,g.startOffset-1)}if(g.toString().match(/[^\s\xA0]/)){g.collapse(false);j.insertNodeAtSelection(document.createTextNode(i))}else{j.insertNodeAtSelection(document.createTextNode(g.toString()[0]+k))}j.getSelection().collapseToEnd()}return false};SmartReplace.prototype.smartReplace=function(i,o,k,m,l){var n=this.editor;var p=this.editor.getSelection();var j=this.editor.createRange(p);if(Xinha.is_ie){j.moveStart("character",-o);if(j.text.match(k)){j.text=m;if(l){Xinha._stopEvent(i);return false}}}else{if(j.startOffset>1){j.setStart(j.startContainer,j.startOffset-o)}if(j.toString().match(k)){this.editor.insertNodeAtSelection(document.createTextNode(m));j.deleteContents();j.collapse(true);if(l){Xinha._stopEvent(i);return false}}n.getSelection().collapseToEnd()}return true};SmartReplace.prototype.replaceAll=function(){var i=["&quot;",String.fromCharCode(8220),String.fromCharCode(8221),String.fromCharCode(8222),String.fromCharCode(187),String.fromCharCode(171)];var k=["'",String.fromCharCode(8216),String.fromCharCode(8217),String.fromCharCode(8218),String.fromCharCode(8250),String.fromCharCode(8249)];var l=this.editor.getHTML();var p=new RegExp("(\\s|^|>)("+i.join("|")+")(\\S)","g");l=l.replace(p,"$1"+this.openingQuotes+"$3");var m=new RegExp("(\\s|^|>)("+k.join("|")+")(\\S)","g");l=l.replace(m,"$1"+this.openingQuote+"$3");var n=new RegExp("(\\S)("+i.join("|")+")","g");l=l.replace(n,"$1"+this.closingQuotes);var j=new RegExp("(\\S)("+k.join("|")+")","g");l=l.replace(j,"$1"+this.closingQuote);var o=new RegExp("( |&nbsp;)(-)( |&nbsp;)","g");l=l.replace(o," "+String.fromCharCode(8211)+" ");this.editor.setHTML(l)};SmartReplace.prototype.buttonPress=function(g,f){var i=this;if(this.dialog.rootElem.style.display!="none"){return this.dialog.hide()}var j=function(){var a=i.dialog.hide();i.toggleActivity((a.enable)?true:false);if(a.convert){i.replaceAll();i.dialog.getElementById("convert").checked=false}};var h={enable:i.active?"on":"",convert:""};this.show(h,j)};SmartReplace.prototype.onGenerateOnce=function(){this._prepareDialog()};SmartReplace.prototype._prepareDialog=function(){var c=this;var d=this.editor;if(!this.html){Xinha._getback(Xinha.getPluginDir("SmartReplace")+"/dialog.html",function(a){c.html=a;c._prepareDialog()});return}this.dialog=new Xinha.Dialog(d,this.html,"SmartReplace",{},{modal:false});this.dialog.attachToPanel("top");this.dialog.getElementById("enable").onchange=function(){c.toggleActivity(this.checked)};this.dialog.getElementById("convert").onchange=function(){c.dialog.getElementById("ok").style.display=(this.checked)?"":"none"};this.dialog.getElementById("ok").onclick=function(){c.replaceAll();c.dialog.getElementById("convert").checked=false;this.style.display="none"};this.ready=true};SmartReplace.prototype.show=function(c){if(!this.ready){var d=this;window.setTimeout(function(){d.show(c,ok,cancel)},100);return}var d=this;this.dialog.show(c);this.dialog.onresize()};