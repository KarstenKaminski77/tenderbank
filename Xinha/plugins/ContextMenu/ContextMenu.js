/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
Xinha.loadStyle("menu.css","ContextMenu");function ContextMenu(b){this.editor=b}ContextMenu._pluginInfo={name:"ContextMenu",version:"1.0",developer:"Mihai Bazon",developer_url:"http://dynarch.com/mishoo/",c_owner:"dynarch.com",sponsor:"American Bible Society",sponsor_url:"http://www.americanbible.org",license:"htmlArea"};Xinha.Config.prototype.ContextMenu={disableMozillaSpellCheck:false,customHooks:{}};ContextMenu.prototype.onGenerate=function(){var d=this;var c=this.editordoc=this.editor._iframe.contentWindow.document;Xinha._addEvents(c,["contextmenu"],function(a){return d.popupMenu(Xinha.is_ie?d.editor._iframe.contentWindow.event:a)});this.currentMenu=null;if(this.editor.config.ContextMenu.disableMozillaSpellCheck){this.editordoc.body.spellcheck=false}};ContextMenu.prototype.getContextMenu=function(v){var K=this;var B=this.editor;var I=B.config;var L=[];var F=this.editor.plugins.TableOperations;if(F){F=F.instance}var w=B.hasSelectedText();if(!Xinha.is_gecko){if(w){L.push([Xinha._lc("Cut","ContextMenu"),function(){B.execCommand("cut")},null,I.btnList.cut[1]],[Xinha._lc("Copy","ContextMenu"),function(){B.execCommand("copy")},null,I.btnList.copy[1]]);L.push([Xinha._lc("Paste","ContextMenu"),function(){B.execCommand("paste")},null,I.btnList.paste[1]])}}var x=v;var D=[];var z=null;var C=null;var J=null;var y=null;var A=null;function H(a){F.buttonPress(B,a)}function G(c){var f=x;var a=f.parentNode;var d=B._doc.createElement("p");d.appendChild(B._doc.createElement("br"));a.insertBefore(d,c?f.nextSibling:f);var e=B._getSelection();var b=B._createRange(e);if(!Xinha.is_ie){e.removeAllRanges();b.selectNodeContents(d);b.collapse(true);e.addRange(b)}else{b.moveToElementText(d);b.collapse(true);b.select()}}for(;v;v=v.parentNode){var i=v.tagName;if(!i){continue}i=i.toLowerCase();switch(i){case"img":A=v;D.push(null,[Xinha._lc("_Image Properties...","ContextMenu"),function(){B._insertImage(A)},Xinha._lc("Show the image properties dialog","ContextMenu"),I.btnList.insertimage[1]]);break;case"a":z=v;D.push(null,[Xinha._lc("_Modify Link...","ContextMenu"),function(){B.config.btnList.createlink[3](B)},Xinha._lc("Current URL is","ContextMenu")+": "+z.href,I.btnList.createlink[1]],[Xinha._lc("Chec_k Link...","ContextMenu"),function(){window.open(z.href)},Xinha._lc("Opens this link in a new window","ContextMenu")],[Xinha._lc("_Remove Link...","ContextMenu"),function(){if(confirm(Xinha._lc("Please confirm that you want to unlink this element.","ContextMenu")+"\n"+Xinha._lc("Link points to:","ContextMenu")+" "+z.href)){while(z.firstChild){z.parentNode.insertBefore(z.firstChild,z)}z.parentNode.removeChild(z)}},Xinha._lc("Unlink the current element","ContextMenu")]);break;case"td":y=v;if(!F){break}D.push(null,[Xinha._lc("C_ell Properties...","ContextMenu"),function(){H("TO-cell-prop")},Xinha._lc("Show the Table Cell Properties dialog","ContextMenu"),I.btnList["TO-cell-prop"][1]],[Xinha._lc("Insert Cell After","ContextMenu"),function(){H("TO-cell-insert-after")},Xinha._lc("Insert Cell After","ContextMenu"),I.btnList["TO-cell-insert-after"][1]],[Xinha._lc("Insert Cell Before","ContextMenu"),function(){H("TO-cell-insert-before")},Xinha._lc("Insert Cell After","ContextMenu"),I.btnList["TO-cell-insert-before"][1]],[Xinha._lc("Delete Cell","ContextMenu"),function(){H("TO-cell-delete")},Xinha._lc("Delete Cell","ContextMenu"),I.btnList["TO-cell-delete"][1]],[Xinha._lc("Merge Cells","ContextMenu"),function(){H("TO-cell-merge")},Xinha._lc("Merge Cells","ContextMenu"),I.btnList["TO-cell-merge"][1]]);break;case"tr":J=v;if(!F){break}D.push(null,[Xinha._lc("Ro_w Properties...","ContextMenu"),function(){H("TO-row-prop")},Xinha._lc("Show the Table Row Properties dialog","ContextMenu"),I.btnList["TO-row-prop"][1]],[Xinha._lc("I_nsert Row Before","ContextMenu"),function(){H("TO-row-insert-above")},Xinha._lc("Insert a new row before the current one","ContextMenu"),I.btnList["TO-row-insert-above"][1]],[Xinha._lc("In_sert Row After","ContextMenu"),function(){H("TO-row-insert-under")},Xinha._lc("Insert a new row after the current one","ContextMenu"),I.btnList["TO-row-insert-under"][1]],[Xinha._lc("_Delete Row","ContextMenu"),function(){H("TO-row-delete")},Xinha._lc("Delete the current row","ContextMenu"),I.btnList["TO-row-delete"][1]]);break;case"table":C=v;if(!F){break}D.push(null,[Xinha._lc("_Table Properties...","ContextMenu"),function(){H("TO-table-prop")},Xinha._lc("Show the Table Properties dialog","ContextMenu"),I.btnList["TO-table-prop"][1]],[Xinha._lc("Insert _Column Before","ContextMenu"),function(){H("TO-col-insert-before")},Xinha._lc("Insert a new column before the current one","ContextMenu"),I.btnList["TO-col-insert-before"][1]],[Xinha._lc("Insert C_olumn After","ContextMenu"),function(){H("TO-col-insert-after")},Xinha._lc("Insert a new column after the current one","ContextMenu"),I.btnList["TO-col-insert-after"][1]],[Xinha._lc("De_lete Column","ContextMenu"),function(){H("TO-col-delete")},Xinha._lc("Delete the current column","ContextMenu"),I.btnList["TO-col-delete"][1]]);break;case"body":D.push(null,[Xinha._lc("Justify Left","ContextMenu"),function(){B.execCommand("justifyleft")},null,I.btnList.justifyleft[1]],[Xinha._lc("Justify Center","ContextMenu"),function(){B.execCommand("justifycenter")},null,I.btnList.justifycenter[1]],[Xinha._lc("Justify Right","ContextMenu"),function(){B.execCommand("justifyright")},null,I.btnList.justifyright[1]],[Xinha._lc("Justify Full","ContextMenu"),function(){B.execCommand("justifyfull")},null,I.btnList.justifyfull[1]]);break}}if(w&&!z){L.push(null,[Xinha._lc("Make lin_k...","ContextMenu"),function(){B.config.btnList.createlink[3](B)},Xinha._lc("Create a link","ContextMenu"),I.btnList.createlink[1]])}if(B.config.ContextMenu.customHooks[x.tagName.toLowerCase()]){var u=B.config.ContextMenu.customHooks[x.tagName.toLowerCase()];for(var E=0;E<u.length;++E){L.push(u[E])}}for(var E=0;E<D.length;++E){L.push(D[E])}if(!/html|body/i.test(x.tagName)){L.push(null,[Xinha._lc({string:"Remove the $elem Element...",replace:{elem:"&lt;"+x.tagName+"&gt;"}},"ContextMenu"),function(){if(confirm(Xinha._lc("Please confirm that you want to remove this element:","ContextMenu")+" "+x.tagName)){var a=x;var c=a.parentNode;c.removeChild(a);if(Xinha.is_gecko){if(c.tagName.toLowerCase()=="td"&&!c.hasChildNodes()){c.appendChild(B._doc.createElement("br"))}B.forceRedraw();B.focusEditor();B.updateToolbar();if(C){var b=C.style.borderCollapse;C.style.borderCollapse="collapse";C.style.borderCollapse="separate";C.style.borderCollapse=b}}}},Xinha._lc("Remove this node from the document","ContextMenu")],[Xinha._lc("Insert paragraph before","ContextMenu"),function(){G(false)},Xinha._lc("Insert a paragraph before the current node","ContextMenu")],[Xinha._lc("Insert paragraph after","ContextMenu"),function(){G(true)},Xinha._lc("Insert a paragraph after the current node","ContextMenu")])}if(!L[0]){L.shift()}return L};ContextMenu.prototype.popupMenu=function(K){var Q=this;if(this.currentMenu){this.closeMenu()}function U(c){var b={x:c.offsetLeft,y:c.offsetTop};if(c.offsetParent){var a=U(c.offsetParent);b.x+=a.x;b.y+=a.y}return b}function ab(a){a||(a=window.event);if(!Q.currentMenu){alert(Xinha._lc("How did you get here? (Please report!)","ContextMenu"));return false}var b=Xinha.is_ie?a.srcElement:a.target;for(;b!=null&&b!=Q.currentMenu;b=b.parentNode){}if(b==null){Q.closeMenu()}}var L=[];function J(c){c||(c=window.event);Xinha._stopEvent(c);if(c.keyCode==27){Q.closeMenu();return false}var d=String.fromCharCode(Xinha.is_ie?c.keyCode:c.charCode).toLowerCase();for(var a=L.length;--a>=0;){var b=L[a];if(b[0].toLowerCase()==d){b[1].__msh.activate()}}}Q.closeMenu=function(){Q.currentMenu.parentNode.removeChild(Q.currentMenu);Q.currentMenu=null;Xinha._removeEvent(document,"mousedown",ab);Xinha._removeEvent(Q.editordoc,"mousedown",ab);if(L.length>0){Xinha._removeEvent(Q.editordoc,"keypress",J)}if(Xinha.is_ie){Q.iePopup.hide()}};var h=Xinha.is_ie?K.srcElement:K.target;var aa=U(Q.editor._htmlArea);var V=K.clientX+aa.x;var W=K.clientY+aa.y;var P;var M;if(!Xinha.is_ie){M=document}else{var y=this.iePopup=window.createPopup();M=y.document;M.open();M.write("<html><head><style type='text/css'>@import url("+Xinha.getPluginDir("ContextMenu")+"/menu.css); html, body { padding: 0px; margin: 0px; overflow: hidden; border: 0px; }</style></head><body unselectable='yes'></body></html>");M.close()}P=M.createElement("div");if(Xinha.is_ie){P.unselectable="on"}P.oncontextmenu=function(){return false};P.className="htmlarea-context-menu";if(!Xinha.is_ie){P.style.visibility="hidden";P.style.left=P.style.top="-200px"}M.body.appendChild(P);var x=M.createElement("table");P.appendChild(x);x.cellSpacing=0;x.cellPadding=0;var i=M.createElement("tbody");x.appendChild(i);var Y=this.getContextMenu(h);for(var S=0;S<Y.length;++S){var I=Y[S];var w=M.createElement("tr");i.appendChild(w);if(Xinha.is_ie){w.unselectable="on"}else{w.onmousedown=function(a){Xinha._stopEvent(a);return false}}if(!I){w.className="separator";var Z=M.createElement("td");Z.className="icon";var t=">";if(Xinha.is_ie){Z.unselectable="on";t=" unselectable='on' style='height=1px'>&nbsp;"}Z.innerHTML="<div"+t+"</div>";var ac=Z.cloneNode(true);ac.className="label";w.appendChild(Z);w.appendChild(ac)}else{var X=I[0];w.className="item";w.__msh={item:w,label:X,action:I[1],tooltip:I[2]||null,icon:I[3]||null,activate:function(){Q.closeMenu();Q.editor.focusEditor();this.action()}};X=X.replace(/_([a-zA-Z0-9])/,"<u>$1</u>");if(X!=I[0]){L.push([RegExp.$1,w])}X=X.replace(/__/,"_");var ac=M.createElement("td");if(Xinha.is_ie){ac.unselectable="on"}w.appendChild(ac);ac.className="icon";if(w.__msh.icon){var R=Xinha.makeBtnImg(w.__msh.icon,M);ac.appendChild(R)}var ad=M.createElement("td");if(Xinha.is_ie){ad.unselectable="on"}w.appendChild(ad);ad.className="label";ad.innerHTML=X;w.onmouseover=function(){this.className+=" hover";Q.editor._statusBarTree.innerHTML=this.__msh.tooltip||"&nbsp;"};w.onmouseout=function(){this.className="item"};w.oncontextmenu=function(a){this.__msh.activate();if(!Xinha.is_ie){Xinha._stopEvent(a)}return false};w.onmouseup=function(a){var b=(new Date()).getTime();if(b-Q.timeStamp>500){this.__msh.activate()}if(!Xinha.is_ie){Xinha._stopEvent(a)}return false}}}if(!Xinha.is_ie){var O=10;if(W+P.offsetHeight+O>window.innerHeight){W=window.innerHeight-P.offsetHeight-O}if(V+P.offsetWidth+O>window.innerWidth){V=window.innerWidth-P.offsetWidth-O}P.style.left=V+"px";P.style.top=W+"px";P.style.visibility="visible"}else{this.iePopup.show(K.screenX,K.screenY,300,50);var T=P.offsetWidth;var N=P.offsetHeight;this.iePopup.show(K.screenX,K.screenY,T,N)}this.currentMenu=P;this.timeStamp=(new Date()).getTime();Xinha._addEvent(document,"mousedown",ab);Xinha._addEvent(this.editordoc,"mousedown",ab);if(L.length>0){Xinha._addEvent(this.editordoc,"keypress",J)}Xinha._stopEvent(K);return false};