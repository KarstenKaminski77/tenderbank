/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
Xinha.Config.prototype.FormOperations={multiple_field_format:"php",allow_edit_form:false,default_form_action:Xinha.getPluginDir("FormOperations")+"/formmail.php",default_form_html:Xinha._geturlcontent(Xinha.getPluginDir("FormOperations")+"/default_form.html")};FormOperations._pluginInfo={name:"FormOperations",version:"1.0",developer:"James Sleeman",developer_url:"http://www.gogo.co.nz/",c_owner:"Gogo Internet Services",license:"htmlArea",sponsor:"Gogo Internet Services",sponsor_url:"http://www.gogo.co.nz/"};function FormOperations(f){this.editor=f;this.panel=false;this.html=false;this.ready=false;this.activeElement=null;this._preparePanel();f.config.pageStyleSheets.push(Xinha.getPluginDir("FormOperations")+"/iframe.css");var g=["separator","insert_form","insert_text_field","insert_textarea_field","insert_select_field","insert_cb_field","insert_rb_field","insert_button"];this.editor.config.toolbar.push(g);function h(a){var b=Xinha.uniq("fo");a=a.replace(/^<([^ \/>]+)/i,'<$1 id="'+b+'"');f.insertHTML(a);var c=f._doc.getElementById(b);c.setAttribute("id","");f.selectNodeContents(c);f.updateToolbar();return c}var e=f.imgURL("buttons.gif","FormOperations");FormOperations.prototype._lc=function(a){return Xinha._lc(a,"FormOperations")};this.editor.config.btnList.insert_form=[this._lc("Insert a Form."),[e,0,0],false,function(){var a=null;if(f.config.FormOperations.default_form_html){a=h(f.config.FormOperations.default_form_html)}else{a=h("<form>&nbsp;</form>")}if(f.config.FormOperations.default_form_action&&!a.action){a.action=f.config.FormOperations.default_form_action}}];this.editor.config.btnList.insert_text_field=[this._lc("Insert a text, password or hidden field."),[e,1,0],false,function(){h('<input type="text" />')},"form"];this.editor.config.btnList.insert_textarea_field=[this._lc("Insert a multi-line text field."),[e,2,0],false,function(){h("<textarea> </textarea>")},"form"];this.editor.config.btnList.insert_select_field=[this._lc("Insert a select field."),[e,3,0],false,function(){h('<select> <option value="">Please Select...</option> </select>')},"form"];this.editor.config.btnList.insert_cb_field=[this._lc("Insert a check box."),[e,4,0],false,function(){h('<input type="checkbox" />')},"form"];this.editor.config.btnList.insert_rb_field=[this._lc("Insert a radio button."),[e,5,0],false,function(){h('<input type="radio" />')},"form"];this.editor.config.btnList.insert_button=[this._lc("Insert a submit/reset button."),[e,6,0],false,function(){h('<input type="submit" value="Send" />')},"form"]}FormOperations.prototype.onGenerate=function(){if(Xinha.is_gecko){var d=this.editor;var c=this.editor._doc;Xinha._addEvents(c,["mousemove"],function(a){return d._editorEvent(a)})}};FormOperations.prototype._preparePanel=function(){var b=this;if(this.html==false){Xinha._getback(Xinha.getPluginDir("FormOperations")+"/panel.html",function(a){b.html=a;b._preparePanel()});return false}if(typeof Xinha.Dialog=="undefined"){Xinha._loadback(_editor_url+"modules/Dialogs/XinhaDialog.js",function(){b._preparePanel()});return false}if(typeof Xinha.PanelDialog=="undefined"){Xinha._loadback(_editor_url+"modules/Dialogs/panel-dialog.js",function(){b._preparePanel()});return false}this.panel=new Xinha.PanelDialog(this.editor,"bottom",this.html,"FormOperations");this.panel.hide();this.ready=true};FormOperations.prototype.onUpdateToolbar=function(){if(!this.ready){return true}var c=this.editor._activeElement(this.editor._getSelection());if(c!=null){if(c==this.activeElement){return true}var d=c.tagName.toLowerCase();this.hideAll();if(d==="form"){if(this.editor.config.FormOperations.allow_edit_form){this.showForm(c)}else{this.panel.hide();this.activeElement=null;this.panel.hide();return true}}else{if(this.editor.config.FormOperations.allow_edit_form&&typeof c.form!="undefined"&&c.form){this.showForm(c.form)}switch(d){case"form":this.showForm(c);break;case"input":switch(c.getAttribute("type").toLowerCase()){case"text":case"password":case"hidden":this.showText(c);break;case"radio":case"checkbox":this.showCbRd(c);break;case"submit":case"reset":case"button":this.showButton(c);break}break;case"textarea":this.showTextarea(c);break;case"select":this.showSelect(c);break;default:this.activeElement=null;this.panel.hide();return true}}this.panel.show();this.activeElement=c;return true}else{this.activeElement=null;this.panel.hide();return true}};FormOperations.prototype.hideAll=function(){this.panel.getElementById("fs_form").style.display="none";this.panel.getElementById("fs_text").style.display="none";this.panel.getElementById("fs_textarea").style.display="none";this.panel.getElementById("fs_select").style.display="none";this.panel.getElementById("fs_cbrd").style.display="none";this.panel.getElementById("fs_button").style.display="none"};FormOperations.prototype.showForm=function(d){this.panel.getElementById("fs_form").style.display="";var e={action:d.action,method:d.method.toUpperCase()};this.panel.setValues(e);var f=d;this.panel.getElementById("action").onkeyup=function(){f.action=this.value};this.panel.getElementById("method").onchange=function(){f.method=this.options[this.selectedIndex].value}};FormOperations.prototype.showText=function(i){this.panel.getElementById("fs_text").style.display="";var l={text_name:this.deformatName(i,i.name),text_value:i.value,text_type:i.type.toLowerCase(),text_width:i.style.width?parseFloat(i.style.width.replace(/[^0-9.]/,"")):"",text_width_units:i.style.width?i.style.width.replace(/[0-9.]/,"").toLowerCase():"ex",text_maxlength:i.maxlength?i.maxlength:""};this.panel.setValues(l);var g=i;var h=this;this.panel.getElementById("text_name").onkeyup=function(){g.name=h.formatName(g,this.value)};this.panel.getElementById("text_value").onkeyup=function(){g.value=this.value};this.panel.getElementById("text_type").onchange=function(){if(!Xinha.is_ie){g.type=this.options[this.selectedIndex].value}else{var a=h.editor._doc.createElement("div");if(!/type=/.test(g.outerHTML)){a.innerHTML=g.outerHTML.replace(/<INPUT/i,'<input type="'+this.options[this.selectedIndex].value+'"')}else{a.innerHTML=g.outerHTML.replace(/type="?[a-z]+"?/i,'type="'+this.options[this.selectedIndex].value+'"')}var b=Xinha.removeFromParent(a.childNodes[0]);g.parentNode.insertBefore(b,g);Xinha.removeFromParent(g);i=g=b}};var j=this.panel.getElementById("text_width");var k=this.panel.getElementById("text_width_units");this.panel.getElementById("text_width").onkeyup=this.panel.getElementById("text_width_units").onchange=function(){if(!j.value||isNaN(parseFloat(j.value))){g.style.width=""}g.style.width=parseFloat(j.value)+k.options[k.selectedIndex].value};this.panel.getElementById("text_maxlength").onkeyup=function(){g.maxlength=this.value}};FormOperations.prototype.showCbRd=function(h){this.panel.getElementById("fs_cbrd").style.display="";var e={cbrd_name:this.deformatName(h,h.name),cbrd_value:h.value,cbrd_checked:h.checked?1:0,cbrd_type:h.type.toLowerCase()};this.panel.setValues(e);var f=h;var g=this;this.panel.getElementById("cbrd_name").onkeyup=function(){f.name=g.formatName(f,this.value)};this.panel.getElementById("cbrd_value").onkeyup=function(){f.value=this.value};this.panel.getElementById("cbrd_type").onchange=function(){if(!Xinha.is_ie){f.type=this.options[this.selectedIndex].value}else{var a=g.editor._doc.createElement("div");if(!/type=/.test(f.outerHTML)){a.innerHTML=f.outerHTML.replace(/<INPUT/i,'<input type="'+this.options[this.selectedIndex].value+'"')}else{a.innerHTML=f.outerHTML.replace(/type="?[a-z]+"?/i,'type="'+this.options[this.selectedIndex].value+'"')}var b=Xinha.removeFromParent(a.childNodes[0]);f.parentNode.insertBefore(b,f);Xinha.removeFromParent(f);h=f=b}};this.panel.getElementById("cbrd_checked").onclick=function(){f.checked=this.checked}};FormOperations.prototype.showButton=function(h){this.panel.getElementById("fs_button").style.display="";var e={button_name:this.deformatName(h,h.name),button_value:h.value,button_type:h.type.toLowerCase()};this.panel.setValues(e);var f=h;var g=this;this.panel.getElementById("button_name").onkeyup=function(){f.name=g.formatName(f,this.value)};this.panel.getElementById("button_value").onkeyup=function(){f.value=this.value};this.panel.getElementById("button_type").onchange=function(){if(!Xinha.is_ie){f.type=this.options[this.selectedIndex].value}else{var a=g.editor._doc.createElement("div");if(!/type=/.test(f.outerHTML)){a.innerHTML=f.outerHTML.replace(/<INPUT/i,'<input type="'+this.options[this.selectedIndex].value+'"')}else{a.innerHTML=f.outerHTML.replace(/type="?[a-z]+"?/i,'type="'+this.options[this.selectedIndex].value+'"')}var b=Xinha.removeFromParent(a.childNodes[0]);f.parentNode.insertBefore(b,f);Xinha.removeFromParent(f);h=f=b}}};FormOperations.prototype.showTextarea=function(m){this.panel.getElementById("fs_textarea").style.display="";var h={textarea_name:this.deformatName(m,m.name),textarea_value:m.value,textarea_width:m.style.width?parseFloat(m.style.width.replace(/[^0-9.]/,"")):"",textarea_width_units:m.style.width?m.style.width.replace(/[0-9.]/,"").toLowerCase():"ex",textarea_height:m.style.height?parseFloat(m.style.height.replace(/[^0-9.]/,"")):"",textarea_height_units:m.style.height?m.style.height.replace(/[0-9.]/,"").toLowerCase():"ex"};this.panel.setValues(h);var k=m;var l=this;this.panel.getElementById("textarea_name").onkeyup=function(){k.name=l.formatName(k,this.value)};this.panel.getElementById("textarea_value").onkeyup=function(){k.value=k.innerHTML=this.value};var o=this.panel.getElementById("textarea_width");var p=this.panel.getElementById("textarea_width_units");this.panel.getElementById("textarea_width").onkeyup=this.panel.getElementById("textarea_width_units").onchange=function(){if(!o.value||isNaN(parseFloat(o.value))){k.style.width=""}k.style.width=parseFloat(o.value)+p.options[p.selectedIndex].value};var i=this.panel.getElementById("textarea_height");var n=this.panel.getElementById("textarea_height_units");this.panel.getElementById("textarea_height").onkeyup=this.panel.getElementById("textarea_height_units").onchange=function(){if(!i.value||isNaN(parseFloat(i.value))){k.style.height=""}k.style.height=parseFloat(i.value)+n.options[n.selectedIndex].value}};FormOperations.prototype.showSelect=function(i){this.panel.getElementById("fs_select").style.display="";var l={select_name:this.deformatName(i,i.name),select_multiple:i.multiple?1:0,select_width:i.style.width?parseFloat(i.style.width.replace(/[^0-9.]/,"")):"",select_width_units:i.style.width?i.style.width.replace(/[0-9.]/,"").toLowerCase():"ex",select_height:i.style.height?parseFloat(i.style.height.replace(/[^0-9.]/,"")):(i.size&&i.size>0?i.size:1),select_height_units:i.style.height?i.style.height.replace(/[0-9.]/,"").toLowerCase():"items"};this.panel.setValues(l);var r=i;var n=this;this.panel.getElementById("select_name").onkeyup=function(){r.name=n.formatName(r,this.value)};this.panel.getElementById("select_multiple").onclick=function(){r.multiple=this.checked};var h=this.panel.getElementById("select_width");var p=this.panel.getElementById("select_width_units");this.panel.getElementById("select_width").onkeyup=this.panel.getElementById("select_width_units").onchange=function(){if(!h.value||isNaN(parseFloat(h.value))){r.style.width=""}r.style.width=parseFloat(h.value)+p.options[p.selectedIndex].value};var q=this.panel.getElementById("select_height");var m=this.panel.getElementById("select_height_units");this.panel.getElementById("select_height").onkeyup=this.panel.getElementById("select_height_units").onchange=function(){if(!q.value||isNaN(parseFloat(q.value))){r.style.height="";return}if(m.selectedIndex==0){r.style.height="";r.size=parseInt(q.value)}else{r.style.height=parseFloat(q.value)+m.options[m.selectedIndex].value}};var o=this.panel.getElementById("select_options");this.arrayToOpts(this.optsToArray(i.options),o.options);this.panel.getElementById("add_option").onclick=function(){var a=prompt(Xinha._lc("Enter the name for new option.","FormOperations"));if(a==null){return}var b=new Option(a);var c=n.optsToArray(o.options);if(o.selectedIndex>=0){c.splice(o.selectedIndex,0,b)}else{c.push(b)}n.arrayToOpts(c,i.options);n.arrayToOpts(c,o.options)};this.panel.getElementById("del_option").onclick=function(){var b=n.optsToArray(o.options);var c=[];for(var a=0;a<b.length;a++){if(b[a].selected){continue}c.push(b[a])}n.arrayToOpts(c,i.options);n.arrayToOpts(c,o.options)};this.panel.getElementById("up_option").onclick=function(){if(!(o.selectedIndex>0)){return}var a=n.optsToArray(o.options);var b=a.splice(o.selectedIndex,1).pop();a.splice(o.selectedIndex-1,0,b);n.arrayToOpts(a,i.options);n.arrayToOpts(a,o.options)};this.panel.getElementById("down_option").onclick=function(){if(o.selectedIndex==o.options.length-1){return}var a=n.optsToArray(o.options);var b=a.splice(o.selectedIndex,1).pop();a.splice(o.selectedIndex+1,0,b);n.arrayToOpts(a,i.options);n.arrayToOpts(a,o.options)};this.panel.getElementById("select_options").onchange=function(){n.arrayToOpts(n.optsToArray(o.options),i.options)}};FormOperations.prototype.optsToArray=function(e){var a=[];for(var f=0;f<e.length;f++){a.push({text:e[f].text,value:e[f].value,defaultSelected:e[f].defaultSelected,selected:e[f].selected})}return a};FormOperations.prototype.arrayToOpts=function(a,e){for(var f=e.length-1;f>=0;f--){e[f]=null}for(var f=0;f<a.length;f++){e[f]=new Option(a[f].text,a[f].value,a[f].defaultSelected,a[f].selected)}};FormOperations.prototype.formatName=function(d,f){var e=f;switch(this.editor.config.FormOperations.multiple_field_format){case"php":e+="[]";break;case"unmodified":break;default:throw ("Unknown multiple field format "+this.editor.config.FormOperations.multiple_field_format)}if((d.tagName.toLowerCase()=="select"&&d.multiple)||(d.tagName.toLowerCase()=="input"&&d.type.toLowerCase()=="checkbox")){f=e}return f};FormOperations.prototype.deformatName=function(d,c){if(this.editor.config.FormOperations.multiple_field_format=="php"){c=c.replace(/\[\]$/,"")}return c};