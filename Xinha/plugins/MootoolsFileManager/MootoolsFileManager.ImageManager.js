/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
MootoolsFileManager.prototype.OpenImageManager=function(f){var g=this.editor;var h=this;var e=null;if(typeof f=="undefined"){f=g.getParentElement();if(f&&!/^img$/i.test(f.tagName)){f=null}}if(f){e={f_url:Xinha.is_ie?f.src:f.src,f_alt:f.alt,f_border:f.style.borderWidth?f.style.borderWidth:f.border,f_align:f.hasAttribute("align")?f.align:null,f_padding:f.style.padding,f_margin:f.style.margin,f_width:f.hasAttribute("width")?f.width:null,f_height:f.hasAttribute("height")?f.height:null,f_backgroundColor:f.style.backgroundColor,f_borderColor:f.style.borderColor,f_hspace:f.hspace&&f.hspace!="-1"?parseInt(f.hspace):null,f_vspace:f.vspace&&f.vspace!="-1"?parseInt(f.vspace):null};e.f_border=this.shortSize(e.f_border);e.f_padding=this.shortSize(e.f_padding);e.f_margin=this.shortSize(e.f_margin);e.f_backgroundColor=this.convertToHex(e.f_backgroundColor);e.f_borderColor=this.convertToHex(e.f_borderColor)}this.current_image=f;this.current_attributes=e;if(!this.ImageManagerWidget){this.ImageManagerWidget=new FileManager({url:this.editor.config.MootoolsFileManager.backend+"__function=image-manager&",assetBasePath:Xinha.getPluginDir("MootoolsFileManager")+"/mootools-filemanager/Assets",language:_editor_lang,selectable:true,upload:this.phpcfg.allow_images_upload,uploadAuthData:this.editor.config.MootoolsFileManager.backend_data,onComplete:function(a,b){h.ImageManagerReturn(a,b)},onHide:function(){if(this.swf&&this.swf.box){this.swf.box.style.display="none"}},onShow:function(){if(this.swf&&this.swf.box){this.swf.box.style.display=""}},onDetails:function(a){this.info.adopt(h.ImageManagerAttributes(a));return true},onHidePreview:function(){$(h.ImageManagerAttributes().table).dispose();return true}})}this.ImageManagerWidget.show()};MootoolsFileManager.prototype.ImageManagerAttributes=function(g){var h=this;h._LastImageDetails=g;function e(a){var b=h._ImageManagerAttributesTable.getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].name==a){return b[c]}}var b=h._ImageManagerAttributesTable.getElementsByTagName("select");for(var c=0;c<b.length;c++){if(b[c].name==a){return b[c]}}return null}function f(a,b){for(var c=0;c<e(a).options.length;c++){if(e(a).options[c].value==b){e(a).selectedIndex=c}}}if(!this._ImageManagerAttributesTable){this._ImageManagerAttributesTable=(function(){var c=document.createElement("table");c.className="filemanager-extended-options";var r=c.appendChild(document.createElement("tbody"));var p=r.appendChild(document.createElement("tr"));var a=p.appendChild(document.createElement("th"));var d=a.appendChild(document.createTextNode("Description:"));var t=p.appendChild(document.createElement("td"));var o=t.appendChild(document.createElement("input"));t.colSpan=6;o.name="f_alt";o.type="text";a.className=t.className="filemanager-f_alt";var p=r.appendChild(document.createElement("tr"));var a=p.appendChild(document.createElement("th"));var d=a.appendChild(document.createTextNode("Width:"));var t=p.appendChild(document.createElement("td"));var o=t.appendChild(document.createElement("input"));o.name="f_width";o.size=4;o.type="text";a.className=t.className="filemanager-f_width";var t=p.appendChild(document.createElement("td"));t.rowSpan=2;var b=t.appendChild(document.createElement("div"));b.style.position="relative";var s=b.appendChild(document.createElement("img"));s.src="/plugins/ImageManager/img/locked.gif";s.width=25;s.height=32;s.alt="Constrain Proportions";s.style.verticalAlign="middle";var o=document.createElement("input");o.type="checkbox";o.name="f_constrain";o.style.position="absolute";o.style.top="8px";o.style.left="0px";o.value="on";o.checked=true;b.appendChild(o);t.className="filemanager-f_constrain";if(h.phpcfg.UseHSpaceVSpace){var a=p.appendChild(document.createElement("th"));var d=a.appendChild(document.createTextNode("Margin:"));var t=p.appendChild(document.createElement("td"));var o=t.appendChild(document.createElement("input"));o.name="f_hspace";o.size=3;o.type="text";t.appendChild(document.createTextNode(" x "));var o=t.appendChild(document.createElement("input"));o.name="f_vspace";o.size=3;o.type="text";t.appendChild(document.createTextNode(" px "));a.className=t.className="filemanager-f_hspace filemanager-f_vspace"}else{var a=p.appendChild(document.createElement("th"));var d=a.appendChild(document.createTextNode("Margin:"));var t=p.appendChild(document.createElement("td"));var o=t.appendChild(document.createElement("input"));o.name="f_margin";o.size=3;o.type="text";t.appendChild(document.createTextNode(" px "));a.className=t.className="filemanager-f_margin"}var p=r.appendChild(document.createElement("tr"));var a=p.appendChild(document.createElement("th"));var d=a.appendChild(document.createTextNode("Height:"));var t=p.appendChild(document.createElement("td"));var o=t.appendChild(document.createElement("input"));o.name="f_height";o.size=4;o.type="text";a.className=t.className="filemanager-f_width";var a=p.appendChild(document.createElement("th"));var d=a.appendChild(document.createTextNode("Padding:"));var t=p.appendChild(document.createElement("td"));var o=t.appendChild(document.createElement("input"));o.name="f_padding";o.size=3;o.type="text";t.appendChild(document.createTextNode(" px "));a.className=t.className="filemanager-f_padding";var a=p.appendChild(document.createElement("th"));var d=a.appendChild(document.createTextNode("Colour:"));var t=p.appendChild(document.createElement("td"));var o=t.appendChild(document.createElement("input"));o.name="f_backgroundColor";o.size=7;o.type="text";new Xinha.colorPicker.InputBinding(o);a.className=t.className="filemanager-f_backgroundColor";var p=r.appendChild(document.createElement("tr"));var a=p.appendChild(document.createElement("th"));var d=a.appendChild(document.createTextNode("Alignment:"));var t=p.appendChild(document.createElement("td"));t.colSpan=2;var o=t.appendChild(document.createElement("select"));o.name="f_align";o.title="Positioning of this image";o.options[0]=new Option("",true,true);o.options[1]=new Option("Left");o.options[2]=new Option("Right");o.options[3]=new Option("Top");o.options[4]=new Option("Middle");o.options[5]=new Option("Bottom");a.className=t.className="filemanager-f_align";var a=p.appendChild(document.createElement("th"));var d=a.appendChild(document.createTextNode("Border:"));var t=p.appendChild(document.createElement("td"));var o=t.appendChild(document.createElement("input"));o.name="f_border";o.size=3;o.type="text";t.appendChild(document.createTextNode(" px "));a.className=t.className="filemanager-f_border";var a=p.appendChild(document.createElement("th"));var d=a.appendChild(document.createTextNode("Colour:"));var t=p.appendChild(document.createElement("td"));var o=t.appendChild(document.createElement("input"));o.name="f_borderColor";o.size=7;o.type="text";new Xinha.colorPicker.InputBinding(o);a.className=t.className="filemanager-f_borderColor";var b=document.createElement("div");var q=document.createElement("h2");q.appendChild(document.createTextNode("Image Attributes"));b.appendChild(q);b.appendChild(c);return b})();e("f_width").onkeyup=function(){if(!e("f_constrain").checked){return true}if(!e("f_width").value){e("f_width").value="";e("f_height").value=""}else{if(e("f_height").value&&h._LastImageDetails){e("f_height").value=h.ScaleImage(h._LastImageDetails,{width:e("f_width").value,height:null}).height}else{if(!h._LastImageDetails){e("f_height").value=""}}}return true};e("f_height").onkeyup=function(){if(!e("f_constrain").checked){return true}if(!e("f_height").value){e("f_width").value="";e("f_height").value=""}else{if(e("f_width").value&&h._LastImageDetails){e("f_width").value=h.ScaleImage(h._LastImageDetails,{width:null,height:e("f_height").value}).width}else{if(!h._LastImageDetails){e("f_width").value=""}}}return true};e("f_constrain").onclick=function(){if(this.checked&&e("f_width").value&&e("f_height").value){var a=h.ScaleImage(h._LastImageDetails,{width:e("f_width").value,height:e("f_height").value});e("f_width").value=a.width;e("f_height").value=a.height}}}if(this.current_attributes){e("f_alt").value=this.current_attributes.f_alt;e("f_border").value=this.current_attributes.f_border;f("f_align",this.current_attributes.f_align);e("f_padding").value=this.current_attributes.f_padding;if(e("f_margin")){e("f_margin").value=this.current_attributes.f_margin}e("f_backgroundColor").value=this.current_attributes.f_backgroundColor;e("f_borderColor").value=this.current_attributes.f_borderColor;if(e("f_hspace")){e("f_hspace").value=this.current_attributes.f_hspace}if(e("f_vspace")){e("f_vspace").value=this.current_attributes.f_vspace}e("f_width").value=this.current_attributes.f_width?this.current_attributes.f_width:"";e("f_height").value=this.current_attributes.f_height?this.current_attributes.f_height:"";this.current_attributes=null}if(!g){var g={f_alt:e("f_alt").value,f_border:e("f_border").value,f_align:e("f_align").options[e("f_align").selectedIndex].value,f_padding:e("f_padding").value,f_margin:e("f_margin")?e("f_margin").value:null,f_backgroundColor:e("f_backgroundColor").value,f_borderColor:e("f_borderColor").value,f_hspace:e("f_hspace")?e("f_hspace").value:null,f_vspace:e("f_vspace")?e("f_vspace").value:null,f_width:e("f_width").value,f_height:e("f_height").value,table:this._ImageManagerAttributesTable};return g}if((e("f_width").value&&e("f_width").value!=g.width)||(e("f_height").value&&e("f_height").value!=g.height)){new Dialog("This image is a different size, would you like to use the new size?",{language:{confirm:"Shrink/Grow To Fit",decline:"Fullsize"},buttons:["confirm","decline"],onConfirm:function(){if(e("f_constrain").checked){var a=h.ScaleImage(g,{width:e("f_width").value,height:e("f_height").value});e("f_width").value=e("f_width").value?a.width:"";e("f_height").value=e("f_height").value?a.height:""}},onDecline:function(){e("f_width").value="";e("f_height").value=""}})}e("f_align").style.visibility="";return this._ImageManagerAttributesTable};MootoolsFileManager.prototype.ImageManagerReturn=function(m,t){var l=this.editor;var n=this;var r=this.current_image;var s=n.ImageManagerAttributes();s.f_url=m;var q=r;if(!q){if(Xinha.is_ie){var k=l._getSelection();var p=l._createRange(k);l._doc.execCommand("insertimage",false,s.f_url);q=p.parentElement();if(q.tagName.toLowerCase()!="img"){q=q.previousSibling}}else{q=document.createElement("img");q.src=s.f_url;l.insertNodeAtSelection(q)}}else{q.src=s.f_url}for(field in s){var o=s[field];switch(field){case"f_alt":q.alt=o;break;case"f_border":if(o.length){q.style.borderWidth=/[^0-9]/.test(o)?o:(parseInt(o)+"px");if(q.style.borderWidth&&!q.style.borderStyle){q.style.borderStyle="solid"}}else{q.style.borderWidth="";q.style.borderStyle=""}break;case"f_borderColor":q.style.borderColor=o;break;case"f_backgroundColor":q.style.backgroundColor=o;break;case"f_padding":if(o.length){q.style.padding=/[^0-9]/.test(o)?o:(parseInt(o)+"px")}else{q.style.padding=""}break;case"f_margin":if(o.length){q.style.margin=/[^0-9]/.test(o)?o:(parseInt(o)+"px")}else{q.style.margin=""}break;case"f_align":if(q.align&&q.align!==true){q.align=o}else{q.removeAttribute("align")}break;case"f_width":if(!isNaN(parseInt(o))){q.width=parseInt(o)}else{q.removeAttribute("width")}break;case"f_height":if(!isNaN(parseInt(o))){q.height=parseInt(o)}else{q.removeAttribute("height")}break;case"f_hspace":if(!isNaN(parseInt(o))){q.hspace=parseInt(o)}else{q.removeAttribute("hspace")}break;case"f_vspace":if(!isNaN(parseInt(o))){q.vspace=parseInt(o)}else{q.removeAttribute("vspace")}break}}};