/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
Linker.prototype._createLink=function(p){if(!this._dialog){this._dialog=new Linker.Dialog(this)}if(!p&&this.editor.selectionEmpty(this.editor.getSelection())){alert(this._lc("You must select some text before making a new link."));return false}var j={type:"url",href:"http://www.example.com/",target:"",p_width:"",p_height:"",p_options:["menubar=no","toolbar=yes","location=no","status=no","scrollbars=yes","resizeable=yes"],to:"alice@example.com",subject:"",body:"",anchor:""};if(p&&p.tagName.toLowerCase()=="a"){var m=this.editor.fixRelativeLinks(p.getAttribute("href"));var a=m.match(/^mailto:(.*@[^?&]*)(\?(.*))?$/);var u=m.match(/^#(.*)$/);if(a){j.type="mailto";j.to=a[1];if(a[3]){var r=a[3].split("&");for(var q=0;q<r.length;q++){var t=r[q].match(/(subject|body)=(.*)/);if(t){j[t[1]]=decodeURIComponent(t[2])}}}}else{if(u){j.type="anchor";j.anchor=u[1]}else{if(p.getAttribute("onclick")){var a=p.getAttribute("onclick").match(/window\.open\(\s*this\.href\s*,\s*'([a-z0-9_]*)'\s*,\s*'([a-z0-9_=,]*)'\s*\)/i);j.href=m?m:"";j.target="popup";j.p_name=a[1];j.p_options=[];var r=a[2].split(",");for(var q=0;q<r.length;q++){var s=r[q].match(/(width|height)=([0-9]+)/);if(s){j["p_"+s[1]]=parseInt(s[2])}else{j.p_options.push(r[q])}}}else{j.href=m;j.target=p.target}}}}var i=this;this.a=p;var v=function(){var e=i.a;var c=i._dialog.hide();var d={href:"",target:"",title:"",onclick:""};if(c.type=="url"){if(c.href){d.href=c.href.trim();d.target=c.target;if(c.target=="popup"){if(c.p_width){c.p_options.push("width="+c.p_width)}if(c.p_height){c.p_options.push("height="+c.p_height)}d.onclick="if(window.parent && window.parent.Xinha){return false}window.open(this.href, '"+(c.p_name.replace(/[^a-z0-9_]/i,"_"))+"', '"+c.p_options.join(",")+"');return false;"}}}else{if(c.type=="anchor"){if(c.anchor){d.href=c.anchor.value}}else{if(c.to){d.href="mailto:"+c.to;if(c.subject){d.href+="?subject="+encodeURIComponent(c.subject)}if(c.body){d.href+=(c.subject?"&":"?")+"body="+encodeURIComponent(c.body)}}}}if(d.href){d.href=d.href.trim()}if(e&&e.tagName.toLowerCase()=="a"){if(!d.href){if(confirm(i._dialog._lc("Are you sure you wish to remove this link?"))){var b=e.parentNode;while(e.hasChildNodes()){b.insertBefore(e.removeChild(e.childNodes[0]),e)}b.removeChild(e);i.editor.updateToolbar();return}}else{for(var g in d){e.setAttribute(g,d[g])}if(Xinha.is_ie){if(/mailto:([^?<>]*)(\?[^<]*)?$/i.test(e.innerHTML)){e.innerHTML=RegExp.$1}}}}else{if(!d.href){return true}var h=Xinha.uniq("http://www.example.com/Link");i.editor._doc.execCommand("createlink",false,h);var f=i.editor._doc.getElementsByTagName("a");for(var g=0;g<f.length;g++){var l=f[g];if(l.href==h){if(!e){e=l}for(var k in d){l.setAttribute(k,d[k])}}}}i.editor.selectNodeContents(e);i.editor.updateToolbar()};this._dialog.show(j,v)};Linker.prototype._getSelectedAnchor=function(){var e=this.editor.getSelection();var f=this.editor.createRange(e);var a=this.editor.activeElement(e);if(a!=null&&a.tagName.toLowerCase()=="a"){return a}else{a=this.editor._getFirstAncestor(e,"a");if(a!=null){return a}}return null};Linker.Dialog_dTrees=[];Linker.Dialog=function(d){var c=this;this.Dialog_nxtid=0;this.linker=d;this.id={};this.ready=false;this.dialog=false;this._prepareDialog()};Linker.Dialog.prototype._prepareDialog=function(){var lDialog=this;var linker=this.linker;var files=this.linker.files;if(!linker.lConfig.dialog&&Xinha.Dialog){linker.lConfig.dialog=Xinha.Dialog}var dialog=this.dialog=new linker.lConfig.dialog(linker.editor,Linker.html,"Linker",{width:600,height:400});var dTreeName=Xinha.uniq("dTree_");this.dTree=new dTree(dTreeName,Xinha.getPluginDir("Linker")+"/dTree/");eval(dTreeName+" = this.dTree");this.dTree.add(this.Dialog_nxtid++,-1,linker.lConfig.treeCaption,null,linker.lConfig.treeCaption);this.makeNodes(files,0);var ddTree=this.dialog.getElementById("dTree");ddTree.innerHTML="";ddTree.style.overflow="auto";ddTree.style.height="300px";if(Xinha.is_ie){ddTree.style.styleFloat="left"}else{ddTree.style.cssFloat="left"}ddTree.style.backgroundColor="white";this.ddTree=ddTree;this.dTree._linker_premade=this.dTree.toString();var options=this.dialog.getElementById("options");options.style.width=320+"px";options.style.overflow="auto";this.dialog.rootElem.style.paddingBottom="0";this.dialog.onresize=function(){var h=parseInt(dialog.height)-dialog.getElementById("h1").offsetHeight;var w=parseInt(dialog.width)-330;if(w<0){w=0}if(h<0){h=0}lDialog.ddTree.style.height=h+"px";lDialog.ddTree.style.width=w+"px"};var self=this;this.dialog.getElementById("type_url").onclick=function(){self.showOptionsForType("url")};this.dialog.getElementById("type_mailto").onclick=function(){self.showOptionsForType("mailto")};this.dialog.getElementById("type_anchor").onclick=function(){self.showOptionsForType("anchor")};var hidePopupOptions=function(){self.showOptionsForTarget("none")};this.dialog.getElementById("noTargetRadio").onclick=hidePopupOptions;this.dialog.getElementById("sameWindowRadio").onclick=hidePopupOptions;this.dialog.getElementById("newWindowRadio").onclick=hidePopupOptions;this.dialog.getElementById("popupWindowRadio").onclick=function(){self.showOptionsForTarget("popup")};this.ready=true;ddTree=null;Xinha.freeLater(lDialog,"ddTree");options=null};Linker.Dialog.prototype.makeNodes=function(g,j){for(var i=0;i<g.length;i++){if(typeof g[i]=="string"){this.dTree.add(this.Dialog_nxtid++,j,g[i].replace(/^.*\//,""),"javascript:document.getElementsByName('"+this.dialog.id.href+"')[0].value=decodeURIComponent('"+encodeURIComponent(g[i])+"');document.getElementsByName('"+this.dialog.id.type+"')[0].click();document.getElementsByName('"+this.dialog.id.href+"')[0].focus();void(0);",g[i])}else{if(typeof g[i]=="object"&&g[i]&&typeof g[i].length==="number"){var k=this.Dialog_nxtid++;this.dTree.add(k,j,g[i][0].replace(/^.*\//,""),null,g[i][0]);this.makeNodes(g[i][1],k)}else{if(typeof g[i]=="object"){var k=this.Dialog_nxtid++;if(g[i].title){var l=g[i].title}else{if(g[i].url){var l=g[i].url.replace(/^.*\//,"")}else{var l="no title defined"}}if(g[i].url){var h="javascript:document.getElementsByName('"+this.dialog.id.href+"')[0].value=decodeURIComponent('"+encodeURIComponent(g[i].url)+"');document.getElementsByName('"+this.dialog.id.type+"')[0].click();document.getElementsByName('"+this.dialog.id.href+"')[0].focus();void(0);"}else{var h=""}this.dTree.add(k,j,l,h,l);if(g[i].children){this.makeNodes(g[i].children,k)}}}}}};Linker.Dialog.prototype._lc=Linker.prototype._lc;Linker.Dialog.prototype.show=function(B,z,y){if(!this.ready){var v=this;window.setTimeout(function(){v.show(B,z,y)},100);return}if(this.ddTree.innerHTML==""){this.ddTree.innerHTML=this.dTree._linker_premade}if(!this.linker.lConfig.canSetTarget){this.dialog.getElementById("target_options").style.display="none"}this.showOptionsForType(B.type);this.showOptionsForTarget(B.target);var w=this.dialog.getElementById("anchor");for(var t=w.length;t>=0;t--){w[t]=null}var n=this.linker.editor.getHTML();var i=new Array();var x=n.match(/<a[^>]+name="([^"]+)"/gi);if(x){for(t=0;t<x.length;t++){var C=x[t].match(/name="([^"]+)"/i);if(!i.contains(C[1])){i.push(C[1])}}}x=n.match(/id="([^"]+)"/gi);if(x){for(t=0;t<x.length;t++){C=x[t].match(/id="([^"]+)"/i);if(!i.contains(C[1])){i.push(C[1])}}}for(t=0;t<i.length;t++){var D=new Option(i[t],"#"+i[t],false,(B.anchor==i[t]));w[w.length]=D}if(this.linker.lConfig.disableMailto){this.dialog.getElementById("mailtofieldset").style.display="none"}if(w.length==0||this.linker.lConfig.disableAnchors){this.dialog.getElementById("anchorfieldset").style.display="none";if(this.linker.lConfig.disableMailto){this.dialog.getElementById("type").style.display="none"}}var F=this.linker.lConfig.disableTargetTypes;if(typeof F=="undefined"){F=[]}else{if(typeof F=="string"){F=[F]}}for(var t=0;t<F.length;t++){this.dialog.getElementById(F[t]).style.display="none"}if(F.length==3){if(F.contains("popupWindow")){this.dialog.getElementById("target_options").style.display="none"}else{this.dialog.getElementById("popupWindowRadio").style.display="none";this.showOptionsForTarget("popup")}}var A=new Array();if(!F.contains("noTarget")){A.push("noTargetRadio")}if(!F.contains("sameWindow")){A.push("sameWindowRadio")}if(!F.contains("newWindow")){A.push("newWindowRadio")}if(!F.contains("popupWindow")){A.push("popupWindowRadio")}if(B.href=="http://www.example.com/"&&B.to=="alice@example.com"){this.dialog.getElementById("clear").style.display="none"}else{var m=this.dialog.getElementById("clear");m.style.display="";if(z){m.onclick=function(){v.removeLink(z)}}}if(!this.linker.lConfig.canRemoveLink){this.dialog.getElementById("clear").style.display="none"}var E=this.dialog;var v=this;if(z){this.dialog.getElementById("ok").onclick=z}else{this.dialog.getElementById("ok").onclick=function(){v.hide()}}if(y){this.dialog.getElementById("cancel").onclick=y}else{this.dialog.getElementById("cancel").onclick=function(){v.hide()}}this.linker.editor.disableToolbar(["fullscreen","linker"]);this.dialog.show(B);var u=false;for(var t=0;t<A.length;t++){if(this.dialog.getElementById(A[t]).checked==true){u=true;break}}if(!u&&A.length>0){this.dialog.getElementById(A[0]).checked=true}this.dialog.onresize()};Linker.Dialog.prototype.hide=function(){this.linker.editor.enableToolbar();return this.dialog.hide()};Linker.Dialog.prototype.removeLink=function(b){this.dialog.getElementById("href").value="";this.dialog.getElementById("to").value="";return b()};Linker.Dialog.prototype.showOptionsForType=function(g){var f=this.dialog.getElementById("urltable");var e=this.dialog.getElementById("mailtable");var h=this.dialog.getElementById("anchortable");if(g=="anchor"){h.style.display="";f.style.display="none";e.style.display="none"}else{if(g=="mailto"){e.style.display="";f.style.display="none";h.style.display="none"}else{f.style.display="";e.style.display="none";h.style.display="none"}}};Linker.Dialog.prototype.showOptionsForTarget=function(c){var d=this.dialog.getElementById("popuptable");d.style.display=c=="popup"?"":"none"};