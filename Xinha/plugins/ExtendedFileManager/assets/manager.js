/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
function comboSelectValue(j,g){var h=j.getElementsByTagName("option");for(var i=h.length;--i>=0;){var c=h[i];c.selected=(c.value==g)}j.value=g}function i18n(b){return Xinha._lc(b,"ExtendedFileManager")}function setAlign(e){var d=document.getElementById("f_align");for(var f=0;f<d.length;f++){if(d.options[f].value==e){d.selectedIndex=f;break}}}function onTargetChanged(){var b=document.getElementById("f_other_target");if(this.value=="_other"){b.style.visibility="visible";b.select();b.focus()}else{b.style.visibility="hidden"}}function init(){if(typeof imgManager=="undefined"){setTimeout(init,10);return}var J=650;var E=600;window.resizeTo(J,E);var K=Xinha.pageSize(window);window.resizeTo(J,E);var F=Xinha.viewportSize(window);window.resizeBy(0,K.y-F.y+5);F=Xinha.viewportSize(window);if(!Xinha.is_ie){var i=opener.screenX+(opener.outerWidth-F.x)/2;var w=opener.screenY+(opener.outerHeight-F.x)/2}else{var i=(self.screen.availWidth-F.x)/2;var w=(self.screen.availHeight-F.y)/2}window.moveTo(i,w);__xinha_dlg_init();__dlg_translate("ExtendedFileManager");var M=document.getElementById("uploadForm");if(M){M.target="imgManager"}var C=window.dialogArguments.editor;var G=window.dialogArguments.param;var D=null;if(manager_mode=="image"&&G){var N=new RegExp("^https?://");if(G.f_url.length>0&&!N.test(G.f_url)&&typeof G.baseHref=="string"){G.f_url=G.baseHref+G.f_url}var y=new RegExp("(https?://[^/]*)?"+base_url.replace(/\/$/,""));G.f_url=G.f_url.replace(y,"");var H=(_resized_dir)?_resized_dir.replace(Xinha.RE_Specials,"\\$1")+"/":"";var x=_resized_prefix.replace(Xinha.RE_Specials,"\\$1");var O=new RegExp("^(.*/)"+H+x+"_([0-9]+)x([0-9]+)_([^/]+)$");var B=G.f_url.match(O);if(O.test(G.f_url)){G.f_url=RegExp.$1+RegExp.$4;G.f_width=RegExp.$2;G.f_height=RegExp.$3}document.getElementById("f_url").value=G.f_url;document.getElementById("f_alt").value=G.f_alt;document.getElementById("f_title").value=G.f_title;document.getElementById("f_border").value=G.f_border;document.getElementById("f_width").value=G.f_width;document.getElementById("f_height").value=G.f_height;document.getElementById("f_margin").value=G.f_margin;document.getElementById("f_padding").value=G.f_padding;document.getElementById("f_borderColor").value=G.f_borderColor;document.getElementById("f_backgroundColor").value=G.f_backgroundColor;setAlign(G.f_align);document.getElementById("f_url").focus();document.getElementById("orginal_width").value=G.f_width;document.getElementById("orginal_height").value=G.f_height;var O=new RegExp("^(.*/)([^/]+)$");if(O.test(G.f_url)){D=RegExp.$1}document.getElementById("f_preview").src=_backend_url+"__function=thumbs&img="+G.f_url}else{if(manager_mode=="link"&&G){var I=document.getElementById("f_target");var N=new RegExp("^https?://");if(G.f_href.length>0&&!N.test(G.f_href)&&typeof G.baseHref=="string"){G.f_href=G.baseHref+G.f_href}var R=new RegExp("(https?://[^/]*)?"+base_url.replace(/\/$/,""));G.f_href=G.f_href.replace(R,"");var O=new RegExp("^(.*/)([^/]+)$");if(O.test(G.f_href)){D=RegExp.$1}else{D=document.cookie.match(/EFMStartDirlink=(.*?)(;|$)/);if(D){D=D[1]}}if(G){if(typeof G.f_href!="undefined"){document.getElementById("f_href").value=G.f_href;document.getElementById("f_title").value=G.f_title;comboSelectValue(I,G.f_target);if(I.value!=G.f_target){var Q=document.createElement("option");Q.value=G.f_target;Q.innerHTML=Q.value;I.appendChild(Q);Q.selected=true}}}if(G.f_usetarget==false||manager_show_target!=false){document.getElementById("f_target_label").style.visibility="hidden";document.getElementById("f_target").style.visibility="hidden";document.getElementById("f_other_target").style.visibility="hidden"}if(I&&G.f_usetarget&&manager_show_target!=false){var Q=document.createElement("option");Q.value="_other";Q.innerHTML=i18n("Other");I.appendChild(Q);I.onchange=onTargetChanged}document.getElementById("f_href").focus()}else{if(!G){D=document.cookie.match(new RegExp("EFMStartDir"+manager_mode+"=(.*?)(;|$)"));if(D){D=D[1]}}}}if(D){iframeUrl+="&dir="+D;var P=document.getElementById("dirPath");for(var h=0;h<P.options.length;h++){if(P.options[h].value==encodeURIComponent(D)){P.options[h].selected=true;break}}}imgManager.location.replace(iframeUrl);if(manager_mode=="image"&&typeof Xinha.colorPicker!="undefined"&&document.getElementById("f_backgroundColor")&&document.getElementById("f_backgroundColor").type=="text"){var L={cellsize:C.config.colorPickerCellSize,granularity:C.config.colorPickerGranularity,websafe:C.config.colorPickerWebSafe,savecolors:C.config.colorPickerSaveColors};new Xinha.colorPicker.InputBinding(document.getElementById("f_backgroundColor"),L);new Xinha.colorPicker.InputBinding(document.getElementById("f_borderColor"),L)}setTimeout(function(){resize();addEvent(window,"resize",resize)},500)}function pasteButton(a){var f=document.getElementById("pasteBtn");if(!f.firstChild){var h=document.createElement("a");h.href="javascript:void(0);";var g=document.createElement("img");g.src=window.opener.Xinha.getPluginDir("ExtendedFileManager")+"/img/edit_paste.gif";g.alt=i18n("Paste");h.appendChild(g);f.appendChild(h)}f.onclick=function(){if(typeof imgManager!="undefined"){imgManager.paste(a)}if(a.action=="moveFile"||a.action=="moveDir"){this.onclick=null;this.removeChild(this.firstChild)}};switch(a.action){case"copyFile":f.firstChild.title=i18n('Copy "$file='+a.file+'$" from "$dir='+decodeURIComponent(a.dir)+'$" here');break;case"copyDir":f.firstChild.title=i18n('Copy folder "$file='+a.file+'$" from "$dir='+decodeURIComponent(a.dir)+'$" here');break;case"moveFile":f.firstChild.title=i18n('Move "$file='+a.file+'$" from "$dir='+decodeURIComponent(a.dir)+'$" here');break;break;case"moveDir":f.firstChild.title=i18n('Move folder "$file='+a.file+'$" from "$dir='+decodeURIComponent(a.dir)+'$" here');break}}function onCancel(){__dlg_close(null);return false}function onOK(){if(manager_mode=="image"){var fields=["f_url","f_alt","f_title","f_align","f_border","f_margin","f_padding","f_height","f_width","f_borderColor","f_backgroundColor"];var param=new Object();for(var i in fields){var id=fields[i];var el=document.getElementById(id);if(id=="f_url"&&el.value.indexOf("://")<0&&el.value){param[id]=makeURL(base_url,el.value)}else{param[id]=el.value}}var origsize={w:document.getElementById("orginal_width").value,h:document.getElementById("orginal_height").value};if((origsize.w!=param.f_width)||(origsize.h!=param.f_height)){var resized=Xinha._geturlcontent(window.opener.Xinha.getPluginDir("ExtendedFileManager")+"/"+_backend_url+"&__function=resizer&img="+encodeURIComponent(document.getElementById("f_url").value)+"&width="+param.f_width+"&height="+param.f_height);resized=eval(resized);if(resized){param.f_url=makeURL(base_url,resized)}}__dlg_close(param);return false}else{if(manager_mode=="link"){var required={};for(var i in required){var el=document.getElementById(i);if(!el.value){alert(required[i]);el.focus();return false}}var fields=["f_href","f_title","f_target"];var param=new Object();for(var i in fields){var id=fields[i];var el=document.getElementById(id);if(id=="f_href"&&el.value.indexOf("://")<0){param[id]=makeURL(base_url,el.value)}else{param[id]=el.value}}if(param.f_target=="_other"){param.f_target=document.getElementById("f_other_target").value}__dlg_close(param);return false}}}function makeURL(c,d){if(c.substring(c.length-1)!="/"){c+="/"}if(d.charAt(0)=="/"){}d=d.substring(1);return c+d}function updateDir(d){var c=d.options[d.selectedIndex].value;changeDir(c)}function goUpDir(){var l=document.getElementById("dirPath");var m=l.options[l.selectedIndex].text;if(m.length<2){return false}var h=m.split("/");var j="";for(var i=0;i<h.length-2;i++){j+=h[i]+"/"}for(var i=0;i<l.length;i++){var k=l.options[i].text;if(k==j){l.selectedIndex=i;var n=l.options[i].value;changeDir(n);break}}}function changeDir(b){if(typeof imgManager!="undefined"){imgManager.changeDir(b)}}function updateView(){refresh()}function toggleConstrains(c){var d=document.getElementById("imgLock");var c=document.getElementById("constrain_prop");if(c.checked){d.src="img/locked.gif";checkConstrains("width")}else{d.src="img/unlocked.gif"}}function checkConstrains(m){var l=document.getElementById("constrain_prop");if(l.checked){var n=document.getElementById("orginal_width");var k=parseInt(n.value);var n=document.getElementById("orginal_height");var o=parseInt(n.value);var p=document.getElementById("f_width");var r=document.getElementById("f_height");var q=parseInt(p.value);var j=parseInt(r.value);if(k>0&&o>0){if(m=="width"&&q>0){r.value=parseInt((q/k)*o)}if(m=="height"&&j>0){p.value=parseInt((j/o)*k)}}}}function showMessage(f){var e=document.getElementById("message");var d=document.getElementById("messages");if(e.firstChild){e.removeChild(e.firstChild)}e.appendChild(document.createTextNode(i18n(f)));d.style.display="block"}function addEvent(e,h,g){if(e.addEventListener){e.addEventListener(h,g,true);return true}else{if(e.attachEvent){var f=e.attachEvent("on"+h,g);return f}else{return false}}}function doUpload(){var b=document.getElementById("uploadForm");if(b){showMessage("Uploading")}}function refresh(){var b=document.getElementById("dirPath");updateDir(b)}function newFolder(){function c(a){var f=document.getElementById("dirPath");var b=f.options[f.selectedIndex].value;if(a==thumbdir){alert(i18n("Invalid folder name, please choose another folder name."));return false}if(a&&a!=""&&typeof imgManager!="undefined"){imgManager.newFolder(b,encodeURI(a))}}if(Xinha.ie_version>6){popupPrompt(i18n("Please enter name for new folder..."),i18n("Untitled"),c,i18n("New Folder"))}else{var d=prompt(i18n("Please enter name for new folder..."),i18n("Untitled"));c(d)}}function resize(){var e=Xinha.viewportSize(window);var d=document.getElementById("messages");var f=(d&&d.style.display!="none")?parseInt(document.getElementById("messages").offsetHeight,10):0;document.getElementById("imgManager").style.height=parseInt(e.y-130-document.getElementById("controls").offsetHeight,10)-f+"px";return true}Xinha.addOnloadHandler(init,window);