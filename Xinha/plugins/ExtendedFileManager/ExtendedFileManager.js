/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
function ExtendedFileManager(g){this.editor=g;var i=g.config;var j=i.toolbar;var h=this;if(i.ExtendedFileManager.use_linker){i.registerButton({id:"linkfile",tooltip:Xinha._lc("Insert File Link","ExtendedFileManager"),image:Xinha.getPluginDir("ExtendedFileManager")+"/img/ed_linkfile.gif",textMode:false,action:function(a){a._linkFile()}});i.addToolbarElement("linkfile","createlink",1)}var k=g.config.ExtendedFileManager.backend+"__function=manager";if(i.ExtendedFileManager.backend_config!=null){k+="&backend_config="+encodeURIComponent(i.ExtendedFileManager.backend_config);k+="&backend_config_hash="+encodeURIComponent(i.ExtendedFileManager.backend_config_hash);k+="&backend_config_secret_key_location="+encodeURIComponent(i.ExtendedFileManager.backend_config_secret_key_location)}if(i.ExtendedFileManager.backend_data!=null){for(var l in i.ExtendedFileManager.backend_data){k+="&"+l+"="+encodeURIComponent(i.ExtendedFileManager.backend_data[l])}}i.ExtendedFileManager.manager=k}ExtendedFileManager._pluginInfo={name:"ExtendedFileManager",version:"1.4",developer:"Afru, Krzysztof Kotowicz, Raimund Meyer",developer_url:"http://xinha.org",license:"htmlArea"};Xinha.Config.prototype.ExtendedFileManager={use_linker:true,backend:Xinha.getPluginDir("ExtendedFileManager")+"/backend.php?__plugin=ExtendedFileManager&",backend_data:null,backend_config:null,backend_config_hash:null,backend_config_secret_key_location:"Xinha:ExtendedFileManager"};if(typeof ImageManager=="undefined"){Xinha.prototype._insertImage=function(f){var d=this;var e={editor:this,param:null};if(typeof f=="undefined"){f=this.getParentElement();if(f&&!/^img$/i.test(f.tagName)){f=null}}if(f){e.param={f_url:Xinha.is_ie?f.src:f.getAttribute("src"),f_alt:f.alt,f_title:f.title,f_border:f.style.borderWidth?f.style.borderWidth:f.border,f_align:f.align,f_width:f.width,f_height:f.height,f_padding:f.style.padding,f_margin:f.style.margin,f_backgroundColor:f.style.backgroundColor,f_borderColor:f.style.borderColor,baseHref:d.config.baseHref};e.param.f_border=shortSize(e.param.f_border);e.param.f_padding=shortSize(e.param.f_padding);e.param.f_margin=shortSize(e.param.f_margin);e.param.f_backgroundColor=convertToHex(e.param.f_backgroundColor);e.param.f_borderColor=convertToHex(e.param.f_borderColor)}Dialog(this.config.ExtendedFileManager.manager,function(i){if(!i){return false}var b=f;if(!b){if(!i.f_url){return false}if(Xinha.is_ie){var j=d.getSelection();var c=d.createRange(j);d._doc.execCommand("insertimage",false,i.f_url);b=c.parentElement();if(b.tagName.toLowerCase()!="img"){b=b.previousSibling}}else{b=document.createElement("img");b.src=i.f_url;d.insertNodeAtSelection(b)}}else{if(!i.f_url){b.parentNode.removeChild(b);d.updateToolbar();return false}else{b.src=i.f_url}}b.alt=b.alt?b.alt:"";for(field in i){var a=i[field];switch(field){case"f_alt":b.alt=a;break;case"f_title":b.title=a;break;case"f_border":if(a){b.style.borderWidth=/[^0-9]/.test(a)?a:(a!="")?(parseInt(a)+"px"):"";if(b.style.borderWidth&&!b.style.borderStyle){b.style.borderStyle="solid"}else{if(!b.style.borderWidth){b.style.border=""}}}break;case"f_borderColor":b.style.borderColor=a;break;case"f_backgroundColor":b.style.backgroundColor=a;break;case"f_align":b.align=a;break;case"f_width":if(parseInt(a)>0){b.width=parseInt(a)}break;case"f_height":if(parseInt(a)>0){b.height=parseInt(a)}break;case"f_padding":b.style.padding=/[^0-9]/.test(a)?a:(a!="")?(parseInt(a)+"px"):"";break;case"f_margin":b.style.margin=/[^0-9]/.test(a)?a:(a!="")?(parseInt(a)+"px"):"";break}}},e)}}Xinha.prototype._linkFile=function(h){var i=this;var k={editor:this,param:null};if(typeof h=="undefined"){h=this.getParentElement();if(h){if(/^img$/i.test(h.tagName)){h=h.parentNode}if(!/^a$/i.test(h.tagName)){h=null}}}if(!h){var l=i.getSelection();var j=i.createRange(l);var g=0;if(Xinha.is_ie){if(l.type=="Control"){g=j.length}else{g=j.compareEndPoints("StartToEnd",j)}}else{g=j.compareBoundaryPoints(j.START_TO_END,j)}if(g==0){alert(Xinha._lc("You must select some text before making a new link.","ExtendedFileManager"));return}k.param={f_href:"",f_title:"",f_target:"",f_usetarget:i.config.makeLinkShowsTarget,baseHref:i.config.baseHref}}else{k.param={f_href:Xinha.is_ie?h.href:h.getAttribute("href"),f_title:h.title,f_target:h.target,f_usetarget:i.config.makeLinkShowsTarget,baseHref:i.config.baseHref}}Dialog(this.config.ExtendedFileManager.manager+"&mode=link",function(e){if(!e){return false}var d=h;if(!d){try{i._doc.execCommand("createlink",false,e.f_href);d=i.getParentElement();var a=i.getSelection();var b=i.createRange(a);if(!Xinha.is_ie){d=b.startContainer;if(!/^a$/i.test(d.tagName)){d=d.nextSibling;if(d==null){d=b.startContainer.parentNode}}}}catch(f){}}else{var c=e.f_href.trim();i.selectNodeContents(d);if(c==""){i._doc.execCommand("unlink",false,null);i.updateToolbar();return false}else{d.href=c}}if(!(d&&/^a$/i.test(d.tagName))){return false}d.target=e.f_target.trim();d.title=e.f_title.trim();i.selectNodeContents(d);i.updateToolbar()},k)};function shortSize(h){if(/ /.test(h)){var e=h.split(" ");var f=true;for(var g=1;g<e.length;g++){if(e[0]!=e[g]){f=false;break}}if(f){h=e[0]}}return h}function convertToHex(g){if(typeof g=="string"&&/, /.test.color){g=g.replace(/, /,",")}if(typeof g=="string"&&/ /.test.color){var e=g.split(" ");var h="";for(var f=0;f<e.length;f++){h+=Xinha._colorToRgb(e[f]);if(f+1<e.length){h+=" "}}return h}return Xinha._colorToRgb(g)};