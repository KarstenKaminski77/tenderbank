/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
Xinha.Config.prototype.TableOperations={showButtons:true};function TableOperations(l){this.editor=l;var n=l.config;var p=TableOperations.btnList;var m=this;n.removeToolbarElement(" inserttable toggleborders ");var o=["linebreak","inserttable","toggleborders"];for(var j=0;j<p.length;++j){var k=p[j];if(!k){if(n.TableOperations.showButtons){o.push("separator")}}else{var i="TO-"+k[0];n.registerButton(i,Xinha._lc(k[2],"TableOperations"),l.imgURL(k[0]+".gif","TableOperations"),false,function(b,a){m.buttonPress(b,a)},k[1]);if(n.TableOperations.showButtons){o.push(i)}}}n.toolbar.push(o);if(typeof PopupWin=="undefined"){Xinha._loadback(_editor_url+"modules/Dialogs/popupwin.js")}if(typeof Xinha.InlineStyler=="undefined"){Xinha._loadback(_editor_url+"modules/InlineStyler/InlineStyler.js")}}TableOperations._pluginInfo={name:"TableOperations",version:"1.0",developer:"Mihai Bazon",developer_url:"http://dynarch.com/mishoo/",c_owner:"Mihai Bazon",sponsor:"Zapatec Inc.",sponsor_url:"http://www.bloki.com",license:"htmlArea"};TableOperations.prototype._lc=function(b){return Xinha._lc(b,"TableOperations")};TableOperations.prototype.getClosest=function(g){var i=this.editor;var j=i.getAllAncestors();var h=null;g=(""+g).toLowerCase();for(var l=0;l<j.length;++l){var k=j[l];if(k.tagName.toLowerCase()==g){h=k;break}}return h};TableOperations.prototype.buttonPress=function(aj,ai){this.editor=aj;var R=Xinha.is_gecko?"<br />":"";function P(c){var a=c.getElementsByTagName("td");for(var b=a.length;--b>=0;){var d=a[b];d.rowSpan=1;d.innerHTML=R}}function ad(g){var f=parseInt(""+g.rowSpan);var a=parseInt(""+g.colSpan);g.rowSpan=1;H=g.parentNode;var d=H.rowIndex;var c=H.parentNode.rows;var e=g.cellIndex;while(--f>0){H=c[++d];var b=aj._doc.createElement("td");b.colSpan=g.colSpan;b.innerHTML=R;H.insertBefore(b,H.cells[e])}aj.forceRedraw();aj.updateToolbar()}function I(d){var a=parseInt(""+d.colSpan);d.colSpan=1;H=d.parentNode;var c=d.nextSibling;while(--a>0){var b=aj._doc.createElement("td");b.rowSpan=d.rowSpan;b.innerHTML=R;H.insertBefore(b,c)}aj.forceRedraw();aj.updateToolbar()}function V(d){var a=parseInt(""+d.colSpan);I(d);var c=d.parentNode.cells;var b=d.cellIndex;while(a-->0){ad(c[b++])}}function ab(b){var a=b.nextSibling;while(a&&a.nodeType!=1){a=a.nextSibling}if(!a){a=b.previousSibling;while(a&&a.nodeType!=1){a=a.previousSibling}}if(!a){a=b.parentNode}aj.selectNodeContents(a)}function ag(c,l,j,r,p){var b=[];var d=[];try{for(N=j;N<j+p;N++){var a=c.rows[N];for(o=l;o<l+r;o++){if(a.cells[o].colSpan>1||a.cells[o].rowSpan>1){V(a.cells[o])}d.push(a.cells[o])}if(d.length>0){b.push(d);d=[]}}}catch(k){alert("Invalid selection");return false}var g=b[0][0].parentNode.rowIndex;var f=b[b.length-1][0].parentNode.rowIndex;var m=b[b.length-1][0].rowSpan;var n="";for(N=0;N<b.length;++N){var d=b[N];for(var o=0;o<d.length;++o){var e=d[o];n+=e.innerHTML;(N||o)&&(e.parentNode.removeChild(e))}}var q=b[0][0];q.innerHTML=n;q.rowSpan=f-g+m;var h=0;for(o=0;o<b[0].length;o++){h+=b[0][o].colSpan}q.colSpan=h;aj.selectNodeContents(q);aj.forceRedraw();aj.focusEditor()}switch(ai){case"TO-row-insert-above":case"TO-row-insert-under":var H=this.getClosest("tr");if(!H){break}var aa=H.cloneNode(true);P(aa);H.parentNode.insertBefore(aa,/under/.test(ai)?H.nextSibling:H);aj.forceRedraw();aj.focusEditor();break;case"TO-row-delete":var H=this.getClosest("tr");if(!H){break}var T=H.parentNode;if(T.rows.length==1){alert(Xinha._lc("Xinha cowardly refuses to delete the last row in table.","TableOperations"));break}ab(H);T.removeChild(H);aj.forceRedraw();aj.focusEditor();aj.updateToolbar();break;case"TO-row-split":var ah=this.getClosest("td");if(!ah){break}ad(ah);break;case"TO-col-insert-before":case"TO-col-insert-after":var ah=this.getClosest("td");if(!ah){break}var ac=ah.parentNode.parentNode.rows;var L=ah.cellIndex;var af=(ah.parentNode.cells.length==L+1);for(var N=ac.length;--N>=0;){var H=ac[N];var O=aj._doc.createElement("td");O.innerHTML=R;if(af&&Xinha.is_ie){H.insertBefore(O)}else{var M=H.cells[L+(/after/.test(ai)?1:0)];H.insertBefore(O,M)}}aj.focusEditor();break;case"TO-col-split":var ah=this.getClosest("td");if(!ah){break}I(ah);break;case"TO-col-delete":var ah=this.getClosest("td");if(!ah){break}var L=ah.cellIndex;if(ah.parentNode.cells.length==1){alert(Xinha._lc("Xinha cowardly refuses to delete the last column in table.","TableOperations"));break}ab(ah);var ac=ah.parentNode.parentNode.rows;for(var N=ac.length;--N>=0;){var H=ac[N];H.removeChild(H.cells[L])}aj.forceRedraw();aj.focusEditor();aj.updateToolbar();break;case"TO-cell-split":var ah=this.getClosest("td");if(!ah){break}V(ah);break;case"TO-cell-insert-before":case"TO-cell-insert-after":var ah=this.getClosest("td");if(!ah){break}var H=ah.parentNode;var O=aj._doc.createElement("td");O.innerHTML=R;H.insertBefore(O,/after/.test(ai)?ah.nextSibling:ah);aj.forceRedraw();aj.focusEditor();break;case"TO-cell-delete":var ah=this.getClosest("td");if(!ah){break}if(ah.parentNode.cells.length==1){alert(Xinha._lc("Xinha cowardly refuses to delete the last cell in row.","TableOperations"));break}ab(ah);ah.parentNode.removeChild(ah);aj.forceRedraw();aj.updateToolbar();break;case"TO-cell-merge":var Q=aj._getSelection();if(!Xinha.is_ie&&Q.rangeCount>1){var X=Q.getRangeAt(0);var ah=X.startContainer.childNodes[X.startOffset];var H=ah.parentNode;var i=ah.cellIndex;var Z=H.rowIndex;var ae=0;var W=Z;var U=0;var Y=0;var S,J;for(N=0;N<Q.rangeCount;N++){X=Q.getRangeAt(N);S=X.startContainer.childNodes[X.startOffset];J=S.parentNode;if(J.rowIndex!=W){W=J.rowIndex;Y=0}Y+=S.colSpan;if(Y>U){U=Y}if(J.rowIndex+S.rowSpan-1>ae){ae=J.rowIndex+S.rowSpan-1}}var G=ae-Z+1;var K=H.parentNode;ag(K,i,Z,U,G)}else{var ah=this.getClosest("td");if(!ah){alert(Xinha._lc("Please click into some cell","TableOperations"));break}var H=ah.parentNode;var i=ah.cellIndex;var Z=H.rowIndex;this.dialogMerge(ag,i,Z)}break;case"TO-table-prop":this.dialogTableProperties();break;case"TO-row-prop":this.dialogRowCellProperties(false);break;case"TO-cell-prop":this.dialogRowCellProperties(true);break;default:alert("Button ["+ai+"] not yet implemented")}};TableOperations.btnList=[["table-prop","table","Table properties"],null,["row-prop","tr","Row properties"],["row-insert-above","tr","Insert row before"],["row-insert-under","tr","Insert row after"],["row-delete","tr","Delete row"],["row-split","td[rowSpan!=1]","Split row"],null,["col-insert-before","td","Insert column before"],["col-insert-after","td","Insert column after"],["col-delete","td","Delete column"],["col-split","td[colSpan!=1]","Split column"],null,["cell-prop","td","Cell properties"],["cell-insert-before","td","Insert cell before"],["cell-insert-after","td","Insert cell after"],["cell-delete","td","Delete cell"],["cell-merge","tr","Merge cells"],["cell-split","td[colSpan!=1,rowSpan!=1]","Split cell"]];TableOperations.prototype.dialogMerge=function(p,i,k){var j=this.getClosest("table");var m=this;var n=this.editor;if(!this.dialogMergeCellsHtml){Xinha._getback(Xinha.getPluginDir("TableOperations")+"/popups/dialogMergeCells.html",function(a){m.dialogMergeCellsHtml=a;m.dialogMerge(p,i,k)});return}if(!this.dialogMergeCells){this.dialogMergeCells=new Xinha.Dialog(n,this.dialogMergeCellsHtml,"TableOperations",{width:400});this.dialogMergeCells.getElementById("cancel").onclick=function(){m.dialogMergeCells.hide()}}var l=this.dialogMergeCells;function o(){l.hide();no_cols=parseInt(l.getElementById("f_cols").value,10)+1;no_rows=parseInt(l.getElementById("f_rows").value,10)+1;p(j,i,k,no_cols,no_rows);return}this.dialogMergeCells.getElementById("ok").onclick=o;this.dialogMergeCells.show();this.dialogMergeCells.getElementById("f_cols").focus()};TableOperations.prototype.dialogTableProperties=function(){var s=this.getClosest("table");var t=this;var n=this.editor;if(!this.dialogTablePropertiesHtml){Xinha._getback(Xinha.getPluginDir("TableOperations")+"/popups/dialogTable.html",function(a){t.dialogTablePropertiesHtml=a;t.dialogTableProperties()});return}if(!this.dialogTable){this.dialogTable=new Xinha.Dialog(n,this.dialogTablePropertiesHtml,"TableOperations",{width:440});this.dialogTable.getElementById("cancel").onclick=function(){t.dialogTable.hide()}}var q=this.dialogTable;var m=new Xinha.InlineStyler(s,this.editor,q);function u(){var b=q.hide();m.applyStyle(b);for(var d in b){if(typeof b[d]=="function"){continue}var c=b[d];if(typeof c=="object"&&c!=null&&c.tagName){c=c.value}switch(d){case"caption":if(/\S/.test(c)){var e=s.getElementsByTagName("caption")[0];if(!e){e=q.editor._doc.createElement("caption");s.insertBefore(e,s.firstChild)}e.innerHTML=c}else{var e=s.getElementsByTagName("caption")[0];if(e){e.parentNode.removeChild(e)}}break;case"summary":s.summary=c;break;case"align":s.align=c;break;case"spacing":s.cellSpacing=c;break;case"padding":s.cellPadding=c;break;case"borders":s.border=c;break;case"frames":s.frame=c;break;case"rules":s.rules=c;break}}t.editor.forceRedraw();t.editor.focusEditor();t.editor.updateToolbar();var a=s.style.borderCollapse;s.style.borderCollapse="collapse";s.style.borderCollapse="separate";s.style.borderCollapse=a}var p=m.createStyleLayoutFieldset();var o=q.getElementById("TO_layout");o.replaceChild(p,o.firstChild);var w=m.createStyleFieldset();o=q.getElementById("TO_style");o.replaceChild(w,o.firstChild);this.dialogTable.getElementById("ok").onclick=u;var v={};var x=s.getElementsByTagName("caption")[0];if(x){v.caption=x.innerHTML}else{v.caption=""}v.summary=s.summary;v.spacing=s.cellSpacing;v.padding=s.cellPadding;var r=s.border;v.frames=s.frame;v.rules=s.rules;this.dialogTable.show(v)};TableOperations.prototype.dialogRowCellProperties=function(s){var v=this.getClosest(s?"td":"tr");var p=this.getClosest("table");var q=this;var l=this.editor;if(!q.dialogRowCellPropertiesHtml){Xinha._getback(Xinha.getPluginDir("TableOperations")+"/popups/dialogRowCell.html",function(a){q.dialogRowCellPropertiesHtml=a;q.dialogRowCellProperties(s)});return}if(!this.dialogRowCell){this.dialogRowCell=new Xinha.Dialog(l,q.dialogRowCellPropertiesHtml,"TableOperations",{width:440});this.dialogRowCell.getElementById("cancel").onclick=function(){q.dialogRowCell.hide()}}var n=this.dialogRowCell;n.getElementById("title").innerHTML=s?Xinha._lc("Cell Properties","TableOperations"):Xinha._lc("Row Properties","TableOperations");var u=new Xinha.InlineStyler(v,q.editor,n);function r(){var b=n.hide();u.applyStyle(b);q.editor.forceRedraw();q.editor.focusEditor();q.editor.updateToolbar();var a=p.style.borderCollapse;p.style.borderCollapse="collapse";p.style.borderCollapse="separate";p.style.borderCollapse=a}var o=u.createStyleLayoutFieldset();var m=n.getElementById("TO_layout");m.replaceChild(o,m.firstChild);var t=u.createStyleFieldset();m=n.getElementById("TO_style");m.replaceChild(t,m.firstChild);this.dialogRowCell.getElementById("ok").onclick=r;this.dialogRowCell.show()};