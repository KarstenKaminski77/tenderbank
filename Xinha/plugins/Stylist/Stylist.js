/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
Xinha.Config.prototype.css_style={};Xinha.Config.prototype.stylistLoadStylesheet=function(h,k,l){if(!k){k={}}var i=Xinha.ripStylesFromCSSFile(h,l);for(var g in i){if(k[g]){this.css_style[g]=k[g]}else{this.css_style[g]=i[g]}}for(var j=0;j<this.pageStyleSheets.length;j++){if(this.pageStyleSheets[j]==h){return}}this.pageStyleSheets[this.pageStyleSheets.length]=h};Xinha.Config.prototype.stylistLoadStyles=function(i,k,l,g){if(!k){k={}}var j=Xinha.ripStylesFromCSSString(i,l);for(var h in j){if(k[h]){this.css_style[h]=k[h]}else{this.css_style[h]=j[h]}}this.pageStyle+=i};Xinha.prototype._fillStylist=function(){if(!this.plugins.Stylist.instance.dialog){return false}var n=this.plugins.Stylist.instance.dialog.main;n.innerHTML="";var y=true;var r=this._getSelection();var t=this._activeElement(r);for(var w in this.config.css_style){var v=null;var u=w.trim();var z=true;var p=t;if(z&&/[^a-zA-Z0-9_.-]/.test(u)){z=false}if(u.indexOf(".")<0){z=false}if(z&&(u.indexOf(".")>0)){v=u.substring(0,u.indexOf(".")).toLowerCase();u=u.substring(u.indexOf("."),u.length);if(t!=null&&t.tagName.toLowerCase()==v){z=true;p=t}else{if(this._getFirstAncestor(this._getSelection(),[v])!=null){z=true;p=this._getFirstAncestor(this._getSelection(),[v])}else{if((v=="div"||v=="span"||v=="p"||(v.substr(0,1)=="h"&&v.length==2&&v!="hr"))){if(!this._selectionEmpty(this._getSelection())){z=true;p="new"}else{p=this._getFirstAncestor(r,["p","h1","h2","h3","h4","h5","h6","h7"]);if(p!=null){z=true}else{z=false}}}else{z=false}}}}if(z){u=u.substring(u.indexOf("."),u.length);u=u.replace("."," ");if(p==null){if(this._selectionEmpty(this._getSelection())){p=this._getFirstAncestor(this._getSelection(),null)}else{p="new";v="span"}}}var o=(this._ancestorsWithClasses(r,v,u).length>0?true:false);var q=this._ancestorsWithClasses(r,v,u);if(z){var x=document.createElement("a");x.onfocus=function(){this.blur()};x._stylist_className=u.trim();x._stylist_applied=o;x._stylist_appliedTo=q;x._stylist_applyTo=p;x._stylist_applyTag=v;x.innerHTML=this.config.css_style[w];x.href="javascript:void(0)";var s=this;x.onclick=function(){if(this._stylist_applied==true){s._stylistRemoveClasses(this._stylist_className,this._stylist_appliedTo)}else{s._stylistAddClasses(this._stylist_applyTo,this._stylist_applyTag,this._stylist_className)}return false};x.style.display="block";x.style.paddingLeft="3px";x.style.paddingTop="1px";x.style.paddingBottom="1px";x.style.textDecoration="none";if(o){x.style.background="Highlight";x.style.color="HighlightText"}x.style.position="relative";n.appendChild(x)}}};Xinha.prototype._stylistAddClasses=function(f,h,g){if(f=="new"){this.insertHTML("<"+h+' class="'+g+'">'+this.getSelectedHTML()+"</"+h+">")}else{if(h!=null&&f.tagName.toLowerCase()!=h){var e=this.switchElementTag(f,h);if(typeof f._stylist_usedToBe!="undefined"){e._stylist_usedToBe=f._stylist_usedToBe;e._stylist_usedToBe[e._stylist_usedToBe.length]={tagName:f.tagName,className:f.getAttribute("class")}}else{e._stylist_usedToBe=[{tagName:f.tagName,className:f.getAttribute("class")}]}Xinha.addClasses(e,g)}else{Xinha._addClasses(f,g)}}this.focusEditor();this.updateToolbar()};Xinha.prototype._stylistRemoveClasses=function(f,e){for(var d=0;d<e.length;d++){this._stylistRemoveClassesFull(e[d],f)}this.focusEditor();this.updateToolbar()};Xinha.prototype._stylistRemoveClassesFull=function(r,p){if(r!=null){var o=r.className.trim().split(" ");var x=[];var u=p.split(" ");for(var w=0;w<o.length;w++){var t=false;for(var i=0;t==false&&i<u.length;i++){if(u[i]==o[w]){t=true}}if(t==false){x[x.length]=o[w]}}if(x.length==0&&r._stylist_usedToBe&&r._stylist_usedToBe.length>0&&r._stylist_usedToBe[r._stylist_usedToBe.length-1].className!=null){var s=r._stylist_usedToBe[r._stylist_usedToBe.length-1];var v=Xinha.arrayFilter(s.className.trim().split(" "),function(a){if(a==null||a.trim()==""){return false}return true});if((x.length==0)||(Xinha.arrayContainsArray(x,v)&&Xinha.arrayContainsArray(v,x))){r=this.switchElementTag(r,s.tagName);x=v}else{r._stylist_usedToBe=[]}}if(x.length>0||r.tagName.toLowerCase()!="span"||(r.id&&r.id!="")){r.className=x.join(" ").trim()}else{var q=r.parentNode;var n;while(r.hasChildNodes()){if(r.firstChild.nodeType==1){this._stylistRemoveClassesFull(r.firstChild,p)}n=r.removeChild(r.firstChild);q.insertBefore(n,r)}q.removeChild(r)}}};Xinha.prototype.switchElementTag=function(l,h){var g=l.parentNode;var k=this._doc.createElement(h);if(Xinha.is_ie||l.hasAttribute("id")){k.setAttribute("id",l.getAttribute("id"))}if(Xinha.is_ie||l.hasAttribute("style")){k.setAttribute("style",l.getAttribute("style"))}var i=l.childNodes;for(var j=0;j<i.length;j++){k.appendChild(i[j].cloneNode(true))}g.insertBefore(k,l);k._stylist_usedToBe=[l.tagName];g.removeChild(l);this.selectNodeContents(k);return k};Xinha.prototype._getAncestorsClassNames=function(f){var g=this._activeElement(f);if(g==null){g=(Xinha.is_ie?this._createRange(f).parentElement():this._createRange(f).commonAncestorContainer)}var j=[];while(g){if(g.nodeType==1){var h=g.className.trim().split(" ");for(var i=0;i<h.length;i++){j[j.length]=h[i]}if(g.tagName.toLowerCase()=="body"){break}if(g.tagName.toLowerCase()=="table"){break}}g=g.parentNode}return j};Xinha.prototype._ancestorsWithClasses=function(o,p,i){var s=[];var n=this._activeElement(o);if(n==null){try{n=(Xinha.is_ie?this._createRange(o).parentElement():this._createRange(o).commonAncestorContainer)}catch(t){return s}}var u=i.trim().split(" ");while(n){if(n.nodeType==1&&n.className){if(p==null||n.tagName.toLowerCase()==p){var i=n.className.trim().split(" ");var q=true;for(var v=0;v<u.length;v++){var e=false;for(var r=0;r<i.length;r++){if(u[v]==i[r]){e=true;break}}if(!e){q=false;break}}if(q){s[s.length]=n}}if(n.tagName.toLowerCase()=="body"){break}if(n.tagName.toLowerCase()=="table"){break}}n=n.parentNode}return s};Xinha.ripStylesFromCSSFile=function(d,e){var f=Xinha._geturlcontent(d);return Xinha.ripStylesFromCSSString(f,e,d)};Xinha.ripStylesFromCSSString=function(o,q,p){if(!q){if(!p){p=_editor_url+"Xinha.css"}var r={};function k(b,g){r[g]=true;var f="@import\\s*(url\\()?[\"'](.*)[\"'].*";var h=b.match(new RegExp(f,"ig"));var e,d,a=new RegExp(f,"i");if(h){var i=g.replace(/\?.*$/,"").split("/");i.pop();i=i.join("/");for(var c=0;c<h.length;c++){e=h[c].match(a);d=e[2];if(!d.match(/^([^:]+\:)?\//)){d=Xinha._resolveRelativeUrl(i,d)}if(r[d]){continue}b+=k(Xinha._geturlcontent(d),d)}}return b}o=k(o,p)}var l=/\/\*(.|\r|\n)*?\*\//g;var j=/\{(.|\r|\n)*?\}/g;o=o.replace(l,"");o=o.replace(j,",");o=o.split(",");var m={};for(var n=0;n<o.length;n++){if(o[n].trim()){m[o[n].trim()]=o[n].trim()}}return m};function Stylist(d,f){this.editor=d;var e=this}Stylist._pluginInfo={name:"Stylist",version:"1.0",developer:"James Sleeman",developer_url:"http://www.gogo.co.nz/",c_owner:"Gogo Internet Services",license:"HTMLArea",sponsor:"Gogo Internet Services",sponsor_url:"http://www.gogo.co.nz/"};Stylist.prototype.onGenerateOnce=function(){var b=this.editor.config;if(typeof b.css_style!="undefined"&&Xinha.objectProperties(b.css_style).length!=0){this._prepareDialog()}};Stylist.prototype._prepareDialog=function(){var h=this.editor;var k=this;var l="<h1><l10n>Styles</l10n></h1>";this.dialog=new Xinha.Dialog(h,l,"Stylist",{width:200},{modal:false,closable:false});Xinha._addClass(this.dialog.rootElem,"Stylist");this.dialog.attachToPanel("right");this.dialog.show();var g=this.dialog;var j=this.dialog.main;var i=this.dialog.captionBar;j.style.overflow="auto";j.style.height=this.editor._framework.ed_cell.offsetHeight-i.offsetHeight+"px";h.notifyOn("modechange",function(a,b){if(!g.attached){return}switch(b.mode){case"text":g.hide();break;case"wysiwyg":g.show();break}});h.notifyOn("panel_change",function(b,a){if(!g.attached){return}switch(a.action){case"show":var c=j.offsetHeight-a.panel.offsetHeight;j.style.height=((c>0)?j.offsetHeight-a.panel.offsetHeight:0)+"px";g.rootElem.style.height=i.offsetHeight+"px";h.sizeEditor();break;case"hide":k.resize();break}});h.notifyOn("before_resize",function(){if(!g.attached){return}g.rootElem.style.height=i.offsetHeight+"px"});h.notifyOn("resize",function(){if(!g.attached){return}k.resize()})};Stylist.prototype.resize=function(){var g=this.editor;var j=this.dialog.rootElem;if(j.style.display=="none"){return}var h=j.parentNode;var i=h.offsetHeight;for(var f=0;f<h.childNodes.length;++f){if(h.childNodes[f]==j||!h.childNodes[f].offsetHeight){continue}i-=h.childNodes[f].offsetHeight}j.style.height=i-5+"px";this.dialog.main.style.height=i-this.dialog.captionBar.offsetHeight-5+"px"};Stylist.prototype.onUpdateToolbar=function(){if(this.dialog){if(this._timeoutID){window.clearTimeout(this._timeoutID)}var b=this.editor;this._timeoutID=window.setTimeout(function(){b._fillStylist()},250)}};