/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
/* The URL of the most recent uncompressed version of this file is http://svn.xinha.org/trunk/XinhaCore.js */
  /*--------------------------------------------------------------------------
    --  Xinha (is not htmlArea) - http://xinha.org
    --
    --  Use of Xinha is granted by the terms of the htmlArea License (based on
    --  BSD license)  please read license.txt in this package for details.
    --
    --  Copyright (c) 2005-2014 Xinha Developer Team and contributors
    --  
    --  Xinha was originally based on work by Mihai Bazon which is:
    --      Copyright (c) 2003-2004 dynarch.com.
    --      Copyright (c) 2002-2003 interactivetools.com, inc.
    --      This copyright notice MUST stay intact for use.
    -------------------------------------------------------------------------*/

Xinha.version={Release:"Trunk",Head:"$HeadURL: http://svn.xinha.org/trunk/XinhaCore.js $".replace(/^[^:]*:\s*(.*)\s*\$$/,"$1"),Date:"$LastChangedDate: 2010-05-12 09:40:06 +1200 (Wed, 12 May 2010) $".replace(/^[^:]*:\s*([0-9\-]*) ([0-9:]*) ([+0-9]*) \((.*)\)\s*\$/,"$4 $2 $3"),Revision:"$LastChangedRevision: 1263 $".replace(/^[^:]*:\s*(.*)\s*\$$/,"$1"),RevisionBy:"$LastChangedBy: gogo $".replace(/^[^:]*:\s*(.*)\s*\$$/,"$1")};Xinha._resolveRelativeUrl=function(g,h){if(h.match(/^([^:]+\:)?\/\//)){return h}else{var b=g.split("/");if(b[b.length-1]===""){b.pop()}var f=h.split("/");if(f[0]=="."){f.shift()}while(f[0]==".."){b.pop();f.shift()}return b.join("/")+"/"+f.join("/")}};if(typeof _editor_url=="string"){_editor_url=_editor_url.replace(/\x2f*$/,"/");if(!_editor_url.match(/^([^:]+\:)?\//)){(function(){var b=window.location.toString().replace(/\?.*$/,"").split("/");b.pop();_editor_url=Xinha._resolveRelativeUrl(b.join("/"),_editor_url)})()}}else{alert("WARNING: _editor_url is not set!  You should set this variable to the editor files path; it should preferably be an absolute path, like in '/xinha/', but it can be relative if you prefer.  Further we will try to load the editor files correctly but we'll probably fail.");_editor_url=""}if(typeof _editor_lang=="string"){_editor_lang=_editor_lang.toLowerCase()}else{_editor_lang="en"}if(typeof _editor_skin!=="string"){_editor_skin=""}if(typeof _editor_icons!=="string"){_editor_icons=""}var __xinhas=[];Xinha.agt=navigator.userAgent.toLowerCase();Xinha.is_ie=((Xinha.agt.indexOf("msie")!=-1)&&(Xinha.agt.indexOf("opera")==-1));Xinha.ie_version=parseFloat(Xinha.agt.substring(Xinha.agt.indexOf("msie")+5));Xinha.is_opera=(Xinha.agt.indexOf("opera")!=-1);if(Xinha.is_opera&&Xinha.agt.match(/opera[\/ ]([0-9.]+)/)){Xinha.opera_version=parseFloat(RegExp.$1)}else{Xinha.opera_version=0}Xinha.is_khtml=(Xinha.agt.indexOf("khtml")!=-1);Xinha.is_webkit=(Xinha.agt.indexOf("applewebkit")!=-1);Xinha.webkit_version=parseInt(navigator.appVersion.replace(/.*?AppleWebKit\/([\d]).*?/,"$1"),10);Xinha.is_safari=(Xinha.agt.indexOf("safari")!=-1);Xinha.is_chrome=(Xinha.agt.indexOf("chrome")!=-1);Xinha.is_mac=(Xinha.agt.indexOf("mac")!=-1);Xinha.is_mac_ie=(Xinha.is_ie&&Xinha.is_mac);Xinha.is_win_ie=(Xinha.is_ie&&!Xinha.is_mac);Xinha.is_gecko=(navigator.product=="Gecko")||Xinha.is_opera;Xinha.is_real_gecko=(navigator.product=="Gecko"&&!Xinha.is_webkit);Xinha.is_ff2=Xinha.is_real_gecko&&parseInt(navigator.productSub.substr(0,10),10)<20071210;Xinha.isRunLocally=document.URL.toLowerCase().search(/^file:/)!=-1;Xinha.is_designMode=(typeof document.designMode!="undefined"&&!Xinha.is_ie);Xinha.checkSupportedBrowser=function(){return Xinha.is_real_gecko||(Xinha.is_opera&&Xinha.opera_version>=9.2)||Xinha.ie_version>=5.5||Xinha.webkit_version>=522};Xinha.isSupportedBrowser=Xinha.checkSupportedBrowser();if(Xinha.isRunLocally&&Xinha.isSupportedBrowser){alert('Xinha *must* be installed on a web server. Locally opened files (those that use the "file://" protocol) cannot properly function. Xinha will try to initialize but may not be correctly loaded.')}function Xinha(e,f){if(!Xinha.isSupportedBrowser){return}if(!e){throw new Error("Tried to create Xinha without textarea specified.")}if(typeof f=="undefined"){this.config=new Xinha.Config()}else{this.config=f}if(typeof e!="object"){e=Xinha.getElementById("textarea",e)}this._textArea=e;this._textArea.spellcheck=false;Xinha.freeLater(this,"_textArea");this._initial_ta_size={w:e.style.width?e.style.width:(e.offsetWidth?(e.offsetWidth+"px"):(e.cols+"em")),h:e.style.height?e.style.height:(e.offsetHeight?(e.offsetHeight+"px"):(e.rows+"em"))};if(document.getElementById("loading_"+e.id)||this.config.showLoading){if(!document.getElementById("loading_"+e.id)){Xinha.createLoadingMessage(e)}this.setLoadingMessage(Xinha._lc("Constructing object"))}this._editMode="wysiwyg";this.plugins={};this._timerToolbar=null;this._timerUndo=null;this._undoQueue=[this.config.undoSteps];this._undoPos=-1;this._customUndo=true;this._mdoc=document;this.doctype="";this.__htmlarea_id_num=__xinhas.length;__xinhas[this.__htmlarea_id_num]=this;this._notifyListeners={};var g={right:{on:true,container:document.createElement("td"),panels:[]},left:{on:true,container:document.createElement("td"),panels:[]},top:{on:true,container:document.createElement("td"),panels:[]},bottom:{on:true,container:document.createElement("td"),panels:[]}};for(var h in g){if(!g[h].container){continue}g[h].div=g[h].container;g[h].container.className="panels panels_"+h;Xinha.freeLater(g[h],"container");Xinha.freeLater(g[h],"div")}this._panels=g;this._statusBar=null;this._statusBarTree=null;this._statusBarTextMode=null;this._statusBarItems=[];this._framework={};this._htmlArea=null;this._iframe=null;this._doc=null;this._toolBar=this._toolbar=null;this._toolbarObjects={};this.plugins.Events={name:"Events",developer:"The Xinha Core Developer Team",instance:f.Events}}Xinha.onload=function(){};Xinha.init=function(){Xinha.onload()};Xinha.RE_tagName=/(<\/|<)\s*([^ \t\n>]+)/ig;Xinha.RE_doctype=/(<!doctype((.|\n)*?)>)\n?/i;Xinha.RE_head=/<head>((.|\n)*?)<\/head>/i;Xinha.RE_body=/<body[^>]*>((.|\n|\r|\t)*?)<\/body>/i;Xinha.RE_Specials=/([\/\^$*+?.()|{}\[\]])/g;Xinha.escapeStringForRegExp=function(b){return b.replace(Xinha.RE_Specials,"\\$1")};Xinha.RE_email=/^[_a-z\d\-\.]{3,}@[_a-z\d\-]{2,}(\.[_a-z\d\-]{2,})+$/i;Xinha.RE_url=/(https?:\/\/)?(([a-z0-9_]+:[a-z0-9_]+@)?[a-z0-9_\-]{2,}(\.[a-z0-9_\-]{2,}){2,}(:[0-9]+)?(\/\S+)*)/i;Xinha.Config=function(){this.version=Xinha.version.Revision;this.width="auto";this.height="auto";this.sizeIncludesBars=true;this.sizeIncludesPanels=true;this.panel_dimensions={left:"200px",right:"200px",top:"100px",bottom:"100px"};this.iframeWidth=null;this.statusBar=true;this.htmlareaPaste=false;this.mozParaHandler="best";this.getHtmlMethod="DOMwalk";this.undoSteps=20;this.undoTimeout=500;this.changeJustifyWithDirection=false;this.fullPage=false;this.pageStyle="";this.pageStyleSheets=[];this.baseHref=null;this.expandRelativeUrl=true;this.stripBaseHref=true;this.stripSelfNamedAnchors=true;this.only7BitPrintablesInURLs=true;this.sevenBitClean=false;this.specialReplacements={};this.inwardHtml=function(a){return a};this.outwardHtml=function(a){return a};this.autofocus=false;this.killWordOnPaste=true;this.makeLinkShowsTarget=true;this.charSet=(typeof document.characterSet!="undefined")?document.characterSet:document.charset;this.browserQuirksMode=null;this.imgURL="images/";this.popupURL="popups/";this.htmlRemoveTags=null;this.flowToolbars=true;this.toolbarAlign="left";this.showFontStylesInToolbar=false;this.showLoading=false;this.stripScripts=true;this.convertUrlsToLinks=true;this.colorPickerCellSize="6px";this.colorPickerGranularity=18;this.colorPickerPosition="bottom,right";this.colorPickerWebSafe=false;this.colorPickerSaveColors=20;this.fullScreen=false;this.fullScreenMargins=[0,0,0,0];this.fullScreenSizeDownMethod="initSize";this.toolbar=[["popupeditor"],["separator","formatblock","fontname","fontsize","bold","italic","underline","strikethrough"],["separator","forecolor","hilitecolor","textindicator"],["separator","subscript","superscript"],["linebreak","separator","justifyleft","justifycenter","justifyright","justifyfull"],["separator","insertorderedlist","insertunorderedlist","outdent","indent"],["separator","inserthorizontalrule","createlink","insertimage","inserttable"],["linebreak","separator","undo","redo","selectall","print"],(Xinha.is_gecko?[]:["cut","copy","paste","overwrite","saveas"]),["separator","killword","clearfonts","removeformat","toggleborders","splitblock","lefttoright","righttoleft"],["separator","htmlmode","showhelp","about"]];this.fontname={"&#8212; font &#8212;":"",Arial:"arial,helvetica,sans-serif","Courier New":"courier new,courier,monospace",Georgia:"georgia,times new roman,times,serif",Tahoma:"tahoma,arial,helvetica,sans-serif","Times New Roman":"times new roman,times,serif",Verdana:"verdana,arial,helvetica,sans-serif",impact:"impact",WingDings:"wingdings"};this.fontsize={"&#8212; size &#8212;":"","1 (8 pt)":"1","2 (10 pt)":"2","3 (12 pt)":"3","4 (14 pt)":"4","5 (18 pt)":"5","6 (24 pt)":"6","7 (36 pt)":"7"};this.formatblock={"&#8212; format &#8212;":"","Heading 1":"h1","Heading 2":"h2","Heading 3":"h3","Heading 4":"h4","Heading 5":"h5","Heading 6":"h6",Normal:"p",Address:"address",Formatted:"pre"};this.dialogOptions={centered:true,greyout:true,closeOnEscape:true};this.Events={};this.customSelects={};this.debug=false;this.URIs={blank:_editor_url+"popups/blank.html",link:_editor_url+"modules/CreateLink/link.html",insert_image:_editor_url+"modules/InsertImage/insert_image.html",insert_table:_editor_url+"modules/InsertTable/insert_table.html",select_color:_editor_url+"popups/select_color.html",help:_editor_url+"popups/editor_help.html"};this.btnList={bold:["Bold",Xinha._lc({key:"button_bold",string:["ed_buttons_main.png",3,2]},"Xinha"),false,function(a){a.execCommand("bold")}],italic:["Italic",Xinha._lc({key:"button_italic",string:["ed_buttons_main.png",2,2]},"Xinha"),false,function(a){a.execCommand("italic")}],underline:["Underline",Xinha._lc({key:"button_underline",string:["ed_buttons_main.png",2,0]},"Xinha"),false,function(a){a.execCommand("underline")}],strikethrough:["Strikethrough",Xinha._lc({key:"button_strikethrough",string:["ed_buttons_main.png",3,0]},"Xinha"),false,function(a){a.execCommand("strikethrough")}],subscript:["Subscript",Xinha._lc({key:"button_subscript",string:["ed_buttons_main.png",3,1]},"Xinha"),false,function(a){a.execCommand("subscript")}],superscript:["Superscript",Xinha._lc({key:"button_superscript",string:["ed_buttons_main.png",2,1]},"Xinha"),false,function(a){a.execCommand("superscript")}],justifyleft:["Justify Left",["ed_buttons_main.png",0,0],false,function(a){a.execCommand("justifyleft")}],justifycenter:["Justify Center",["ed_buttons_main.png",1,1],false,function(a){a.execCommand("justifycenter")}],justifyright:["Justify Right",["ed_buttons_main.png",1,0],false,function(a){a.execCommand("justifyright")}],justifyfull:["Justify Full",["ed_buttons_main.png",0,1],false,function(a){a.execCommand("justifyfull")}],orderedlist:["Ordered List",["ed_buttons_main.png",0,3],false,function(a){a.execCommand("insertorderedlist")}],unorderedlist:["Bulleted List",["ed_buttons_main.png",1,3],false,function(a){a.execCommand("insertunorderedlist")}],insertorderedlist:["Ordered List",["ed_buttons_main.png",0,3],false,function(a){a.execCommand("insertorderedlist")}],insertunorderedlist:["Bulleted List",["ed_buttons_main.png",1,3],false,function(a){a.execCommand("insertunorderedlist")}],outdent:["Decrease Indent",["ed_buttons_main.png",1,2],false,function(a){a.execCommand("outdent")}],indent:["Increase Indent",["ed_buttons_main.png",0,2],false,function(a){a.execCommand("indent")}],forecolor:["Font Color",["ed_buttons_main.png",3,3],false,function(a){a.execCommand("forecolor")}],hilitecolor:["Background Color",["ed_buttons_main.png",2,3],false,function(a){a.execCommand("hilitecolor")}],undo:["Undoes your last action",["ed_buttons_main.png",4,2],false,function(a){a.execCommand("undo")}],redo:["Redoes your last action",["ed_buttons_main.png",5,2],false,function(a){a.execCommand("redo")}],cut:["Cut selection",["ed_buttons_main.png",5,0],false,function(a,b){a.execCommand(b)}],copy:["Copy selection",["ed_buttons_main.png",4,0],false,function(a,b){a.execCommand(b)}],paste:["Paste from clipboard",["ed_buttons_main.png",4,1],false,function(a,b){a.execCommand(b)}],selectall:["Select all",["ed_buttons_main.png",3,5],false,function(a){a.execCommand("selectall")}],inserthorizontalrule:["Horizontal Rule",["ed_buttons_main.png",6,0],false,function(a){a.execCommand("inserthorizontalrule")}],createlink:["Insert Web Link",["ed_buttons_main.png",6,1],false,function(a){a._createLink()}],insertimage:["Insert/Modify Image",["ed_buttons_main.png",6,3],false,function(a){a.execCommand("insertimage")}],inserttable:["Insert Table",["ed_buttons_main.png",6,2],false,function(a){a.execCommand("inserttable")}],htmlmode:["Toggle HTML Source",["ed_buttons_main.png",7,0],true,function(a){a.execCommand("htmlmode")}],toggleborders:["Toggle Borders",["ed_buttons_main.png",7,2],false,function(a){a._toggleBorders()}],print:["Print document",["ed_buttons_main.png",8,1],false,function(a){if(Xinha.is_gecko){a._iframe.contentWindow.print()}else{a.focusEditor();print()}}],saveas:["Save as",["ed_buttons_main.png",9,1],false,function(a){a.execCommand("saveas",false,"noname.htm")}],about:["About this editor",["ed_buttons_main.png",8,2],true,function(a){a.getPluginInstance("AboutBox").show()}],showhelp:["Help using editor",["ed_buttons_main.png",9,2],true,function(a){a.execCommand("showhelp")}],splitblock:["Split Block","ed_splitblock.gif",false,function(a){a._splitBlock()}],lefttoright:["Direction left to right",["ed_buttons_main.png",0,2],false,function(a){a.execCommand("lefttoright")}],righttoleft:["Direction right to left",["ed_buttons_main.png",1,2],false,function(a){a.execCommand("righttoleft")}],overwrite:["Insert/Overwrite","ed_overwrite.gif",false,function(a){a.execCommand("overwrite")}],wordclean:["MS Word Cleaner",["ed_buttons_main.png",5,3],false,function(a){a._wordClean()}],clearfonts:["Clear Inline Font Specifications",["ed_buttons_main.png",5,4],true,function(a){a._clearFonts()}],removeformat:["Remove formatting",["ed_buttons_main.png",4,4],false,function(a){a.execCommand("removeformat")}],killword:["Clear MSOffice tags",["ed_buttons_main.png",4,3],false,function(a){a.execCommand("killword")}]};this.dblclickList={a:[function(b,a){b._createLink(a)}],img:[function(b,a){b._insertImage(a)}]};this.iconList={dialogCaption:_editor_url+"images/xinha-small-icon.gif",wysiwygmode:[_editor_url+"images/ed_buttons_main.png",7,1]};for(var c in this.btnList){var d=this.btnList[c];if(typeof d!="object"){continue}if(typeof d[1]!="string"){d[1][0]=_editor_url+this.imgURL+d[1][0]}else{d[1]=_editor_url+this.imgURL+d[1]}d[0]=Xinha._lc(d[0])}};Xinha.Config.prototype.registerIcon=function(c,d){this.iconList[c]=d};Xinha.Config.prototype.registerButton=function(k,i,l,g,j,h){if(typeof k=="string"){this.btnList[k]=[i,l,g,j,h]}else{if(typeof k=="object"){this.btnList[k.id]=[k.tooltip,k.image,k.textMode,k.action,k.context]}else{alert("ERROR [Xinha.Config::registerButton]:\ninvalid arguments");return false}}};Xinha.prototype.registerPanel=function(e,f){if(!e){e="right"}this.setLoadingMessage("Register "+e+" panel ");var d=this.addPanel(e);if(f){f.drawPanelIn(d)}};Xinha.Config.prototype.registerDropdown=function(b){this.customSelects[b.id]=b};Xinha.Config.prototype.hideSomeButtons=function(k){var h=this.toolbar;for(var l=h.length;--l>=0;){var i=h[l];for(var g=i.length;--g>=0;){if(k.indexOf(" "+i[g]+" ")>=0){var j=1;if(/separator|space/.test(i[g+1])){j=2}i.splice(g,j)}}}};Xinha.Config.prototype.addToolbarElement=function(B,j,a){var F=this.toolbar;var x,i,o,w,C;var y=false;var D=false;var z=0;var v=0;var A=0;var u=false;var E=false;if((B&&typeof B=="object")&&(B.constructor==Array)){y=true}if((j&&typeof j=="object")&&(j.constructor==Array)){D=true;z=j.length}if(y){for(i=0;i<B.length;++i){if((B[i]!="separator")&&(B[i].indexOf("T[")!==0)){C=B[i]}}}else{C=B}for(i=0;i<F.length;++i){x=F[i];for(o=0;o<x.length;++o){if(x[o]==C){return}}}for(i=0;!E&&i<F.length;++i){x=F[i];for(o=0;!E&&o<x.length;++o){if(D){for(w=0;w<z;++w){if(x[o]==j[w]){if(w===0){E=true;o--;break}else{A=i;v=o;z=w}}}}else{if(x[o]==j){E=true;break}}}}if(!E&&D){if(j.length!=z){o=v;x=F[A];E=true}}if(E){if(a===0){if(y){x[o]=B[B.length-1];for(i=B.length-1;--i>=0;){x.splice(o,0,B[i])}}else{x[o]=B}}else{if(a<0){o=o+a+1}else{if(a>0){o=o+a}}if(y){for(i=B.length;--i>=0;){x.splice(o,0,B[i])}}else{x.splice(o,0,B)}}}else{F[0].splice(0,0,"separator");if(y){for(i=B.length;--i>=0;){F[0].splice(0,0,B[i])}}else{F[0].splice(0,0,B)}}};Xinha.Config.prototype.removeToolbarElement=Xinha.Config.prototype.hideSomeButtons;Xinha.replaceAll=function(f){var e=document.getElementsByTagName("textarea");for(var d=e.length;d>0;new Xinha(e[--d],f).generate()){}};Xinha.replace=function(e,f){var d=Xinha.getElementById("textarea",e);return d?new Xinha(d,f).generate():null};Xinha.prototype._createToolbar=function(){this.setLoadingMessage(Xinha._lc("Create Toolbar"));var h=this;var i=document.createElement("div");this._toolBar=this._toolbar=i;i.className="toolbar";i.align=this.config.toolbarAlign;Xinha.freeLater(this,"_toolBar");Xinha.freeLater(this,"_toolbar");var g=null;var j={};this._toolbarObjects=j;this._createToolbar1(h,i,j);function f(a){if(a.tagName){a.unselectable="on"}if(a.childNodes){for(var b=0;b<a.childNodes.length;b++){if(a.tagName){f(a.childNodes(b))}}}}if(Xinha.is_ie){f(i)}this._htmlArea.appendChild(i);return i};Xinha.prototype._setConfig=function(b){this.config=b};Xinha.prototype._rebuildToolbar=function(){this._createToolbar1(this,this._toolbar,this._toolbarObjects);if(Xinha._currentlyActiveEditor){if(Xinha._currentlyActiveEditor==this){this.activateEditor()}}else{this.disableToolbar()}};Xinha._createToolbarBreakingElement=function(){var b=document.createElement("div");b.style.height="1px";b.style.width="1px";b.style.lineHeight="1px";b.style.fontSize="1px";b.style.clear="both";return b};Xinha.prototype._createToolbar1=function(G,v,i){while(v.lastChild){v.removeChild(v.lastChild)}var y;if(G.config.flowToolbars){v.appendChild(Xinha._createToolbarBreakingElement())}function w(){if(typeof y!="undefined"&&y.childNodes.length===0){return}var b=document.createElement("table");b.border="0px";b.cellSpacing="0px";b.cellPadding="0px";if(G.config.flowToolbars){if(Xinha.is_ie){b.style.styleFloat="left"}else{b.style.cssFloat="left"}}v.appendChild(b);var a=document.createElement("tbody");b.appendChild(a);y=document.createElement("tr");a.appendChild(y);b.className="toolbarRow"}w();function x(d,c){var b=this[d];var a=this.element;if(b!=c){switch(d){case"enabled":if(c){Xinha._removeClass(a,"buttonDisabled");a.disabled=false}else{Xinha._addClass(a,"buttonDisabled");a.disabled=true}break;case"active":if(c){Xinha._addClass(a,"buttonPressed")}else{Xinha._removeClass(a,"buttonPressed")}break}this[d]=c}}function H(k){var e=null;var d=null;var c=null;var a=G.config.customSelects;var f=null;var g="";switch(k){case"fontsize":case"fontname":case"formatblock":e=G.config[k];c=k;break;default:c=k;var b=a[c];if(typeof b!="undefined"){e=b.options;f=b.context;if(typeof b.tooltip!="undefined"){g=b.tooltip}}else{alert("ERROR [createSelect]:\nCan't find the requested dropdown definition")}break}if(e){d=document.createElement("select");d.title=g;d.style.width="auto";d.name=k;var l={name:k,element:d,enabled:true,text:false,cmd:c,state:x,context:f};Xinha.freeLater(l);i[k]=l;for(var m in e){if(typeof e[m]!="string"){continue}var h=document.createElement("option");h.innerHTML=Xinha._lc(m);h.value=e[m];if(k=="fontname"&&G.config.showFontStylesInToolbar){h.style.fontFamily=e[m]}d.appendChild(h)}Xinha._addEvent(d,"change",function(){G._comboSelected(d,k)})}return d}function C(f){var b,d,c=null;switch(f){case"separator":if(G.config.flowToolbars){w()}b=document.createElement("div");b.className="separator";break;case"space":b=document.createElement("div");b.className="space";break;case"linebreak":w();return false;case"textindicator":b=document.createElement("div");b.appendChild(document.createTextNode("A"));b.className="indicator";b.title=Xinha._lc("Current style");c={name:f,element:b,enabled:true,active:false,text:false,cmd:"textindicator",state:x};Xinha.freeLater(c);i[f]=c;break;default:d=G.config.btnList[f]}if(!b&&d){b=document.createElement("a");b.style.display="block";b.href="javascript:void(0)";b.style.textDecoration="none";b.title=d[0];b.className="button";b.style.direction="ltr";c={name:f,element:b,enabled:true,active:false,text:d[2],cmd:d[3],state:x,context:d[4]||null};Xinha.freeLater(b);Xinha.freeLater(c);i[f]=c;b.ondrag=function(){return false};Xinha._addEvent(b,"mouseout",function(g){if(c.enabled){Xinha._removeClass(b,"buttonActive");if(c.active){Xinha._addClass(b,"buttonPressed")}}});Xinha._addEvent(b,"mousedown",function(g){if(c.enabled){Xinha._addClass(b,"buttonActive");Xinha._removeClass(b,"buttonPressed");Xinha._stopEvent(Xinha.is_ie?window.event:g)}});Xinha._addEvent(b,"click",function(g){g=g||window.event;G.btnClickEvent={clientX:g.clientX,clientY:g.clientY};if(c.enabled){Xinha._removeClass(b,"buttonActive");if(Xinha.is_gecko){G.activateEditor()}c.cmd(G,c.name,c,g);Xinha._stopEvent(g)}});var e=Xinha.makeBtnImg(d[1]);var a=e.firstChild;Xinha.freeLater(e);Xinha.freeLater(a);b.appendChild(e);c.imgel=a;c.swapImage=function(g){if(typeof g!="string"){a.src=g[0];a.style.position="relative";a.style.top=g[2]?("-"+(18*(g[2]+1))+"px"):"-18px";a.style.left=g[1]?("-"+(18*(g[1]+1))+"px"):"-18px"}else{c.imgel.src=g;a.style.top="0px";a.style.left="0px"}}}else{if(!b){b=H(f)}}return b}var z=true;for(var A=0;A<this.config.toolbar.length;++A){if(!z){}else{z=false}if(this.config.toolbar[A]===null){this.config.toolbar[A]=["separator"]}var B=this.config.toolbar[A];for(var D=0;D<B.length;++D){var j=B[D];var t;if(/^([IT])\[(.*?)\]/.test(j)){var E=RegExp.$1=="I";var u=RegExp.$2;if(E){u=Xinha._lc(u)}t=document.createElement("td");y.appendChild(t);t.className="label";t.innerHTML=u}else{if(typeof j!="function"){var F=C(j);if(F){t=document.createElement("td");t.className="toolbarElement";y.appendChild(t);t.appendChild(F)}else{if(F===null){alert("FIXME: Unknown toolbar item: "+j)}}}}}}if(G.config.flowToolbars){v.appendChild(Xinha._createToolbarBreakingElement())}return v};Xinha.makeBtnImg=function(g,e){if(!e){e=document}if(!e._xinhaImgCache){e._xinhaImgCache={};Xinha.freeLater(e._xinhaImgCache)}var f=null;if(Xinha.is_ie&&((!e.compatMode)||(e.compatMode&&e.compatMode=="BackCompat"))){f=e.createElement("span")}else{f=e.createElement("div");f.style.position="relative"}f.style.overflow="hidden";f.style.width="18px";f.style.height="18px";f.className="buttonImageContainer";var h=null;if(typeof g=="string"){if(e._xinhaImgCache[g]){h=e._xinhaImgCache[g].cloneNode()}else{if(Xinha.ie_version<7&&/\.png$/.test(g[0])){h=e.createElement("span");h.style.display="block";h.style.width="18px";h.style.height="18px";h.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+g+'")';h.unselectable="on"}else{h=e.createElement("img");h.src=g}}}else{if(e._xinhaImgCache[g[0]]){h=e._xinhaImgCache[g[0]].cloneNode()}else{if(Xinha.ie_version<7&&/\.png$/.test(g[0])){h=e.createElement("span");h.style.display="block";h.style.width="18px";h.style.height="18px";h.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+g[0]+'")';h.unselectable="on"}else{h=e.createElement("img");h.src=g[0]}h.style.position="relative"}h.style.top=g[2]?("-"+(18*(g[2]+1))+"px"):"-18px";h.style.left=g[1]?("-"+(18*(g[1]+1))+"px"):"-18px"}f.appendChild(h);return f};Xinha.prototype._createStatusBar=function(){this.setLoadingMessage(Xinha._lc("Create Statusbar"));var h=document.createElement("div");h.style.position="relative";h.className="statusBar";h.style.width="100%";Xinha.freeLater(this,"_statusBar");var f=document.createElement("div");f.className="statusBarWidgetContainer";f.style.position="absolute";f.style.right="0";f.style.top="0";f.style.padding="3px 3px 3px 10px";h.appendChild(f);var j=document.createElement("span");j.className="statusBarTree";j.innerHTML=Xinha._lc("Path")+": ";this._statusBarTree=j;Xinha.freeLater(this,"_statusBarTree");h.appendChild(j);var g=document.createElement("span");g.innerHTML=Xinha.htmlEncode(Xinha._lc("You are in TEXT MODE.  Use the [<>] button to switch back to WYSIWYG."));g.style.display="none";this._statusBarTextMode=g;Xinha.freeLater(this,"_statusBarTextMode");h.appendChild(g);h.style.whiteSpace="nowrap";var i=this;this.notifyOn("before_resize",function(b,a){i._statusBar.style.width=null});this.notifyOn("resize",function(a,c){if(Xinha.is_ie&&Xinha.ie_version==6){i._statusBar.style.width="100%"}else{var b=c.width;i._statusBar.style.width=b+"px"}});this.notifyOn("modechange",function(c,d){for(var a in i._statusWidgets){var e=i._statusWidgets[a];for(var b=0;b<e.modes.length;b++){if(e.modes[b]==d.mode){var l=true}}if(typeof l=="undefined"){e.block.style.display="none"}else{e.block.style.display=""}}});if(!this.config.statusBar){h.style.display="none"}return h};Xinha.prototype.registerStatusWidget=function(j,g){g=g||["wysiwyg"];if(!this._statusWidgets){this._statusWidgets={}}var f=document.createElement("div");f.className="statusBarWidget";f=this._statusBar.firstChild.appendChild(f);var h=false;for(var i=0;i<g.length;i++){if(g[i]==this._editMode){h=true}}f.style.display=h==true?"":"none";this._statusWidgets[j]={block:f,modes:g};return f};Xinha.prototype.generate=function(){if(!Xinha.isSupportedBrowser){return}var Q;var Z=this;var ab;var V=false;var I=document.getElementsByTagName("link");if(!document.getElementById("XinhaCoreDesign")){_editor_css=(typeof _editor_css=="string")?_editor_css:"Xinha.css";for(Q=0;Q<I.length;Q++){if((I[Q].rel=="stylesheet")&&(I[Q].href==_editor_url+_editor_css)){V=true}}if(!V){Xinha.loadStyle(_editor_css,null,"XinhaCoreDesign",true)}}if(_editor_skin!==""&&!document.getElementById("XinhaSkin")){V=false;for(Q=0;Q<I.length;Q++){if((I[Q].rel=="stylesheet")&&(I[Q].href==_editor_url+"skins/"+_editor_skin+"/skin.css")){V=true}}if(!V){Xinha.loadStyle("skins/"+_editor_skin+"/skin.css",null,"XinhaSkin")}}var aa=function(){Z.generate()};if(Xinha.is_ie){ab=_editor_url+"modules/InternetExplorer/InternetExplorer.js";if(!Xinha.loadPlugins([{plugin:"InternetExplorer",url:ab}],aa)){return false}if(!this.plugins.InternetExplorer){Z._browserSpecificPlugin=Z.registerPlugin("InternetExplorer")}}else{if(Xinha.is_webkit){ab=_editor_url+"modules/WebKit/WebKit.js";if(!Xinha.loadPlugins([{plugin:"WebKit",url:ab}],aa)){return false}if(!this.plugins.Webkit){Z._browserSpecificPlugin=Z.registerPlugin("WebKit")}}else{if(Xinha.is_opera){ab=_editor_url+"modules/Opera/Opera.js";if(!Xinha.loadPlugins([{plugin:"Opera",url:ab}],aa)){return false}if(!this.plugins.Opera){Z._browserSpecificPlugin=Z.registerPlugin("Opera")}}else{if(Xinha.is_gecko){ab=_editor_url+"modules/Gecko/Gecko.js";if(!Xinha.loadPlugins([{plugin:"Gecko",url:ab}],aa)){return false}if(!this.plugins.Gecko){Z._browserSpecificPlugin=Z.registerPlugin("Gecko")}}}}}if(typeof Dialog=="undefined"&&!Xinha._loadback(_editor_url+"modules/Dialogs/dialog.js",aa,this)){return false}if(typeof Xinha.Dialog=="undefined"&&!Xinha._loadback(_editor_url+"modules/Dialogs/XinhaDialog.js",aa,this)){return false}ab=_editor_url+"modules/FullScreen/full-screen.js";if(!Xinha.loadPlugins([{plugin:"FullScreen",url:ab}],aa)){return false}ab=_editor_url+"modules/ColorPicker/ColorPicker.js";if(!Xinha.loadPlugins([{plugin:"ColorPicker",url:ab}],aa)){return false}else{if(typeof Xinha.getPluginConstructor("ColorPicker")!="undefined"&&!this.plugins.colorPicker){Z.registerPlugin("ColorPicker")}}var M=Z.config.toolbar;for(Q=M.length;--Q>=0;){for(var G=M[Q].length;--G>=0;){switch(M[Q][G]){case"popupeditor":if(!this.plugins.FullScreen){Z.registerPlugin("FullScreen")}break;case"insertimage":ab=_editor_url+"modules/InsertImage/insert_image.js";if(typeof Xinha.prototype._insertImage=="undefined"&&!Xinha.loadPlugins([{plugin:"InsertImage",url:ab}],aa)){return false}else{if(typeof Xinha.getPluginConstructor("InsertImage")!="undefined"&&!this.plugins.InsertImage){Z.registerPlugin("InsertImage")}}break;case"createlink":ab=_editor_url+"modules/CreateLink/link.js";if(typeof Xinha.getPluginConstructor("Linker")=="undefined"&&!Xinha.loadPlugins([{plugin:"CreateLink",url:ab}],aa)){return false}else{if(typeof Xinha.getPluginConstructor("CreateLink")!="undefined"&&!this.plugins.CreateLink){Z.registerPlugin("CreateLink")}}break;case"inserttable":ab=_editor_url+"modules/InsertTable/insert_table.js";if(!Xinha.loadPlugins([{plugin:"InsertTable",url:ab}],aa)){return false}else{if(typeof Xinha.getPluginConstructor("InsertTable")!="undefined"&&!this.plugins.InsertTable){Z.registerPlugin("InsertTable")}}break;case"about":ab=_editor_url+"modules/AboutBox/AboutBox.js";if(!Xinha.loadPlugins([{plugin:"AboutBox",url:ab}],aa)){return false}else{if(typeof Xinha.getPluginConstructor("AboutBox")!="undefined"&&!this.plugins.AboutBox){Z.registerPlugin("AboutBox")}}break}}}if(Xinha.is_gecko&&Z.config.mozParaHandler!="built-in"){if(!Xinha.loadPlugins([{plugin:"EnterParagraphs",url:_editor_url+"modules/Gecko/paraHandlerBest.js"}],aa)){return false}if(!this.plugins.EnterParagraphs){Z.registerPlugin("EnterParagraphs")}}var P=this.config.getHtmlMethod=="TransformInnerHTML"?_editor_url+"modules/GetHtml/TransformInnerHTML.js":_editor_url+"modules/GetHtml/DOMwalk.js";if(!Xinha.loadPlugins([{plugin:"GetHtmlImplementation",url:P}],aa)){return false}else{if(!this.plugins.GetHtmlImplementation){Z.registerPlugin("GetHtmlImplementation")}}function H(a){return a.textContent||a.text}if(_editor_skin){this.skinInfo={};var L=Xinha._geturlcontent(_editor_url+"skins/"+_editor_skin+"/skin.xml",true);if(L){var T=L.getElementsByTagName("meta");for(Q=0;Q<T.length;Q++){this.skinInfo[T[Q].getAttribute("name")]=T[Q].getAttribute("value")}var j=L.getElementsByTagName("recommendedIcons");if(!_editor_icons&&j.length&&H(j[0])){_editor_icons=H(j[0])}}}if(_editor_icons){var K=Xinha._geturlcontent(_editor_url+"iconsets/"+_editor_icons+"/iconset.xml",true);if(K){var x=K.getElementsByTagName("icon");var U,O,S,ac,W,X;for(Q=0;Q<x.length;Q++){U=x[Q];O=U.getAttribute("id");if(U.getElementsByTagName(_editor_lang).length){U=U.getElementsByTagName(_editor_lang)[0]}else{U=U.getElementsByTagName("default")[0]}S=H(U.getElementsByTagName("path")[0]);S=(!/^\//.test(S)?_editor_url:"")+S;ac=U.getAttribute("type");if(ac=="map"){W=parseInt(H(U.getElementsByTagName("x")[0]),10);X=parseInt(H(U.getElementsByTagName("y")[0]),10);if(this.config.btnList[O]){this.config.btnList[O][1]=[S,W,X]}if(this.config.iconList[O]){this.config.iconList[O]=[S,W,X]}}else{if(this.config.btnList[O]){this.config.btnList[O][1]=S}if(this.config.iconList[O]){this.config.iconList[O]=S}}}}}this.setLoadingMessage(Xinha._lc("Generate Xinha framework"));this._framework={table:document.createElement("table"),tbody:document.createElement("tbody"),tb_row:document.createElement("tr"),tb_cell:document.createElement("td"),tp_row:document.createElement("tr"),tp_cell:this._panels.top.container,ler_row:document.createElement("tr"),lp_cell:this._panels.left.container,ed_cell:document.createElement("td"),rp_cell:this._panels.right.container,bp_row:document.createElement("tr"),bp_cell:this._panels.bottom.container,sb_row:document.createElement("tr"),sb_cell:document.createElement("td")};Xinha.freeLater(this._framework);var ad=this._framework;ad.table.border="0";ad.table.cellPadding="0";ad.table.cellSpacing="0";ad.tb_row.style.verticalAlign="top";ad.tp_row.style.verticalAlign="top";ad.ler_row.style.verticalAlign="top";ad.bp_row.style.verticalAlign="top";ad.sb_row.style.verticalAlign="top";ad.ed_cell.style.position="relative";ad.tb_row.appendChild(ad.tb_cell);ad.tb_cell.colSpan=3;ad.tp_row.appendChild(ad.tp_cell);ad.tp_cell.colSpan=3;ad.ler_row.appendChild(ad.lp_cell);ad.ler_row.appendChild(ad.ed_cell);ad.ler_row.appendChild(ad.rp_cell);ad.bp_row.appendChild(ad.bp_cell);ad.bp_cell.colSpan=3;ad.sb_row.appendChild(ad.sb_cell);ad.sb_cell.colSpan=3;ad.tbody.appendChild(ad.tb_row);ad.tbody.appendChild(ad.tp_row);ad.tbody.appendChild(ad.ler_row);ad.tbody.appendChild(ad.bp_row);ad.tbody.appendChild(ad.sb_row);ad.table.appendChild(ad.tbody);var R=ad.table;this._htmlArea=R;Xinha.freeLater(this,"_htmlArea");R.className="htmlarea";ad.tb_cell.appendChild(this._createToolbar());var y=document.createElement("iframe");y.src=this.popupURL(Z.config.URIs.blank);y.id="XinhaIFrame_"+this._textArea.id;ad.ed_cell.appendChild(y);this._iframe=y;this._iframe.className="xinha_iframe";Xinha.freeLater(this,"_iframe");var i=this._createStatusBar();this._statusBar=ad.sb_cell.appendChild(i);var J=this._textArea;J.parentNode.insertBefore(R,J);J.className="xinha_textarea";Xinha.removeFromParent(J);ad.ed_cell.appendChild(J);Xinha.addDom0Event(this._textArea,"click",function(){if(Xinha._currentlyActiveEditor!=this){Z.updateToolbar()}return true});if(J.form){Xinha.prependDom0Event(this._textArea.form,"submit",function(){Z.firePluginEvent("onBeforeSubmit");Z._textArea.value=Z.outwardHtml(Z.getHTML());return true});var Y=J.value;Xinha.prependDom0Event(this._textArea.form,"reset",function(){Z.setHTML(Z.inwardHtml(Y));Z.updateToolbar();return true});if(!J.form.xinha_submit){try{J.form.xinha_submit=J.form.submit;J.form.submit=function(){this.onsubmit();this.xinha_submit()}}catch(N){}}}Xinha.prependDom0Event(window,"unload",function(){Z.firePluginEvent("onBeforeUnload");J.value=Z.outwardHtml(Z.getHTML());if(!Xinha.is_ie){R.parentNode.replaceChild(J,R)}return true});J.style.display="none";Z.initSize();this.setLoadingMessage(Xinha._lc("Finishing"));Z._iframeLoadDone=false;if(Xinha.is_opera){Z.initIframe()}else{Xinha._addEvent(this._iframe,"load",function(a){if(!Z._iframeLoadDone){Z._iframeLoadDone=true;Z.initIframe()}return true})}};Xinha.prototype.initSize=function(){this.setLoadingMessage(Xinha._lc("Init editor size"));var d=this;var f=null;var e=null;switch(this.config.width){case"auto":f=this._initial_ta_size.w;break;case"toolbar":f=this._toolBar.offsetWidth+"px";break;default:f=/[^0-9]/.test(this.config.width)?this.config.width:this.config.width+"px";break}e=this.config.height=="auto"?this._initial_ta_size.h:/[^0-9]/.test(this.config.height)?this.config.height:this.config.height+"px";this.sizeEditor(f,e,this.config.sizeIncludesBars,this.config.sizeIncludesPanels);this.notifyOn("panel_change",function(){d.sizeEditor()})};Xinha.prototype.sizeEditor=function(E,F,w,s){if(this._risizing){return}this._risizing=true;var v=this._framework;this.notifyOf("before_resize",{width:E,height:F});this.firePluginEvent("onBeforeResize",E,F);this._iframe.style.height="100%";this._textArea.style.height="1px";this._iframe.style.width="0px";this._textArea.style.width="0px";if(w!==null){this._htmlArea.sizeIncludesToolbars=w}if(s!==null){this._htmlArea.sizeIncludesPanels=s}if(E){this._htmlArea.style.width=E;if(!this._htmlArea.sizeIncludesPanels){var C=this._panels.right;if(C.on&&C.panels.length&&Xinha.hasDisplayedChildren(C.div)){this._htmlArea.style.width=(this._htmlArea.offsetWidth+parseInt(this.config.panel_dimensions.right,10))+"px"}var u=this._panels.left;if(u.on&&u.panels.length&&Xinha.hasDisplayedChildren(u.div)){this._htmlArea.style.width=(this._htmlArea.offsetWidth+parseInt(this.config.panel_dimensions.left,10))+"px"}}}if(F){this._htmlArea.style.height=F;if(!this._htmlArea.sizeIncludesToolbars){this._htmlArea.style.height=(this._htmlArea.offsetHeight+this._toolbar.offsetHeight+this._statusBar.offsetHeight)+"px"}if(!this._htmlArea.sizeIncludesPanels){var B=this._panels.top;if(B.on&&B.panels.length&&Xinha.hasDisplayedChildren(B.div)){this._htmlArea.style.height=(this._htmlArea.offsetHeight+parseInt(this.config.panel_dimensions.top,10))+"px"}var q=this._panels.bottom;if(q.on&&q.panels.length&&Xinha.hasDisplayedChildren(q.div)){this._htmlArea.style.height=(this._htmlArea.offsetHeight+parseInt(this.config.panel_dimensions.bottom,10))+"px"}}}E=this._htmlArea.offsetWidth;F=this._htmlArea.offsetHeight;var r=this._panels;var D=this;var x=1;function y(a){if(r[a].on&&r[a].panels.length&&Xinha.hasDisplayedChildren(r[a].container)){r[a].container.style.display="";return true}else{r[a].container.style.display="none";return false}}if(y("left")){x+=1}if(y("right")){x+=1}v.tb_cell.colSpan=x;v.tp_cell.colSpan=x;v.bp_cell.colSpan=x;v.sb_cell.colSpan=x;if(!v.tp_row.childNodes.length){Xinha.removeFromParent(v.tp_row)}else{if(!Xinha.hasParentNode(v.tp_row)){v.tbody.insertBefore(v.tp_row,v.ler_row)}}if(!v.bp_row.childNodes.length){Xinha.removeFromParent(v.bp_row)}else{if(!Xinha.hasParentNode(v.bp_row)){v.tbody.insertBefore(v.bp_row,v.ler_row.nextSibling)}}if(!this.config.statusBar){Xinha.removeFromParent(v.sb_row)}else{if(!Xinha.hasParentNode(v.sb_row)){v.table.appendChild(v.sb_row)}}v.lp_cell.style.width=this.config.panel_dimensions.left;v.rp_cell.style.width=this.config.panel_dimensions.right;v.tp_cell.style.height=this.config.panel_dimensions.top;v.bp_cell.style.height=this.config.panel_dimensions.bottom;v.tb_cell.style.height=this._toolBar.offsetHeight+"px";v.sb_cell.style.height=this._statusBar.offsetHeight+"px";var t=F-this._toolBar.offsetHeight-this._statusBar.offsetHeight;if(y("top")){t-=parseInt(this.config.panel_dimensions.top,10)}if(y("bottom")){t-=parseInt(this.config.panel_dimensions.bottom,10)}this._iframe.style.height=t+"px";var A=E;if(y("left")){A-=parseInt(this.config.panel_dimensions.left,10)}if(y("right")){A-=parseInt(this.config.panel_dimensions.right,10)}var z=this.config.iframeWidth?parseInt(this.config.iframeWidth,10):null;this._iframe.style.width=(z&&z<A)?z+"px":A+"px";this._textArea.style.height=this._iframe.style.height;this._textArea.style.width=this._iframe.style.width;this.notifyOf("resize",{width:this._htmlArea.offsetWidth,height:this._htmlArea.offsetHeight});this.firePluginEvent("onResize",this._htmlArea.offsetWidth,this._htmlArea.offsetWidth);this._risizing=false};Xinha.prototype.registerPanel=function(e,f){if(!e){e="right"}this.setLoadingMessage("Register "+e+" panel ");var d=this.addPanel(e);if(f){f.drawPanelIn(d)}};Xinha.prototype.addPanel=function(d){var c=document.createElement("div");c.side=d;if(d=="left"||d=="right"){c.style.width=this.config.panel_dimensions[d];if(this._iframe){c.style.height=this._iframe.style.height}}Xinha.addClasses(c,"panel");this._panels[d].panels.push(c);this._panels[d].div.appendChild(c);this.notifyOf("panel_change",{action:"add",panel:c});this.firePluginEvent("onPanelChange","add",c);return c};Xinha.prototype.removePanel=function(d){this._panels[d.side].div.removeChild(d);var e=[];for(var f=0;f<this._panels[d.side].panels.length;f++){if(this._panels[d.side].panels[f]!=d){e.push(this._panels[d.side].panels[f])}}this._panels[d.side].panels=e;this.notifyOf("panel_change",{action:"remove",panel:d});this.firePluginEvent("onPanelChange","remove",d)};Xinha.prototype.hidePanel=function(d){if(d&&d.style.display!="none"){try{var e=this.scrollPos(this._iframe.contentWindow)}catch(f){}d.style.display="none";this.notifyOf("panel_change",{action:"hide",panel:d});this.firePluginEvent("onPanelChange","hide",d);try{this._iframe.contentWindow.scrollTo(e.x,e.y)}catch(f){}}};Xinha.prototype.showPanel=function(d){if(d&&d.style.display=="none"){try{var e=this.scrollPos(this._iframe.contentWindow)}catch(f){}d.style.display="";this.notifyOf("panel_change",{action:"show",panel:d});this.firePluginEvent("onPanelChange","show",d);try{this._iframe.contentWindow.scrollTo(e.x,e.y)}catch(f){}}};Xinha.prototype.hidePanels=function(f){if(typeof f=="undefined"){f=["left","right","top","bottom"]}var e=[];for(var d=0;d<f.length;d++){if(this._panels[f[d]].on){e.push(f[d]);this._panels[f[d]].on=false}}this.notifyOf("panel_change",{action:"multi_hide",sides:f});this.firePluginEvent("onPanelChange","multi_hide",f)};Xinha.prototype.showPanels=function(f){if(typeof f=="undefined"){f=["left","right","top","bottom"]}var e=[];for(var d=0;d<f.length;d++){if(!this._panels[f[d]].on){e.push(f[d]);this._panels[f[d]].on=true}}this.notifyOf("panel_change",{action:"multi_show",sides:f});this.firePluginEvent("onPanelChange","multi_show",f)};Xinha.objectProperties=function(e){var f=[];for(var d in e){f[f.length]=d}return f};Xinha.prototype.editorIsActivated=function(){try{return Xinha.is_designMode?this._doc.designMode=="on":this._doc.body.contentEditable}catch(b){return false}};Xinha._someEditorHasBeenActivated=false;Xinha._currentlyActiveEditor=null;Xinha.prototype.activateEditor=function(){if(this.currentModal){return}if(Xinha._currentlyActiveEditor){if(Xinha._currentlyActiveEditor==this){return true}Xinha._currentlyActiveEditor.deactivateEditor()}if(Xinha.is_designMode&&this._doc.designMode!="on"){try{if(this._iframe.style.display=="none"){this._iframe.style.display="";this._doc.designMode="on";this._iframe.style.display="none"}else{this._doc.designMode="on"}if(Xinha.is_opera){this.setEditorEvents(true)}}catch(c){}}else{if(Xinha.is_ie&&this._doc.body.contentEditable!==true){this._doc.body.contentEditable=true}}Xinha._someEditorHasBeenActivated=true;Xinha._currentlyActiveEditor=this;var d=this;this.enableToolbar()};Xinha.prototype.deactivateEditor=function(){this.disableToolbar();if(Xinha.is_designMode&&this._doc.designMode!="off"){try{this._doc.designMode="off"}catch(b){}}else{if(!Xinha.is_designMode&&this._doc.body.contentEditable!==false){this._doc.body.contentEditable=false}}if(Xinha._currentlyActiveEditor!=this){return}Xinha._currentlyActiveEditor=false};Xinha.prototype.initIframe=function(){this.disableToolbar();var m=null;var k=this;try{if(k._iframe.contentDocument){this._doc=k._iframe.contentDocument}else{this._doc=k._iframe.contentWindow.document}m=this._doc;if(!m){if(Xinha.is_gecko){setTimeout(function(){k.initIframe()},50);return false}else{alert("ERROR: IFRAME can't be initialized.")}}}catch(n){setTimeout(function(){k.initIframe()},50);return false}Xinha.freeLater(this,"_doc");m.open("text/html","replace");var h="",l;if(k.config.browserQuirksMode===false){l='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">'}else{if(k.config.browserQuirksMode===true){l=""}else{l=Xinha.getDoctype(document)}}if(!k.config.fullPage){h+=l+"\n";h+="<html>\n";h+="<head>\n";h+='<meta http-equiv="Content-Type" content="text/html; charset='+k.config.charSet+'">\n';if(typeof k.config.baseHref!="undefined"&&k.config.baseHref!==null){h+='<base href="'+k.config.baseHref+'"/>\n'}h+=Xinha.addCoreCSS();if(typeof k.config.pageStyleSheets!=="undefined"){for(var i=0;i<k.config.pageStyleSheets.length;i++){if(k.config.pageStyleSheets[i].length>0){h+='<link rel="stylesheet" type="text/css" href="'+k.config.pageStyleSheets[i]+'">'}}}if(k.config.pageStyle){h+='<style type="text/css">\n'+k.config.pageStyle+"\n</style>"}h+="</head>\n";h+="<body"+(k.config.bodyID?(' id="'+k.config.bodyID+'"'):"")+(k.config.bodyClass?(' class="'+k.config.bodyClass+'"'):"")+">\n";h+=k.inwardHtml(k._textArea.value);h+="</body>\n";h+="</html>"}else{h=k.inwardHtml(k._textArea.value);if(h.match(Xinha.RE_doctype)){k.setDoctype(RegExp.$1)}var j=h.match(/<link\s+[\s\S]*?["']\s*\/?>/gi);h=h.replace(/<link\s+[\s\S]*?["']\s*\/?>\s*/gi,"");if(j){h=h.replace(/<\/head>/i,j.join("\n")+"\n</head>")}}m.write(h);m.close();if(this.config.fullScreen){this._fullScreen()}this.setEditorEvents();if((typeof k.config.autofocus!="undefined")&&k.config.autofocus!==false&&((k.config.autofocus==k._textArea.id)||k.config.autofocus==true)){k.activateEditor();k.focusEditor()}};Xinha.prototype.whenDocReady=function(d){var c=this;if(this._doc&&this._doc.body){d()}else{setTimeout(function(){c.whenDocReady(d)},50)}};Xinha.prototype.setMode=function(c){var d;if(typeof c=="undefined"){c=this._editMode=="textmode"?"wysiwyg":"textmode"}switch(c){case"textmode":this.firePluginEvent("onBeforeMode","textmode");this._toolbarObjects.htmlmode.swapImage(this.config.iconList.wysiwygmode);this.setCC("iframe");d=this.outwardHtml(this.getHTML());this.setHTML(d);this.deactivateEditor();this._iframe.style.display="none";this._textArea.style.display="";if(this.config.statusBar){this._statusBarTree.style.display="none";this._statusBarTextMode.style.display=""}this.findCC("textarea");this.notifyOf("modechange",{mode:"text"});this.firePluginEvent("onMode","textmode");break;case"wysiwyg":this.firePluginEvent("onBeforeMode","wysiwyg");this._toolbarObjects.htmlmode.swapImage([this.imgURL("images/ed_buttons_main.png"),7,0]);this.setCC("textarea");d=this.inwardHtml(this.getHTML());this.deactivateEditor();this.setHTML(d);this._iframe.style.display="";this._textArea.style.display="none";this.activateEditor();if(this.config.statusBar){this._statusBarTree.style.display="";this._statusBarTextMode.style.display="none"}this.findCC("iframe");this.notifyOf("modechange",{mode:"wysiwyg"});this.firePluginEvent("onMode","wysiwyg");break;default:alert("Mode <"+c+"> not defined!");return false}this._editMode=c};Xinha.prototype.setFullHTML=function(f){var h=RegExp.multiline;RegExp.multiline=true;if(f.match(Xinha.RE_doctype)){this.setDoctype(RegExp.$1)}RegExp.multiline=h;if(0){if(f.match(Xinha.RE_head)){this._doc.getElementsByTagName("head")[0].innerHTML=RegExp.$1}if(f.match(Xinha.RE_body)){this._doc.getElementsByTagName("body")[0].innerHTML=RegExp.$1}}else{var e=this.editorIsActivated();if(e){this.deactivateEditor()}var g=/<html>((.|\n)*?)<\/html>/i;f=f.replace(g,"$1");this._doc.open("text/html","replace");this._doc.write(f);this._doc.close();if(e){this.activateEditor()}this.setEditorEvents();return true}};Xinha.prototype.setEditorEvents=function(e){var d=this;var f=this._doc;d.whenDocReady(function(){if(!e){Xinha._addEvents(f,["mousedown"],function(){d.activateEditor();return true});if(Xinha.is_ie){Xinha._addEvent(d._doc.getElementsByTagName("html")[0],"click",function(){if(d._iframe.contentWindow.event.srcElement.tagName.toLowerCase()=="html"){var c=d._doc.body.createTextRange();c.collapse();c.select()}return true})}}Xinha._addEvents(f,["keydown","keypress","mousedown","mouseup","drag"],function(c){return d._editorEvent(Xinha.is_ie?d._iframe.contentWindow.event:c)});Xinha._addEvents(f,["dblclick"],function(c){return d._onDoubleClick(Xinha.is_ie?d._iframe.contentWindow.event:c)});if(e){return}for(var a in d.plugins){var b=d.plugins[a].instance;Xinha.refreshPlugin(b)}if(typeof d._onGenerate=="function"){d._onGenerate()}Xinha.addDom0Event(window,"resize",function(c){if(Xinha.ie_version>7&&!window.parent){if(d.execResize){d.sizeEditor();d.execResize=false}else{d.execResize=true}}else{d.sizeEditor()}});d.removeLoadingMessage()})};Xinha.getPluginConstructor=function(b){return Xinha.plugins[b]||window[b]};Xinha.prototype.registerPlugin=function(){if(!Xinha.isSupportedBrowser){return}var d=arguments[0];if(d===null||typeof d=="undefined"||(typeof d=="string"&&Xinha.getPluginConstructor(d)=="undefined")){return false}var f=[];for(var e=1;e<arguments.length;++e){f.push(arguments[e])}return this.registerPlugin2(d,f)};Xinha.prototype.registerPlugin2=function(k,j){if(typeof k=="string"&&typeof Xinha.getPluginConstructor(k)=="function"){var l=k;k=Xinha.getPluginConstructor(k)}if(typeof k=="undefined"){return false}if(!k._pluginInfo){k._pluginInfo={name:l}}var n=new k(this,j);if(n){var m={};var h=k._pluginInfo;for(var i in h){m[i]=h[i]}m.instance=n;m.args=j;this.plugins[k._pluginInfo.name]=m;return n}else{Xinha.debugMsg("Can't register plugin "+k.toString()+".","warn")}};Xinha.getPluginDir=function(d,c){if(Xinha.externalPlugins[d]){return Xinha.externalPlugins[d][0]}if(c||(Xinha.getPluginConstructor(d)&&(typeof Xinha.getPluginConstructor(d).supported!="undefined")&&!Xinha.getPluginConstructor(d).supported)){return _editor_url+"unsupported_plugins/"+d}return _editor_url+"plugins/"+d};Xinha.loadPlugin=function(h,j,f){if(!Xinha.isSupportedBrowser){return}Xinha.setLoadingMessage(Xinha._lc("Loading plugin $plugin="+h+"$"));if(typeof Xinha.getPluginConstructor(h)!="undefined"){if(j){j(h)}return true}Xinha._pluginLoadStatus[h]="loading";function i(c,e){var o,n,p,a;switch(c){case"start":o="old_naming";n=Xinha.getPluginDir(e);p=e+".js";break;case"old_naming":o="unsupported";n=Xinha.getPluginDir(e);p=e.replace(/([a-z])([A-Z])([a-z])/g,function(m,r,k,l){return r+"-"+k.toLowerCase()+l}).toLowerCase()+".js";a="You are using an obsolete naming scheme for the Xinha plugin "+e+". Please rename "+p+" to "+e+".js";break;case"unsupported":o="unsupported_old_name";n=Xinha.getPluginDir(e,true);p=e+".js";a="You are using the unsupported Xinha plugin "+e+". If you wish continued support, please see http://trac.xinha.org/ticket/1297";break;case"unsupported_old_name":o="";n=Xinha.getPluginDir(e,true);p=e.replace(/([a-z])([A-Z])([a-z])/g,function(m,r,k,l){return r+"-"+k.toLowerCase()+l}).toLowerCase()+".js";a="You are using the unsupported Xinha plugin "+e+". If you wish continued support, please see http://trac.xinha.org/ticket/1297";break;default:Xinha._pluginLoadStatus[e]="failed";Xinha.debugMsg("Xinha was not able to find the plugin "+e+". Please make sure the plugin exists.","warn");return}var b=n+"/"+p;function d(k){Xinha.getPluginConstructor(k).supported=c.indexOf("unsupported")!==0;j(k)}Xinha._loadback(b,d,this,e);Xinha.ping(b,function(){if(a){Xinha.debugMsg(a)}},function(){Xinha.removeFromParent(document.getElementById(b));i(o,e)})}if(!f){if(Xinha.externalPlugins[h]){Xinha._loadback(Xinha.externalPlugins[h][0]+Xinha.externalPlugins[h][1],j,this,h)}else{var g=this;i("start",h)}}else{Xinha._loadback(f,j,this,h)}return false};Xinha._pluginLoadStatus={};Xinha.externalPlugins={};Xinha.plugins={};Xinha.loadPlugins=function(j,m,l){if(!Xinha.isSupportedBrowser){return}var n,k;for(k=0;k<j.length;k++){if(typeof j[k]=="object"){n=j[k].url.match(/(.*)(\/[^\/]*)$/);Xinha.externalPlugins[j[k].plugin]=[n[1],n[2]];j[k]=j[k].plugin}}var p=true;var o=Xinha.cloneObject(j);for(k=0;k<o.length;k++){var i=o[k];if(i=="FullScreen"&&!Xinha.externalPlugins.FullScreen){continue}if(typeof Xinha._pluginLoadStatus[i]=="undefined"){Xinha.loadPlugin(i,function(a){Xinha.setLoadingMessage(Xinha._lc("Finishing"));if(typeof Xinha.getPluginConstructor(a)!="undefined"){Xinha._pluginLoadStatus[a]="ready"}else{Xinha._pluginLoadStatus[a]="failed"}},l);p=false}else{if(Xinha._pluginLoadStatus[i]=="loading"){p=false}}}if(p){return true}if(m){setTimeout(function(){if(Xinha.loadPlugins(j,m)){m()}},50)}return p};Xinha.refreshPlugin=function(b){if(b&&typeof b.onGenerate=="function"){b.onGenerate()}if(b&&typeof b.onGenerateOnce=="function"){b._ongenerateOnce=b.onGenerateOnce;delete (b.onGenerateOnce);b._ongenerateOnce();delete (b._ongenerateOnce)}};Xinha.prototype.firePluginEvent=function(g){var j=[];for(var h=1;h<arguments.length;h++){j[h-1]=arguments[h]}for(h in this.plugins){var i=this.plugins[h].instance;if(i==this._browserSpecificPlugin){continue}if(i&&typeof i[g]=="function"){var f=(h=="Events")?this:i;if(i[g].apply(f,j)){return true}}}i=this._browserSpecificPlugin;if(i&&typeof i[g]=="function"){if(i[g].apply(i,j)){return true}}return false};Xinha.loadStyle=function(h,l,m,i){var k=_editor_url||"";if(l){k=Xinha.getPluginDir(l)+"/"}k+=h;if(/^\//.test(h)){k=h}var j=document.getElementsByTagName("head")[0];var n=document.createElement("link");n.rel="stylesheet";n.href=k;n.type="text/css";if(m){n.id=m}if(i&&j.getElementsByTagName("link")[0]){j.insertBefore(n,j.getElementsByTagName("link")[0])}else{j.appendChild(n)}};Xinha.loadScript=function(f,h,e){var g=_editor_url||"";if(h){g=Xinha.getPluginDir(h)+"/"}g+=f;if(/^\//.test(f)){g=f}Xinha._loadback(g,e)};Xinha.includeAssets=function(){var c={pendingAssets:[],loaderRunning:false,loadedScripts:[]};c.callbacks=[];c.loadNext=function(){var a=this;this.loaderRunning=true;if(this.pendingAssets.length){var b=this.pendingAssets[0];this.pendingAssets.splice(0,1);switch(b.type){case"text/css":Xinha.loadStyle(b.url,b.plugin);return this.loadNext();case"text/javascript":Xinha.loadScript(b.url,b.plugin,function(){a.loadNext()})}}else{this.loaderRunning=false;this.runCallback()}};c.loadScript=function(b,a){var f=this;this.pendingAssets.push({type:"text/javascript",url:b,plugin:a});if(!this.loaderRunning){this.loadNext()}return this};c.loadScriptOnce=function(f,a){for(var b=0;b<this.loadedScripts.length;b++){if(this.loadedScripts[b].url==f&&this.loadedScripts[b].plugin==a){return this}}return this.loadScript(f,a)};c.loadStyle=function(b,a){var f=this;this.pendingAssets.push({type:"text/css",url:b,plugin:a});if(!this.loaderRunning){this.loadNext()}return this};c.whenReady=function(a){this.callbacks.push(a);if(!this.loaderRunning){this.loadNext()}return this};c.runCallback=function(){while(this.callbacks.length){var a=this.callbacks.splice(0,1);a[0]();a=null}return this};for(var d=0;d<arguments.length;d++){if(typeof arguments[d]=="string"){if(arguments[d].match(/\.css$/i)){c.loadStyle(arguments[d])}else{c.loadScript(arguments[d])}}else{if(arguments[d].type){if(arguments[d].type.match(/text\/css/i)){c.loadStyle(arguments[d].url,arguments[d].plugin)}else{if(arguments[d].type.match(/text\/javascript/i)){c.loadScript(arguments[d].url,arguments[d].plugin)}}}else{if(arguments[d].length>=1){if(arguments[d][0].match(/\.css$/i)){c.loadStyle(arguments[d][0],arguments[d][1])}else{c.loadScript(arguments[d][0],arguments[d][1])}}}}}return c};Xinha.prototype.debugTree=function(){var e=document.createElement("textarea");e.style.width="100%";e.style.height="20em";e.value="";function f(b,a){for(;--b>=0;){e.value+=" "}e.value+=a+"\n"}function d(b,i){var c=b.tagName.toLowerCase(),a;var j=Xinha.is_ie?b.scopeName:b.prefix;f(i,"- "+c+" ["+j+"]");for(a=b.firstChild;a;a=a.nextSibling){if(a.nodeType==1){d(a,i+2)}}}d(this._doc.body,0);document.body.appendChild(e)};Xinha.getInnerText=function(e){var d="",f;for(f=e.firstChild;f;f=f.nextSibling){if(f.nodeType==3){d+=f.data}else{if(f.nodeType==1){d+=Xinha.getInnerText(f)}}}return d};Xinha.prototype._wordClean=function(){var q=this;var n={empty_tags:0,cond_comm:0,mso_elmts:0,mso_class:0,mso_style:0,mso_xmlel:0,orig_len:this._doc.body.innerHTML.length,T:new Date().getTime()};var l={empty_tags:"Empty tags removed: ",cond_comm:"Conditional comments removed",mso_elmts:"MSO invalid elements removed",mso_class:"MSO class names removed: ",mso_style:"MSO inline style removed: ",mso_xmlel:"MSO XML elements stripped: "};function m(){var b="Xinha word cleaner stats: \n\n";for(var a in n){if(l[a]){b+=l[a]+n[a]+"\n"}}b+="\nInitial document length: "+n.orig_len+"\n";b+="Final document length: "+q._doc.body.innerHTML.length+"\n";b+="Clean-up took "+((new Date().getTime()-n.T)/1000)+" seconds";alert(b)}function k(b){var a=b.className.replace(/(^|\s)mso.*?(\s|$)/ig," ");if(a!=b.className){b.className=a;if(!/\S/.test(b.className)){b.removeAttribute("className");++n.mso_class}}}function r(c){var b=c.style.cssText.split(/\s*;\s*/);for(var a=b.length;--a>=0;){if(/^mso|^tab-stops/i.test(b[a])||/^margin\s*:\s*0..\s+0..\s+0../i.test(b[a])){++n.mso_style;b.splice(a,1)}}c.style.cssText=b.join("; ")}function p(a){if(("link"==a.tagName.toLowerCase()&&(a.attributes&&/File-List|Edit-Time-Data|themeData|colorSchemeMapping/.test(a.attributes.rel.nodeValue)))||/^(style|meta)$/i.test(a.tagName)){Xinha.removeFromParent(a);++n.mso_elmts;return true}return false}function o(a){if(/^(a|span|b|strong|i|em|font|div|p)$/i.test(a.tagName)&&!a.firstChild){Xinha.removeFromParent(a);++n.empty_tags;return true}return false}function j(b){k(b);r(b);var c;for(var d=b.firstChild;d;d=c){c=d.nextSibling;if(d.nodeType==1&&j(d)){if((Xinha.is_ie&&b.scopeName!="HTML")||(!Xinha.is_ie&&/:/.test(d.tagName))){for(var a=d.childNodes&&d.childNodes.length-1;d.childNodes&&d.childNodes.length&&d.childNodes[a];--a){if(d.nextSibling){d.parentNode.insertBefore(d.childNodes[a],d.nextSibling)}else{d.parentNode.appendChild(d.childNodes[a])}}Xinha.removeFromParent(d);continue}if(o(d)){continue}if(p(d)){continue}}else{if(d.nodeType==8){if(/(\s*\[\s*if\s*(([gl]te?|!)\s*)?(IE|mso)\s*(\d+(\.\d+)?\s*)?\]>)/.test(d.nodeValue)){Xinha.removeFromParent(d);++n.cond_comm}}}}return true}j(this._doc.body);this.updateToolbar()};Xinha.prototype._clearFonts=function(){var b=this.getInnerHTML();if(confirm(Xinha._lc("Would you like to clear font typefaces?"))){b=b.replace(/face="[^"]*"/gi,"");b=b.replace(/font-family:[^;}"']+;?/gi,"")}if(confirm(Xinha._lc("Would you like to clear font sizes?"))){b=b.replace(/size="[^"]*"/gi,"");b=b.replace(/font-size:[^;}"']+;?/gi,"")}if(confirm(Xinha._lc("Would you like to clear font colours?"))){b=b.replace(/color="[^"]*"/gi,"");b=b.replace(/([^\-])color:[^;}"']+;?/gi,"$1")}b=b.replace(/(style|class)="\s*"/gi,"");b=b.replace(/<(font|span)\s*>/gi,"");this.setHTML(b);this.updateToolbar()};Xinha.prototype._splitBlock=function(){this._doc.execCommand("formatblock",false,"div")};Xinha.prototype.forceRedraw=function(){this._doc.body.style.visibility="hidden";this._doc.body.style.visibility=""};Xinha.prototype.focusEditor=function(){switch(this._editMode){case"wysiwyg":try{if(Xinha._someEditorHasBeenActivated){this.activateEditor();this._iframe.contentWindow.focus()}}catch(d){}break;case"textmode":try{this._textArea.focus()}catch(c){}break;default:alert("ERROR: mode "+this._editMode+" is not defined")}return this._doc};Xinha.prototype._undoTakeSnapshot=function(){++this._undoPos;if(this._undoPos>=this.config.undoSteps){this._undoQueue.shift();--this._undoPos}var c=true;var d=this.getInnerHTML();if(this._undoPos>0){c=(this._undoQueue[this._undoPos-1]!=d)}if(c){this._undoQueue[this._undoPos]=d}else{this._undoPos--}};Xinha.prototype.undo=function(){if(this._undoPos>0){var b=this._undoQueue[--this._undoPos];if(b){this.setHTML(b)}else{++this._undoPos}}};Xinha.prototype.redo=function(){if(this._undoPos<this._undoQueue.length-1){var b=this._undoQueue[++this._undoPos];if(b){this.setHTML(b)}else{--this._undoPos}}};Xinha.prototype.disableToolbar=function(d){if(this._timerToolbar){clearTimeout(this._timerToolbar)}if(typeof d=="undefined"){d=[]}else{if(typeof d!="object"){d=[d]}}for(var e in this._toolbarObjects){var f=this._toolbarObjects[e];if(d.contains(e)){continue}if(typeof f.state!="function"){continue}f.state("enabled",false)}};Xinha.prototype.enableToolbar=function(){this.updateToolbar()};Xinha.prototype.updateToolbar=function(noStatus){if(this.suspendUpdateToolbar){return}var doc=this._doc;var text=(this._editMode=="textmode");var ancestors=null;if(!text){ancestors=this.getAllAncestors();if(this.config.statusBar&&!noStatus){while(this._statusBarItems.length){var item=this._statusBarItems.pop();item.el=null;item.editor=null;item.onclick=null;item.oncontextmenu=null;item._xinha_dom0Events.click=null;item._xinha_dom0Events.contextmenu=null;item=null}this._statusBarTree.innerHTML=" ";this._statusBarTree.appendChild(document.createTextNode(Xinha._lc("Path")+": "));for(var i=ancestors.length;--i>=0;){var el=ancestors[i];if(!el){continue}var a=document.createElement("a");a.href="javascript:void(0);";a.el=el;a.editor=this;this._statusBarItems.push(a);Xinha.addDom0Event(a,"click",function(){this.blur();this.editor.selectNodeContents(this.el);this.editor.updateToolbar(true);return false});Xinha.addDom0Event(a,"contextmenu",function(){this.blur();var info="Inline style:\n\n";info+=this.el.style.cssText.split(/;\s*/).join(";\n");alert(info);return false});var txt=el.tagName.toLowerCase();switch(txt){case"b":txt="strong";break;case"i":txt="em";break;case"strike":txt="del";break}if(typeof el.style!="undefined"){a.title=el.style.cssText}if(el.id){txt+="#"+el.id}if(el.className){txt+="."+el.className}a.appendChild(document.createTextNode(txt));this._statusBarTree.appendChild(a);if(i!==0){this._statusBarTree.appendChild(document.createTextNode(String.fromCharCode(187)))}Xinha.freeLater(a)}}}for(var cmd in this._toolbarObjects){var btn=this._toolbarObjects[cmd];var inContext=true;if(typeof btn.state!="function"){continue}if(btn.context&&!text){inContext=false;var context=btn.context;var attrs=[];if(/(.*)\[(.*?)\]/.test(context)){context=RegExp.$1;attrs=RegExp.$2.split(",")}context=context.toLowerCase();var match=(context=="*");for(var k=0;k<ancestors.length;++k){if(!ancestors[k]){continue}if(match||(ancestors[k].tagName.toLowerCase()==context)){inContext=true;var contextSplit=null;var att=null;var comp=null;var attVal=null;for(var ka=0;ka<attrs.length;++ka){contextSplit=attrs[ka].match(/(.*)(==|!=|===|!==|>|>=|<|<=)(.*)/);att=contextSplit[1];comp=contextSplit[2];attVal=contextSplit[3];if(!eval(ancestors[k][att]+comp+attVal)){inContext=false;break}}if(inContext){break}}}}btn.state("enabled",(!text||btn.text)&&inContext);if(typeof cmd=="function"){continue}var dropdown=this.config.customSelects[cmd];if((!text||btn.text)&&(typeof dropdown!="undefined")){dropdown.refresh(this);continue}switch(cmd){case"fontname":case"fontsize":if(!text){try{var value=(""+doc.queryCommandValue(cmd)).toLowerCase();if(!value){btn.element.selectedIndex=0;break}var options=this.config[cmd];var sIndex=0;for(var j in options){if((j.toLowerCase()==value)||(options[j].substr(0,value.length).toLowerCase()==value)){btn.element.selectedIndex=sIndex;throw"ok"}++sIndex}btn.element.selectedIndex=0}catch(ex){}}break;case"formatblock":var blocks=[];for(var indexBlock in this.config.formatblock){if(typeof this.config.formatblock[indexBlock]=="string"){blocks[blocks.length]=this.config.formatblock[indexBlock]}}var deepestAncestor=this._getFirstAncestor(this.getSelection(),blocks);if(deepestAncestor){for(var x=0;x<blocks.length;x++){if(blocks[x].toLowerCase()==deepestAncestor.tagName.toLowerCase()){btn.element.selectedIndex=x}}}else{btn.element.selectedIndex=0}break;case"textindicator":if(!text){try{var style=btn.element.style;style.backgroundColor=Xinha._makeColor(doc.queryCommandValue(Xinha.is_ie?"backcolor":"hilitecolor"));if(/transparent/i.test(style.backgroundColor)){style.backgroundColor=Xinha._makeColor(doc.queryCommandValue("backcolor"))}style.color=Xinha._makeColor(doc.queryCommandValue("forecolor"));style.fontFamily=doc.queryCommandValue("fontname");style.fontWeight=doc.queryCommandState("bold")?"bold":"normal";style.fontStyle=doc.queryCommandState("italic")?"italic":"normal"}catch(ex){}}break;case"htmlmode":btn.state("active",text);break;case"lefttoright":case"righttoleft":var eltBlock=this.getParentElement();while(eltBlock&&!Xinha.isBlockElement(eltBlock)){eltBlock=eltBlock.parentNode}if(eltBlock){btn.state("active",(eltBlock.style.direction==((cmd=="righttoleft")?"rtl":"ltr")))}break;default:cmd=cmd.replace(/(un)?orderedlist/i,"insert$1orderedlist");try{btn.state("active",(!text&&doc.queryCommandState(cmd)))}catch(ex){}break}}if(this._customUndo&&!this._timerUndo){this._undoTakeSnapshot();var editor=this;this._timerUndo=setTimeout(function(){editor._timerUndo=null},this.config.undoTimeout)}this.firePluginEvent("onUpdateToolbar")};Xinha.getEditor=function(e){for(var f=__xinhas.length;f--;){var d=__xinhas[f];if(d&&(d._textArea.id==e||d._textArea.name==e||d._textArea==e)){return d}}return null};Xinha.prototype.getPluginInstance=function(b){if(this.plugins[b]){return this.plugins[b].instance}else{return null}};Xinha.prototype.getAllAncestors=function(){var d=this.getParentElement();var a=[];while(d&&(d.nodeType==1)&&(d.tagName.toLowerCase()!="body")){a.push(d);d=d.parentNode}a.push(this._doc.body);return a};Xinha.prototype._getFirstAncestor=function(j,f){var g=this.activeElement(j);if(g===null){try{g=(Xinha.is_ie?this.createRange(j).parentElement():this.createRange(j).commonAncestorContainer)}catch(h){return null}}if(typeof f=="string"){f=[f]}while(g){if(g.nodeType==1){if(f===null){return g}for(var i=0;i<f.length;++i){if(typeof f[i]=="string"&&f[i]==g.tagName.toLowerCase()){return g}else{if(typeof f[i]=="function"&&f[i](this,g)){return g}}}if(g.tagName.toLowerCase()=="body"){break}if(g.tagName.toLowerCase()=="table"){break}}g=g.parentNode}return null};Xinha.prototype._getAncestorBlock=function(c){var d=(Xinha.is_ie?this.createRange(c).parentElement:this.createRange(c).commonAncestorContainer);while(d&&(d.nodeType==1)){switch(d.tagName.toLowerCase()){case"div":case"p":case"address":case"blockquote":case"center":case"del":case"ins":case"pre":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"h7":return d;case"body":case"noframes":case"dd":case"li":case"th":case"td":case"noscript":return null;default:break}}return null};Xinha.prototype._createImplicitBlock=function(f){var e=this.getSelection();if(Xinha.is_ie){e.empty()}else{e.collapseToStart()}var d=this.createRange(e)};Xinha.prototype.surroundHTML=function(e,d){var f=this.getSelectedHTML();this.insertHTML(e+f+d)};Xinha.prototype.hasSelectedText=function(){return this.getSelectedHTML()!==""};Xinha.prototype._comboSelected=function(g,h){this.focusEditor();var f=g.options[g.selectedIndex].value;switch(h){case"fontname":case"fontsize":this.execCommand(h,false,f);break;case"formatblock":if(!f){this.updateToolbar();break}if(!Xinha.is_gecko||f!=="blockquote"){f="<"+f+">"}this.execCommand(h,false,f);break;default:var e=this.config.customSelects[h];if(typeof e!="undefined"){e.action(this,f,g,h)}else{alert("FIXME: combo box "+h+" not implemented")}break}};Xinha.prototype._colorSelector=function(p){var l=this;if(Xinha.is_gecko){try{l._doc.execCommand("useCSS",false,false);l._doc.execCommand("styleWithCSS",false,true)}catch(i){}}var j=l._toolbarObjects[p].element;var m;if(p=="hilitecolor"){if(Xinha.is_ie){p="backcolor";m=Xinha._colorToRgb(l._doc.queryCommandValue("backcolor"))}else{m=Xinha._colorToRgb(l._doc.queryCommandValue("hilitecolor"))}}else{m=Xinha._colorToRgb(l._doc.queryCommandValue("forecolor"))}var n=function(a){l._doc.execCommand(p,false,a)};if(Xinha.is_ie){var o=l.createRange(l.getSelection());n=function(a){o.select();l._doc.execCommand(p,false,a)}}var k=new Xinha.colorPicker({cellsize:l.config.colorPickerCellSize,callback:n,granularity:l.config.colorPickerGranularity,websafe:l.config.colorPickerWebSafe,savecolors:l.config.colorPickerSaveColors});k.open(l.config.colorPickerPosition,j,m)};Xinha.prototype.execCommand=function(p,j,i){var o=this;this.focusEditor();p=p.toLowerCase();if(this.firePluginEvent("onExecCommand",p,j,i)){this.updateToolbar();return false}switch(p){case"htmlmode":this.setMode();break;case"hilitecolor":case"forecolor":this._colorSelector(p);break;case"createlink":this._createLink();break;case"undo":case"redo":if(this._customUndo){this[p]()}else{this._doc.execCommand(p,j,i)}break;case"inserttable":this._insertTable();break;case"insertimage":this._insertImage();break;case"showhelp":this._popupDialog(o.config.URIs.help,null,this);break;case"killword":this._wordClean();break;case"cut":case"copy":case"paste":this._doc.execCommand(p,j,i);if(this.config.killWordOnPaste){this._wordClean()}break;case"lefttoright":case"righttoleft":if(this.config.changeJustifyWithDirection){this._doc.execCommand((p=="righttoleft")?"justifyright":"justifyleft",j,i)}var n=(p=="righttoleft")?"rtl":"ltr";var k=this.getParentElement();while(k&&!Xinha.isBlockElement(k)){k=k.parentNode}if(k){if(k.style.direction==n){k.style.direction=""}else{k.style.direction=n}}break;case"justifyleft":case"justifyright":p.match(/^justify(.*)$/);var l=this.activeElement(this.getSelection());if(l&&l.tagName.toLowerCase()=="img"){l.align=l.align==RegExp.$1?"":RegExp.$1}else{this._doc.execCommand(p,j,i)}break;default:try{this._doc.execCommand(p,j,i)}catch(m){if(this.config.debug){alert(m+"\n\nby execCommand("+p+");")}}break}this.updateToolbar();return false};Xinha.prototype._editorEvent=function(c){var d=this;if(typeof d._textArea["on"+c.type]=="function"){d._textArea["on"+c.type](c)}if(this.isKeyEvent(c)){if(d.firePluginEvent("onKeyPress",c)){return false}if(this.isShortCut(c)){this._shortCuts(c)}}if(c.type=="mousedown"){if(d.firePluginEvent("onMouseDown",c)){return false}}if(d._timerToolbar){clearTimeout(d._timerToolbar)}if(!this.suspendUpdateToolbar){d._timerToolbar=setTimeout(function(){d.updateToolbar();d._timerToolbar=null},250)}};Xinha.prototype._onDoubleClick=function(f){var g=this;var j=Xinha.is_ie?f.srcElement:f.target;var i=j.tagName;var h=j.className;if(i){i=i.toLowerCase();if(h&&(this.config.dblclickList[i+"."+h]!=undefined)){this.config.dblclickList[i+"."+h][0](g,j)}else{if(this.config.dblclickList[i]!=undefined){this.config.dblclickList[i][0](g,j)}}}};Xinha.prototype._shortCuts=function(g){var h=this.getKey(g).toLowerCase();var e=null;var f=null;switch(h){case"b":e="bold";break;case"i":e="italic";break;case"u":e="underline";break;case"s":e="strikethrough";break;case"l":e="justifyleft";break;case"e":e="justifycenter";break;case"r":e="justifyright";break;case"j":e="justifyfull";break;case"z":e="undo";break;case"y":e="redo";break;case"v":e="paste";break;case"n":e="formatblock";f="p";break;case"0":e="killword";break;case"1":case"2":case"3":case"4":case"5":case"6":e="formatblock";f="h"+h;break}if(e){this.execCommand(e,false,f);Xinha._stopEvent(g)}};Xinha.prototype.convertNode=function(d,e){var f=this._doc.createElement(e);while(d.firstChild){f.appendChild(d.firstChild)}return f};Xinha.prototype.scrollToElement=function(c){if(!c){c=this.getParentElement();if(!c){return}}var d=Xinha.getElementTopLeft(c);this._iframe.contentWindow.scrollTo(d.left,d.top)};Xinha.prototype.getEditorContent=function(){return this.outwardHtml(this.getHTML())};Xinha.prototype.setEditorContent=function(b){this.setHTML(this.inwardHtml(b))};Xinha.updateTextareas=function(){var c;for(var d=0;d<__xinhas.length;d++){c=__xinhas[d];c._textArea.value=c.getEditorContent()}};Xinha.prototype.getHTML=function(){var b="";switch(this._editMode){case"wysiwyg":if(!this.config.fullPage){b=Xinha.getHTML(this._doc.body,false,this).trim()}else{b=this.doctype+"\n"+Xinha.getHTML(this._doc.documentElement,true,this)}break;case"textmode":b=this._textArea.value;break;default:alert("Mode <"+this._editMode+"> not defined!");return false}return b};Xinha.prototype.outwardHtml=function(e){for(var f in this.plugins){var h=this.plugins[f].instance;if(h&&typeof h.outwardHtml=="function"){e=h.outwardHtml(e)}}e=e.replace(/<(\/?)b(\s|>|\/)/ig,"<$1strong$2");e=e.replace(/<(\/?)i(\s|>|\/)/ig,"<$1em$2");e=e.replace(/<(\/?)strike(\s|>|\/)/ig,"<$1del$2");e=e.replace(/(<[^>]*on(click|mouse(over|out|up|down))=['"])if\(window\.parent &amp;&amp; window\.parent\.Xinha\)\{return false\}/gi,"$1");var g=location.href.replace(/(https?:\/\/[^\/]*)\/.*/,"$1")+"/";e=e.replace(/https?:\/\/null\//g,g);e=e.replace(/((href|src|background)=[\'\"])\/+/ig,"$1"+g);e=this.outwardSpecialReplacements(e);e=this.fixRelativeLinks(e);if(this.config.sevenBitClean){e=e.replace(/[^ -~\r\n\t]/g,function(a){return(a!=Xinha.cc)?"&#"+a.charCodeAt(0)+";":a})}e=e.replace(/(<script[^>]*((type=[\"\']text\/)|(language=[\"\'])))(freezescript)/gi,"$1javascript");if(this.config.fullPage){e=Xinha.stripCoreCSS(e)}if(typeof this.config.outwardHtml=="function"){e=this.config.outwardHtml(e)}return e};Xinha.prototype.inwardHtml=function(f){for(var g in this.plugins){var h=this.plugins[g].instance;if(h&&typeof h.inwardHtml=="function"){f=h.inwardHtml(f)}}f=f.replace(/<(\/?)del(\s|>|\/)/ig,"<$1strike$2");f=f.replace(/(<[^>]*on(click|mouse(over|out|up|down))=["'])/gi,"$1if(window.parent &amp;&amp; window.parent.Xinha){return false}");f=this.inwardSpecialReplacements(f);f=f.replace(/(<script[^>]*((type=[\"\']text\/)|(language=[\"\'])))(javascript)/gi,"$1freezescript");var e=new RegExp("((href|src|background)=['\"])/+","gi");f=f.replace(e,"$1"+location.href.replace(/(https?:\/\/[^\/]*)\/.*/,"$1")+"/");f=this.fixRelativeLinks(f);if(this.config.fullPage){f=Xinha.addCoreCSS(f)}if(typeof this.config.inwardHtml=="function"){f=this.config.inwardHtml(f)}return f};Xinha.prototype.outwardSpecialReplacements=function(h){for(var i in this.config.specialReplacements){var j=this.config.specialReplacements[i];var f=i;if(typeof j.replace!="function"||typeof f.replace!="function"){continue}var g=new RegExp(Xinha.escapeStringForRegExp(j),"g");h=h.replace(g,f.replace(/\$/g,"$$$$"))}return h};Xinha.prototype.inwardSpecialReplacements=function(h){for(var i in this.config.specialReplacements){var j=i;var f=this.config.specialReplacements[i];if(typeof j.replace!="function"||typeof f.replace!="function"){continue}var g=new RegExp(Xinha.escapeStringForRegExp(j),"g");h=h.replace(g,f.replace(/\$/g,"$$$$"))}return h};Xinha.prototype.fixRelativeLinks=function(v){if(typeof this.config.expandRelativeUrl!="undefined"&&this.config.expandRelativeUrl){if(v==null){return""}var n=v.match(/(src|href)="([^"]*)"/gi);var s=document.location.href;if(n){var i,q,r,p,t;for(var b=0;b<n.length;++b){i=n[b].match(/(src|href)="([^"]*)"/i);q=i[2].match(/\.\.\//g);if(q){r=new RegExp("(.*?)(([^/]*/){"+q.length+"})[^/]*$");p=s.match(r);t=i[2].replace(/(\.\.\/)*/,p[1]);v=v.replace(new RegExp(Xinha.escapeStringForRegExp(i[2])),t)}}}}if(typeof this.config.stripSelfNamedAnchors!="undefined"&&this.config.stripSelfNamedAnchors){var u=new RegExp('((href|src|background)=")('+Xinha.escapeStringForRegExp(window.unescape(document.location.href.replace(/&/g,"&amp;")))+")([#?][^'\" ]*)","g");v=v.replace(u,"$1$4")}if(typeof this.config.stripBaseHref!="undefined"&&this.config.stripBaseHref){var o=null;if(typeof this.config.baseHref!="undefined"&&this.config.baseHref!==null){o=new RegExp('((href|src|background|action)=")('+Xinha.escapeStringForRegExp(this.config.baseHref.replace(/([^\/]\/)(?=.+\.)[^\/]*$/,"$1"))+")","g");v=v.replace(o,"$1")}o=new RegExp('((href|src|background|action)=")('+Xinha.escapeStringForRegExp(document.location.href.replace(/^(https?:\/\/[^\/]*)(.*)/,"$1"))+")","g");v=v.replace(o,"$1")}return v};Xinha.prototype.getInnerHTML=function(){if(!this._doc.body){return""}var b="";switch(this._editMode){case"wysiwyg":if(!this.config.fullPage){b=this._doc.body.innerHTML}else{b=this.doctype+"\n"+this._doc.documentElement.innerHTML}break;case"textmode":b=this._textArea.value;break;default:alert("Mode <"+this._editMode+"> not defined!");return false}return b};Xinha.prototype.setHTML=function(b){if(!this.config.fullPage){this._doc.body.innerHTML=b}else{this.setFullHTML(b)}this._textArea.value=b};Xinha.prototype.setDoctype=function(b){this.doctype=b};Xinha._object=null;Array.prototype.isArray=true;RegExp.prototype.isRegExp=true;Xinha.cloneObject=function(obj){if(!obj){return null}var newObj=obj.isArray?[]:{};if(obj.constructor.toString().match(/\s*function Function\(/)||typeof obj=="function"){newObj=obj}else{if(obj.isRegExp){newObj=eval(obj.toString())}else{for(var n in obj){var node=obj[n];if(typeof node=="object"){newObj[n]=Xinha.cloneObject(node)}else{newObj[n]=node}}}}return newObj};Xinha.extend=function(d,e){function f(){}f.prototype=e.prototype;d.prototype=new f();d.prototype.constructor=d;d.parentConstructor=e;d.superClass=e.prototype};Xinha.flushEvents=function(){var d=0;var e=Xinha._eventFlushers.pop();while(e){try{if(e.length==3){Xinha._removeEvent(e[0],e[1],e[2]);d++}else{if(e.length==2){e[0]["on"+e[1]]=null;e[0]._xinha_dom0Events[e[1]]=null;d++}}}catch(f){}e=Xinha._eventFlushers.pop()}};Xinha._eventFlushers=[];if(document.addEventListener){Xinha._addEvent=function(f,d,e){f.addEventListener(d,e,false);Xinha._eventFlushers.push([f,d,e])};Xinha._removeEvent=function(f,d,e){f.removeEventListener(d,e,false)};Xinha._stopEvent=function(b){b.preventDefault();b.stopPropagation()}}else{if(document.attachEvent){Xinha._addEvent=function(f,d,e){f.attachEvent("on"+d,e);Xinha._eventFlushers.push([f,d,e])};Xinha._removeEvent=function(f,d,e){f.detachEvent("on"+d,e)};Xinha._stopEvent=function(c){try{c.cancelBubble=true;c.returnValue=false}catch(d){}}}else{Xinha._addEvent=function(f,d,e){alert("_addEvent is not supported")};Xinha._removeEvent=function(f,d,e){alert("_removeEvent is not supported")};Xinha._stopEvent=function(b){alert("_stopEvent is not supported")}}}Xinha._addEvents=function(f,h,e){for(var g=h.length;--g>=0;){Xinha._addEvent(f,h[g],e)}};Xinha._removeEvents=function(f,h,e){for(var g=h.length;--g>=0;){Xinha._removeEvent(f,h[g],e)}};Xinha.addOnloadHandler=function(f,d){d=d?d:window;var e=function(){if(arguments.callee.done){return}arguments.callee.done=true;if(Xinha.onloadTimer){clearInterval(Xinha.onloadTimer)}f()};if(Xinha.is_ie){document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",arguments.callee);e()}});if(document.documentElement.doScroll&&typeof window.frameElement==="undefined"){(function(){if(arguments.callee.done){return}try{document.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}e()})()}}else{if(/applewebkit|KHTML/i.test(navigator.userAgent)){Xinha.onloadTimer=d.setInterval(function(){if(/loaded|complete/.test(d.document.readyState)){e()}},10)}else{d.document.addEventListener("DOMContentLoaded",e,false)}}Xinha._addEvent(d,"load",e)};Xinha.addDom0Event=function(f,e,d){Xinha._prepareForDom0Events(f,e);f._xinha_dom0Events[e].unshift(d)};Xinha.prependDom0Event=function(f,e,d){Xinha._prepareForDom0Events(f,e);f._xinha_dom0Events[e].push(d)};Xinha.getEvent=function(b){return b||window.event};Xinha._prepareForDom0Events=function(d,c){if(typeof d._xinha_dom0Events=="undefined"){d._xinha_dom0Events={};Xinha.freeLater(d,"_xinha_dom0Events")}if(typeof d._xinha_dom0Events[c]=="undefined"){d._xinha_dom0Events[c]=[];if(typeof d["on"+c]=="function"){d._xinha_dom0Events[c].push(d["on"+c])}d["on"+c]=function(h){var b=d._xinha_dom0Events[c];var g=true;for(var a=b.length;--a>=0;){d._xinha_tempEventHandler=b[a];if(d._xinha_tempEventHandler(h)===false){d._xinha_tempEventHandler=null;g=false;break}d._xinha_tempEventHandler=null}return g};Xinha._eventFlushers.push([d,c])}};Xinha.prototype.notifyOn=function(c,d){if(typeof this._notifyListeners[c]=="undefined"){this._notifyListeners[c]=[];Xinha.freeLater(this,"_notifyListeners")}this._notifyListeners[c].push(d)};Xinha.prototype.notifyOf=function(e,d){if(this._notifyListeners[e]){for(var f=0;f<this._notifyListeners[e].length;f++){this._notifyListeners[e][f](e,d)}}};Xinha._blockTags=" body form textarea fieldset ul ol dl li div p h1 h2 h3 h4 h5 h6 quote pre table thead tbody tfoot tr td th iframe address blockquote title meta link style head ";Xinha.isBlockElement=function(b){return b&&b.nodeType==1&&(Xinha._blockTags.indexOf(" "+b.tagName.toLowerCase()+" ")!=-1)};Xinha._paraContainerTags=" body td th caption fieldset div ";Xinha.isParaContainer=function(b){return b&&b.nodeType==1&&(Xinha._paraContainerTags.indexOf(" "+b.tagName.toLowerCase()+" ")!=-1)};Xinha._closingTags=" a abbr acronym address applet b bdo big blockquote button caption center cite code del dfn dir div dl em fieldset font form frameset h1 h2 h3 h4 h5 h6 i iframe ins kbd label legend map menu noframes noscript object ol optgroup pre q s samp script select small span strike strong style sub sup table textarea title tt u ul var ";Xinha.needsClosingTag=function(b){return b&&b.nodeType==1&&(Xinha._closingTags.indexOf(" "+b.tagName.toLowerCase()+" ")!=-1)};Xinha.htmlEncode=function(b){if(!b){return""}if(typeof b.replace=="undefined"){b=b.toString()}b=b.replace(/&/ig,"&amp;");b=b.replace(/</ig,"&lt;");b=b.replace(/>/ig,"&gt;");b=b.replace(/\xA0/g,"&nbsp;");b=b.replace(/\x22/g,"&quot;");return b};Xinha.prototype.stripBaseURL=function(f){if(this.config.baseHref===null||!this.config.stripBaseHref){return f}var e=this.config.baseHref.replace(/^(https?:\/\/[^\/]+)(.*)$/,"$1");var d=new RegExp(e);return f.replace(d,"")};if(typeof String.prototype.trim!="function"){String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}}Xinha._makeColor=function(h){if(typeof h!="number"){return h}var f=h&255;var g=(h>>8)&255;var b=(h>>16)&255;return"rgb("+f+","+g+","+b+")"};Xinha._colorToRgb=function(l){if(!l){return""}var g,i,b;function j(a){return(a<16)?("0"+a.toString(16)):a.toString(16)}if(typeof l=="number"){g=l&255;i=(l>>8)&255;b=(l>>16)&255;return"#"+j(g)+j(i)+j(b)}if(l.substr(0,3)=="rgb"){var k=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/;if(l.match(k)){g=parseInt(RegExp.$1,10);i=parseInt(RegExp.$2,10);b=parseInt(RegExp.$3,10);return"#"+j(g)+j(i)+j(b)}return null}if(l.substr(0,1)=="#"){return l}return null};Xinha.prototype._popupDialog=function(f,d,e){Dialog(this.popupURL(f),d,e)};Xinha.prototype.imgURL=function(c,d){if(typeof d=="undefined"){return _editor_url+c}else{return Xinha.getPluginDir(d)+"/img/"+c}};Xinha.prototype.popupURL=function(e){var f="";if(e.match(/^plugin:\/\/(.*?)\/(.*)/)){var g=RegExp.$1;var h=RegExp.$2;if(!/\.(html?|php)$/.test(h)){h+=".html"}f=Xinha.getPluginDir(g)+"/popups/"+h}else{if(e.match(/^\/.*?/)||e.match(/^https?:\/\//)){f=e}else{f=_editor_url+this.config.popupURL+e}}return f};Xinha.getElementById=function(i,j){var g,h,f=document.getElementsByTagName(i);for(h=f.length;--h>=0&&(g=f[h]);){if(g.id==j){return g}}return null};Xinha.prototype._toggleBorders=function(){var d=this._doc.getElementsByTagName("TABLE");if(d.length!==0){if(!this.borders){this.borders=true}else{this.borders=false}for(var c=0;c<d.length;c++){if(this.borders){Xinha._addClass(d[c],"htmtableborders")}else{Xinha._removeClass(d[c],"htmtableborders")}}}return true};Xinha.addCoreCSS=function(c){var d='<style title="XinhaInternalCSS" type="text/css">.htmtableborders, .htmtableborders td, .htmtableborders th {border : 1px dashed lightgrey ! important;}\nhtml, body { border: 0px; } \nbody { background-color: #ffffff; } \nimg, hr { cursor: default } \n</style>\n';if(c&&/<head>/i.test(c)){return c.replace(/<head>/i,"<head>"+d)}else{if(c){return d+c}else{return d}}};Xinha.prototype.addEditorStylesheet=function(d){var c=this._doc.createElement("link");c.rel="stylesheet";c.type="text/css";c.title="XinhaInternalCSS";c.href=d;this._doc.getElementsByTagName("HEAD")[0].appendChild(c)};Xinha.stripCoreCSS=function(b){return b.replace(/<style[^>]+title="XinhaInternalCSS"(.|\n)*?<\/style>/ig,"").replace(/<link[^>]+title="XinhaInternalCSS"(.|\n)*?>/ig,"")};Xinha._removeClass=function(j,g){if(!(j&&j.className)){return}var i=j.className.split(" ");var h=[];for(var f=i.length;f>0;){if(i[--f]!=g){h[h.length]=i[f]}}j.className=h.join(" ")};Xinha._addClass=function(c,d){Xinha._removeClass(c,d);c.className+=" "+d};Xinha.addClasses=function(m,h){if(m!==null){var n=m.className.trim().split(" ");var i=h.split(" ");for(var l=0;l<i.length;l++){var k=false;for(var j=0;k===false&&j<n.length;j++){if(n[j]==i[l]){k=true}}if(k===false){n[n.length]=i[l]}}m.className=n.join(" ").trim()}};Xinha.removeClasses=function(k,l){var n=k.className.trim().split();var j=[];var p=l.trim().split();for(var m=0;m<n.length;m++){var i=false;for(var o=0;o<p.length&&!i;o++){if(n[m]==p[o]){i=true}}if(!i){j[j.length]=n[m]}}return j.join(" ")};Xinha.addClass=Xinha._addClass;Xinha.removeClass=Xinha._removeClass;Xinha._addClasses=Xinha.addClasses;Xinha._removeClasses=Xinha.removeClasses;Xinha._hasClass=function(e,g){if(!(e&&e.className)){return false}var h=e.className.split(" ");for(var f=h.length;f>0;){if(h[--f]==g){return true}}return false};Xinha._postback_send_charset=true;Xinha._postback=function(n,i,p,l){var j=null;j=Xinha.getXMLHTTPRequestObject();var k="";if(typeof i=="string"){k=i}else{if(typeof i=="object"){for(var m in i){k+=(k.length?"&":"")+m+"="+encodeURIComponent(i[m])}}}function o(){if(j.readyState==4){if(((j.status/100)==2)||Xinha.isRunLocally&&j.status===0){if(typeof p=="function"){p(j.responseText,j)}}else{if(Xinha._postback_send_charset){Xinha._postback_send_charset=false;Xinha._postback(n,i,p,l)}else{if(typeof l=="function"){l(j)}else{alert("An error has occurred: "+j.statusText+"\nURL: "+n)}}}}}j.onreadystatechange=o;j.open("POST",n,true);j.setRequestHeader("Content-Type","application/x-www-form-urlencoded"+(Xinha._postback_send_charset?"; charset=UTF-8":""));j.send(k)};Xinha._getback=function(h,j,g){var f=null;f=Xinha.getXMLHTTPRequestObject();function i(){if(f.readyState==4){if(((f.status/100)==2)||Xinha.isRunLocally&&f.status===0){j(f.responseText,f)}else{if(typeof g=="function"){g(f)}else{alert("An error has occurred: "+f.statusText+"\nURL: "+h)}}}}f.onreadystatechange=i;f.open("GET",h,true);f.send(null)};Xinha.ping=function(g,h,i){var l=null;l=Xinha.getXMLHTTPRequestObject();function j(){if(l.readyState==4){if(((l.status/100)==2)||Xinha.isRunLocally&&l.status===0){if(h){h(l)}}else{if(i){i(l)}}}}var k="GET";l.onreadystatechange=j;l.open(k,g,true);l.send(null)};Xinha._geturlcontent=function(d,e){var f=null;f=Xinha.getXMLHTTPRequestObject();f.open("GET",d,false);f.send(null);if(((f.status/100)==2)||Xinha.isRunLocally&&f.status===0){return(e)?f.responseXML:f.responseText}else{return""}};if(typeof dumpValues=="undefined"){dumpValues=function(f){var g="";for(var e in f){if(window.console&&typeof window.console.log=="function"){if(typeof console.firebug!="undefined"){console.log(f)}else{console.log(e+" = "+f[e]+"\n")}}else{g+=e+" = "+f[e]+"\n"}}if(g){if(document.getElementById("errors")){document.getElementById("errors").value+=g}else{var h=window.open("","debugger");h.document.write("<pre>"+g+"</pre>")}}}}if(!Array.prototype.contains){Array.prototype.contains=function(e){var f=this;for(var d=0;d<f.length;d++){if(e==f[d]){return true}}return false}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(e){var f=this;for(var d=0;d<f.length;d++){if(e==f[d]){return d}}return null}}if(!Array.prototype.append){Array.prototype.append=function(a){for(var d=0;d<a.length;d++){this.push(a[d])}return this}}if(!Array.prototype.forEach){Array.prototype.forEach=function(e){var h=this.length;if(typeof e!="function"){throw new TypeError()}var f=arguments[1];for(var g=0;g<h;g++){if(g in this){e.call(f,this[g],g,this)}}}}Xinha.getElementsByClassName=function(g,j){if(g.getElementsByClassName){return Array.prototype.slice.call(g.getElementsByClassName(j))}else{var h=g.getElementsByTagName("*");var l=[];var k;for(var i=0;i<h.length;i++){k=h[i].className.split(" ");if(k.contains(j)){l.push(h[i])}}return l}};Xinha.arrayContainsArray=function(h,i){var l=true;for(var j=0;j<i.length;j++){var k=false;for(var g=0;g<h.length;g++){if(h[g]==i[j]){k=true;break}}if(!k){l=false;break}}return l};Xinha.arrayFilter=function(f,g){var e=[];for(var h=0;h<f.length;h++){if(g(f[h])){e[e.length]=f[h]}}return e};Xinha.collectionToArray=function(f){try{return f.length?Array.prototype.slice.call(f):[]}catch(g){}var e=[];for(var h=0;h<f.length;h++){e.push(f.item(h))}return e};Xinha.uniq_count=0;Xinha.uniq=function(b){return b+Xinha.uniq_count++};Xinha._loadlang=function(context,url){var lang;if(typeof _editor_lcbackend=="string"){url=_editor_lcbackend;url=url.replace(/%lang%/,_editor_lang);url=url.replace(/%context%/,context)}else{if(!url){if(context!="Xinha"){url=Xinha.getPluginDir(context)+"/lang/"+_editor_lang+".js"}else{Xinha.setLoadingMessage("Loading language");url=_editor_url+"lang/"+_editor_lang+".js"}}}var langData=Xinha._geturlcontent(url);if(langData!==""){try{eval("lang = "+langData)}catch(ex){alert("Error reading Language-File ("+url+"):\n"+Error.toString());lang={}}}else{lang={}}return lang};Xinha._lc=function(o,q,p){var r,k;if(typeof q=="object"&&q.url&&q.context){r=q.url+_editor_lang+".js";q=q.context}var m=null;if(typeof o=="string"){m=o.match(/\$(.*?)=(.*?)\$/g)}if(m){if(!p){p={}}for(var l=0;l<m.length;l++){var n=m[l].match(/\$(.*?)=(.*?)\$/);p[n[1]]=n[2];o=o.replace(n[0],"$"+n[1])}}if(_editor_lang=="en"){if(typeof o=="object"&&o.string){k=o.string}else{k=o}}else{if(typeof Xinha._lc_catalog=="undefined"){Xinha._lc_catalog=[]}if(typeof q=="undefined"){q="Xinha"}if(typeof Xinha._lc_catalog[q]=="undefined"){Xinha._lc_catalog[q]=Xinha._loadlang(q,r)}var i;if(typeof o=="object"&&o.key){i=o.key}else{if(typeof o=="object"&&o.string){i=o.string}else{i=o}}if(typeof Xinha._lc_catalog[q][i]=="undefined"){if(q=="Xinha"){if(typeof o=="object"&&o.string){k=o.string}else{k=o}}else{return Xinha._lc(o,"Xinha",p)}}else{k=Xinha._lc_catalog[q][i]}}if(typeof o=="object"&&o.replace){p=o.replace}if(typeof p!="undefined"){for(l in p){k=k.replace("$"+l,p[l])}}return k};Xinha.hasDisplayedChildren=function(e){var f=e.childNodes;for(var d=0;d<f.length;d++){if(f[d].tagName){if(f[d].style.display!="none"){return true}}}return false};Xinha._loadback=function(j,l,g,k){if(document.getElementById(j)){return true}var i=!Xinha.is_ie?"onload":"onreadystatechange";var h=document.createElement("script");h.type="text/javascript";h.src=j;h.id=j;if(l){h[i]=function(){if(Xinha.is_ie&&(!/loaded|complete/.test(window.event.srcElement.readyState))){return}l.call(g?g:this,k);h[i]=null}}document.getElementsByTagName("head")[0].appendChild(h);return false};Xinha.makeEditors=function(i,n,m){if(!Xinha.isSupportedBrowser){return}if(typeof n=="function"){n=n()}var k={};var h;for(var l=0;l<i.length;l++){if(typeof i[l]=="string"){h=Xinha.getElementById("textarea",i[l]);if(!h){i[l]=null;continue}}else{if(typeof i[l]=="object"&&i[l].tagName&&i[l].tagName.toLowerCase()=="textarea"){h=i[l];if(!h.id){h.id="xinha_id_"+l}}}var j=new Xinha(h,Xinha.cloneObject(n));j.registerPlugins(m);k[h.id]=j}return k};Xinha.startEditors=function(d){if(!Xinha.isSupportedBrowser){return}for(var c in d){if(d[c].generate){d[c].generate()}}};Xinha.prototype.registerPlugins=function(c){if(!Xinha.isSupportedBrowser){return}if(c){for(var d=0;d<c.length;d++){this.setLoadingMessage(Xinha._lc("Register plugin $plugin","Xinha",{plugin:c[d]}));this.registerPlugin(c[d])}}};Xinha.base64_encode=function(i){var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var n="";var q,s,t;var p,r,u,v;var o=0;do{q=i.charCodeAt(o++);s=i.charCodeAt(o++);t=i.charCodeAt(o++);p=q>>2;r=((q&3)<<4)|(s>>4);u=((s&15)<<2)|(t>>6);v=t&63;if(isNaN(s)){u=v=64}else{if(isNaN(t)){v=64}}n=n+m.charAt(p)+m.charAt(r)+m.charAt(u)+m.charAt(v)}while(o<i.length);return n};Xinha.base64_decode=function(i){var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var n="";var q,s,t;var p,r,u,v;var o=0;i=i.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{p=m.indexOf(i.charAt(o++));r=m.indexOf(i.charAt(o++));u=m.indexOf(i.charAt(o++));v=m.indexOf(i.charAt(o++));q=(p<<2)|(r>>4);s=((r&15)<<4)|(u>>2);t=((u&3)<<6)|v;n=n+String.fromCharCode(q);if(u!=64){n=n+String.fromCharCode(s)}if(v!=64){n=n+String.fromCharCode(t)}}while(o<i.length);return n};Xinha.removeFromParent=function(c){if(!c.parentNode){return}var d=c.parentNode;return d.removeChild(c)};Xinha.hasParentNode=function(b){if(b.parentNode){if(b.parentNode.nodeType==11){return false}return true}return false};Xinha.viewportSize=function(f){f=(f)?f:window;var d,e;if(f.innerHeight){d=f.innerWidth;e=f.innerHeight}else{if(f.document.documentElement&&f.document.documentElement.clientHeight){d=f.document.documentElement.clientWidth;e=f.document.documentElement.clientHeight}else{if(f.document.body){d=f.document.body.clientWidth;e=f.document.body.clientHeight}}}return{x:d,y:e}};Xinha.pageSize=function(f){f=(f)?f:window;var i,j;var g=f.document.body.scrollHeight;var h=f.document.documentElement.scrollHeight;if(g>h){i=f.document.body.scrollWidth;j=f.document.body.scrollHeight}else{i=f.document.documentElement.scrollWidth;j=f.document.documentElement.scrollHeight}return{x:i,y:j}};Xinha.prototype.scrollPos=function(f){f=(f)?f:window;var d,e;if(typeof f.pageYOffset!="undefined"){d=f.pageXOffset;e=f.pageYOffset}else{if(f.document.documentElement&&typeof document.documentElement.scrollTop!="undefined"){d=f.document.documentElement.scrollLeft;e=f.document.documentElement.scrollTop}else{if(f.document.body){d=f.document.body.scrollLeft;e=f.document.body.scrollTop}}}return{x:d,y:e}};Xinha.getElementTopLeft=function(f){var e=0;var d=0;if(f.offsetParent){e=f.offsetLeft;d=f.offsetTop;while(f=f.offsetParent){e+=f.offsetLeft;d+=f.offsetTop}}return{top:d,left:e}};Xinha.findPosX=function(d){var c=0;if(d.offsetParent){return Xinha.getElementTopLeft(d).left}else{if(d.x){c+=d.x}}return c};Xinha.findPosY=function(c){var d=0;if(c.offsetParent){return Xinha.getElementTopLeft(c).top}else{if(c.y){d+=c.y}}return d};Xinha.createLoadingMessages=function(c){if(Xinha.loadingMessages||!Xinha.isSupportedBrowser){return}Xinha.loadingMessages=[];for(var d=0;d<c.length;d++){if(!document.getElementById(c[d])){continue}Xinha.loadingMessages.push(Xinha.createLoadingMessage(Xinha.getElementById("textarea",c[d])))}};Xinha.createLoadingMessage=function(f,j){if(document.getElementById("loading_"+f.id)||!Xinha.isSupportedBrowser){return}var i=document.createElement("div");i.id="loading_"+f.id;i.className="loading";i.style.left=(Xinha.findPosX(f)+f.offsetWidth/2)-106+"px";i.style.top=(Xinha.findPosY(f)+f.offsetHeight/2)-50+"px";var h=document.createElement("div");h.className="loading_main";h.id="loading_main_"+f.id;h.appendChild(document.createTextNode(Xinha._lc("Loading in progress. Please wait!")));var g=document.createElement("div");g.className="loading_sub";g.id="loading_sub_"+f.id;j=j?j:Xinha._lc("Loading Core");g.appendChild(document.createTextNode(j));i.appendChild(h);i.appendChild(g);document.body.appendChild(i);Xinha.freeLater(i);Xinha.freeLater(h);Xinha.freeLater(g);return g};Xinha.prototype.setLoadingMessage=function(c,d){if(!document.getElementById("loading_sub_"+this._textArea.id)){return}document.getElementById("loading_main_"+this._textArea.id).innerHTML=d?d:Xinha._lc("Loading in progress. Please wait!");document.getElementById("loading_sub_"+this._textArea.id).innerHTML=c};Xinha.setLoadingMessage=function(c){if(!Xinha.loadingMessages){return}for(var d=0;d<Xinha.loadingMessages.length;d++){Xinha.loadingMessages[d].innerHTML=c}};Xinha.prototype.removeLoadingMessage=function(){if(document.getElementById("loading_"+this._textArea.id)){document.body.removeChild(document.getElementById("loading_"+this._textArea.id))}};Xinha.removeLoadingMessages=function(e){for(var f=0;f<e.length;f++){if(!document.getElementById(e[f])){continue}var d=document.getElementById("loading_"+document.getElementById(e[f]).id);d.parentNode.removeChild(d)}Xinha.loadingMessages=null};Xinha.toFree=[];Xinha.freeLater=function(d,c){Xinha.toFree.push({o:d,p:c})};Xinha.free=function(f,e){if(f&&!e){for(var g in f){Xinha.free(f,g)}}else{if(f){if(e.indexOf("src")==-1){try{f[e]=null}catch(h){}}}}};Xinha.collectGarbageForIE=function(){Xinha.flushEvents();for(var b=0;b<Xinha.toFree.length;b++){Xinha.free(Xinha.toFree[b].o,Xinha.toFree[b].p);Xinha.toFree[b].o=null}};Xinha.prototype.insertNodeAtSelection=function(b){Xinha.notImplemented("insertNodeAtSelection")};Xinha.prototype.getParentElement=function(b){Xinha.notImplemented("getParentElement")};Xinha.prototype.activeElement=function(b){Xinha.notImplemented("activeElement")};Xinha.prototype.selectionEmpty=function(b){Xinha.notImplemented("selectionEmpty")};Xinha.prototype.saveSelection=function(){Xinha.notImplemented("saveSelection")};Xinha.prototype.restoreSelection=function(b){Xinha.notImplemented("restoreSelection")};Xinha.prototype.selectNodeContents=function(d,c){Xinha.notImplemented("selectNodeContents")};Xinha.prototype.insertHTML=function(b){Xinha.notImplemented("insertHTML")};Xinha.prototype.getSelectedHTML=function(){Xinha.notImplemented("getSelectedHTML")};Xinha.prototype.getSelection=function(){Xinha.notImplemented("getSelection")};Xinha.prototype.createRange=function(b){Xinha.notImplemented("createRange")};Xinha.prototype.isKeyEvent=function(b){Xinha.notImplemented("isKeyEvent")};Xinha.prototype.isShortCut=function(b){if(b.ctrlKey&&!b.altKey){return true}return false};Xinha.prototype.getKey=function(b){Xinha.notImplemented("getKey")};Xinha.getOuterHTML=function(b){Xinha.notImplemented("getOuterHTML")};Xinha.getXMLHTTPRequestObject=function(){try{if(typeof XMLHttpRequest!="undefined"&&typeof XMLHttpRequest.constructor=="function"){return new XMLHttpRequest()}else{if(typeof ActiveXObject=="function"){return new ActiveXObject("Microsoft.XMLHTTP")}}}catch(b){Xinha.notImplemented("getXMLHTTPRequestObject")}};Xinha.prototype._activeElement=function(b){return this.activeElement(b)};Xinha.prototype._selectionEmpty=function(b){return this.selectionEmpty(b)};Xinha.prototype._getSelection=function(){return this.getSelection()};Xinha.prototype._createRange=function(b){return this.createRange(b)};HTMLArea=Xinha;Xinha.init();if(Xinha.ie_version<8){Xinha.addDom0Event(window,"unload",Xinha.collectGarbageForIE)}Xinha.debugMsg=function(d,c){if(typeof console!="undefined"&&typeof console.log=="function"){if(c&&c=="warn"&&typeof console.warn=="function"){console.warn(d)}else{if(c&&c=="info"&&typeof console.info=="function"){console.info(d)}else{console.log(d)}}}else{if(typeof opera!="undefined"&&typeof opera.postError=="function"){opera.postError(d)}}};Xinha.notImplemented=function(b){throw new Error("Method Not Implemented","Part of Xinha has tried to call the "+b+" method which has not been implemented.")};