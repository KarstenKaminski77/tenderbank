/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
Xinha.Dialog=function(D,A,x,J,C){var y=this;this.id={};this.r_id={};this.editor=D;this.document=document;this.size=J;this.modal=(C&&C.modal===false)?false:true;this.closable=(C&&C.closable===false)?false:true;this.resizable=(C&&C.resizable===false)?false:true;this.layer=(C&&C.layer)?C.layer:0;this.centered=(C&&C.centered===true)?true:false;this.closeOnEscape=(C&&C.closeOnEscape===true)?true:false;this.rootElem=null;this.captionBar=null;this.main=null;this.background=null;this.centered=null;this.greyout=null;this.buttons=null;this.closer=null;this.icon=null;this.resizer=null;this.initialZ=null;var L=D.config.dialogOptions;if(L){if(typeof L.centered!="undefined"){this.centered=L.centered}if(typeof L.resizable!="undefined"){this.resizable=L.resizable}if(typeof L.closable!="undefined"){this.closable=L.closable}if(typeof L.greyout!="undefined"){this.greyout=L.greyout}if(typeof L.closeOnEscape!="undefined"){this.closeOnEscape=L.closeOnEscape}}var p;if(Xinha.is_ie){p=document.createElement("iframe");p.src="about:blank";p.onreadystatechange=function(){var c=window.event.srcElement.contentWindow.document;if(this.readyState=="complete"&&c&&c.body){var d=c.createElement("div");var b,e=document.styleSheets;for(var a=0;a<e.length;a++){if(e[a].id.indexOf("Xinha")!=-1&&e[a].cssText){b+=e[a].cssText}}d.innerHTML='<br><style type="text/css">\n'+b+"\n</style>";c.getElementsByTagName("body")[0].appendChild(d);c.body.className="xinha_dialog_background";if(y.modal){c.body.className+="_modal"}if(y.greyout){c.body.className+="_greyout"}}}}else{p=document.createElement("div")}p.className="xinha_dialog_background";if(this.modal){p.className+="_modal"}if(this.greyout){p.className+="_greyout"}var B=1000;if(!Xinha.Dialog.initialZ){var I=D._htmlArea;while(I){if(I.style&&parseInt(I.style.zIndex,10)>B){B=parseInt(I.style.zIndex,10)}I=I.parentNode}Xinha.Dialog.initialZ=B}B=Xinha.Dialog.initialZ;var w=p.style;w.position="absolute";w.top=0;w.left=0;w.border="none";w.overflow="hidden";w.display="none";w.zIndex=(this.modal?B+25:B+1)+this.layer;document.body.appendChild(p);this.background=p;p=null;Xinha.freeLater(this,"background");var z=document.createElement("div");z.style.position=(Xinha.is_ie||!this.modal)?"absolute":"fixed";z.style.zIndex=(this.modal?B+27:B+3)+this.layer;z.style.display="none";if(!this.modal){Xinha._addEvent(z,"mousedown",function(){Xinha.Dialog.activateModeless(y)})}z.className="dialog"+(this.modal?"":" modeless");if(Xinha.is_chrome){z.className+=" chrome"}document.body.appendChild(z);z.style.paddingBottom="10px";z.style.width=(J&&J.width)?J.width+"px":"";if(J&&J.height){if(Xinha.ie_version<7){z.style.height=J.height+"px"}else{z.style.minHeight=J.height+"px"}}A=this.translateHtml(A,x);var F=document.createElement("div");z.appendChild(F);F.innerHTML=A;this.fixupDOM(F,x);var G=F.removeChild(F.getElementsByTagName("h1")[0]);z.insertBefore(G,F);Xinha._addEvent(G,"mousedown",function(a){y.dragStart(a)});G.style.MozUserSelect="none";G.style.WebkitUserSelect="none";G.unselectable="on";G.onselectstart=function(){return false};this.buttons=document.createElement("div");w=this.buttons.style;w.position="absolute";w.top="0";w.right="2px";z.appendChild(this.buttons);if(this.closable&&this.closeOnEscape){Xinha._addEvent(document,"keypress",function(a){if(a.keyCode==27){if(Xinha.Dialog.activeModeless==y||y.modal){y.hide();return true}}})}this.closer=null;if(this.closable){this.closer=document.createElement("div");this.closer.className="closeButton";this.closer.onmousedown=function(a){this.className="closeButton buttonClick";Xinha._stopEvent(Xinha.getEvent(a));return false};this.closer.onmouseout=function(a){this.className="closeButton";Xinha._stopEvent(Xinha.getEvent(a));return false};this.closer.onmouseup=function(){this.className="closeButton";y.hide();return false};this.buttons.appendChild(this.closer);var i=document.createElement("span");i.className="innerX";i.style.position="relative";i.style.top="-3px";i.appendChild(document.createTextNode("\u00D7"));this.closer.appendChild(i);i=null}this.icon=document.createElement("img");var s=this.icon;s.className="icon";s.src=D.config.iconList.dialogCaption;s.style.position="absolute";s.style.top="3px";s.style.left="2px";s.ondrag=function(){return false};z.appendChild(this.icon);var H=z.getElementsByTagName("*");for(var E=0;E<H.length;E++){var K=H[E];if(K.tagName.toLowerCase()=="textarea"||K.tagName.toLowerCase()=="input"){}else{K.unselectable="on"}}this.resizer=null;if(this.resizable){this.resizer=document.createElement("div");this.resizer.className="resizeHandle";w=this.resizer.style;w.position="absolute";w.bottom="0px";w.right="0px";w.MozUserSelect="none";Xinha._addEvent(this.resizer,"mousedown",function(a){y.resizeStart(a)});z.appendChild(this.resizer)}this.rootElem=z;this.captionBar=G;this.main=F;G=null;z=null;F=null;Xinha.freeLater(this,"rootElem");Xinha.freeLater(this,"captionBar");Xinha.freeLater(this,"main");Xinha.freeLater(this,"buttons");Xinha.freeLater(this,"closer");Xinha.freeLater(this,"icon");Xinha.freeLater(this,"resizer");Xinha.freeLater(this,"document");this.size={}};Xinha.Dialog.prototype.onresize=function(){return true};Xinha.Dialog.prototype.show=function(A){var q=this.rootElem;var w=q.style;var z=this.modal;var u=this.editor.scrollPos();this.scrollPos=u;var y=this;if(this.attached){this.editor.showPanel(q)}if(Xinha._someEditorHasBeenActivated){this._lastRange=this.editor.saveSelection();if(Xinha.is_ie&&!z){y.saveSelection=function(){y._lastRange=y.editor.saveSelection()};Xinha._addEvent(this.editor._doc,"mouseup",y.saveSelection)}}if(z){this.editor.deactivateEditor();this.editor.suspendUpdateToolbar=true;this.editor.currentModal=y}if(Xinha.is_ff2&&z){this._restoreTo=[this.editor._textArea.style.display,this.editor._iframe.style.visibility,this.editor.hidePanels()];this.editor._textArea.style.display="none";this.editor._iframe.style.visibility="hidden"}if(!this.attached){if(z){this.showBackground();this.posBackground({top:0,left:0});this.resizeBackground(Xinha.Dialog.calcFullBgSize())}else{this.background.style.display=""}Xinha.Dialog.fadeIn(this.rootElem,100,function(){if(z){var a=y.rootElem.getElementsByTagName("input");for(var c=0;c<a.length;c++){if(a[c].type=="text"){try{a[c].focus();break}catch(b){}}}}});var B=q.offsetHeight;var s=q.offsetWidth;var p=Xinha.viewportSize();var r=p.y;var v=p.x;if(B>r){w.height=r+"px";if(q.scrollHeight>B){y.main.style.overflowY="auto"}}if(this.size.top&&this.size.left){w.top=parseInt(this.size.top,10)+"px";w.left=parseInt(this.size.left,10)+"px"}else{if(this.editor.btnClickEvent&&!this.centered){var x=this.editor.btnClickEvent;if(w.position=="absolute"){w.top=x.clientY+this.scrollPos.y+"px"}else{w.top=x.clientY+"px"}if(B+q.offsetTop>r){w.top=(w.position=="absolute"?this.scrollPos.y:0)+"px"}if(w.position=="absolute"){w.left=x.clientX+this.scrollPos.x+"px"}else{w.left=x.clientX+"px"}if(s+q.offsetLeft>v){w.left=x.clientX-s+"px";if(q.offsetLeft<0){w.left=0}}this.editor.btnClickEvent=null}else{var o=(r-B)/2;var t=(v-s)/2;w.top=((o>0)?o:0)+"px";w.left=((t>0)?t:0)+"px"}}}this.width=s;this.height=B;if(!z){this.resizeBackground({width:s+"px",height:B+"px"});this.posBackground({top:w.top,left:w.left})}if(typeof A!="undefined"){this.setValues(A)}this.dialogShown=true};Xinha.Dialog.prototype.hide=function(){if(this.attached){this.editor.hidePanel(this.rootElem)}else{Xinha.Dialog.fadeOut(this.rootElem);this.hideBackground();var b=this;if(Xinha.is_ff2&&this.modal){this.editor._textArea.style.display=this._restoreTo[0];this.editor._iframe.style.visibility=this._restoreTo[1];this.editor.showPanels(this._restoreTo[2])}if(!this.editor._isFullScreen&&this.modal){window.scroll(this.scrollPos.x,this.scrollPos.y)}if(Xinha.is_ie&&!this.modal){Xinha._removeEvent(this.editor._doc,"mouseup",b.saveSelection)}if(this.modal){this.editor.suspendUpdateToolbar=false;this.editor.currentModal=null;this.editor.activateEditor()}}if(this.modal){this.editor.restoreSelection(this._lastRange)}this.dialogShown=false;this.editor.updateToolbar();this.editor.focusEditor();return this.getValues()};Xinha.Dialog.prototype.toggle=function(){if(this.rootElem.style.display=="none"){this.show()}else{this.hide()}};Xinha.Dialog.prototype.collapse=function(){if(this.collapsed){this.collapsed=false;this.show()}else{this.main.style.height=0;this.collapsed=true}};Xinha.Dialog.prototype.getElementById=function(b){if(!this.rootElem.parentNode){this.document.body.appendChild(this.rootElem)}return this.document.getElementById(this.id[b]?this.id[b]:b)};Xinha.Dialog.prototype.getElementsByName=function(d){if(!this.rootElem.parentNode){this.document.body.appendChild(this.rootElem)}var c=this.document.getElementsByName(this.id[d]?this.id[d]:d);return Xinha.collectionToArray(c)};Xinha.Dialog.prototype.getElementsByClassName=function(b){return Xinha.getElementsByClassName(this.rootElem,b)};Xinha.Dialog.prototype.dragStart=function(e){if(this.attached||this.dragging){return}if(!this.modal){this.posBackground({top:0,left:0});this.resizeBackground(Xinha.Dialog.calcFullBgSize());this.editor.suspendUpdateToolbar=true}e=Xinha.getEvent(e);var f=this;f.dragging=true;f.scrollPos=f.editor.scrollPos();var d=f.rootElem.style;f.xOffs=e.offsetX||e.layerX;f.yOffs=e.offsetY||e.layerY;f.mouseMove=function(a){f.dragIt(a)};Xinha._addEvent(document,"mousemove",f.mouseMove);if(Xinha.is_ie){Xinha._addEvent(this.background.contentWindow.document,"mousemove",f.mouseMove)}f.mouseUp=function(a){f.dragEnd(a)};Xinha._addEvent(document,"mouseup",f.mouseUp);if(Xinha.is_ie){Xinha._addEvent(this.background.contentWindow.document,"mouseup",f.mouseUp)}};Xinha.Dialog.prototype.dragIt=function(g){var h=this;if(!h.dragging){return false}var f,j,i;if(h.rootElem.style.position=="absolute"){f=(g.clientY+this.scrollPos.y)-h.yOffs+"px";j=(g.clientX+this.scrollPos.x)-h.xOffs+"px";i={top:f,left:j}}else{if(h.rootElem.style.position=="fixed"){f=g.clientY-h.yOffs+"px";j=g.clientX-h.xOffs+"px";i={top:f,left:j}}}h.posDialog(i)};Xinha.Dialog.prototype.dragEnd=function(f){var d=this;if(!this.modal){this.editor.suspendUpdateToolbar=false}if(!d.dragging){return false}d.dragging=false;Xinha._removeEvent(document,"mousemove",d.mouseMove);if(Xinha.is_ie){Xinha._removeEvent(this.background.contentWindow.document,"mousemove",d.mouseMove)}Xinha._removeEvent(document,"mouseup",d.mouseUp);if(Xinha.is_ie){Xinha._removeEvent(this.background.contentWindow.document,"mouseup",d.mouseUp)}var e=d.rootElem.style;d.size.top=e.top;d.size.left=e.left;if(!this.modal){this.sizeBgToDialog()}};Xinha.Dialog.prototype.resizeStart=function(e){var f=this;if(f.resizing){return}f.resizing=true;if(!this.modal){this.editor.suspendUpdateToolbar=true;this.posBackground({top:0,left:0});this.resizeBackground(Xinha.Dialog.calcFullBgSize())}f.scrollPos=f.editor.scrollPos();var d=f.rootElem.style;d.minHeight="";d.overflow="hidden";f.xOffs=parseInt(d.left,10);f.yOffs=parseInt(d.top,10);f.mouseMove=function(a){f.resizeIt(a)};Xinha._addEvent(document,"mousemove",f.mouseMove);if(Xinha.is_ie){Xinha._addEvent(this.background.contentWindow.document,"mousemove",f.mouseMove)}f.mouseUp=function(a){f.resizeEnd(a)};Xinha._addEvent(document,"mouseup",f.mouseUp);if(Xinha.is_ie){Xinha._addEvent(this.background.contentWindow.document,"mouseup",f.mouseUp)}};Xinha.Dialog.prototype.resizeIt=function(g){var h=this;if(!h.resizing){return false}var f,j;if(h.rootElem.style.position=="absolute"){f=g.clientY+h.scrollPos.y;j=g.clientX+h.scrollPos.x}else{f=g.clientY;j=g.clientX}j-=h.xOffs;f-=h.yOffs;var i={};i.width=((j>10)?j:10)+8+"px";i.height=((f>10)?f:10)+"px";h.sizeDialog(i);h.width=h.rootElem.offsetWidth;h.height=h.rootElem.offsetHeight;h.onresize()};Xinha.Dialog.prototype.resizeEnd=function(c){var d=this;d.resizing=false;if(!this.modal){this.editor.suspendUpdateToolbar=false}Xinha._removeEvent(document,"mousemove",d.mouseMove);if(Xinha.is_ie){Xinha._removeEvent(this.background.contentWindow.document,"mouseup",d.mouseUp)}Xinha._removeEvent(document,"mouseup",d.mouseUp);if(Xinha.is_ie){Xinha._removeEvent(this.background.contentWindow.document,"mouseup",d.mouseUp)}d.size.width=d.rootElem.offsetWidth;d.size.height=d.rootElem.offsetHeight;if(!this.modal){this.sizeBgToDialog()}};Xinha.Dialog.prototype.attachToPanel=function(f){var g=this;var e=this.rootElem;var h=this.editor;this.attached=true;this.rootElem.side=f;this.captionBar.ondblclick=function(a){g.detachFromPanel(Xinha.getEvent(a))};e.style.position="static";e.parentNode.removeChild(e);this.background.style.display="none";this.captionBar.style.paddingLeft="3px";this.resizer.style.display="none";if(this.closable){this.closer.style.display="none"}this.icon.style.display="none";if(f=="left"||f=="right"){e.style.width=h.config.panel_dimensions[f]}else{e.style.width=""}Xinha.addClasses(e,"panel");h._panels[f].panels.push(e);h._panels[f].div.appendChild(e);h.notifyOf("panel_change",{action:"add",panel:e})};Xinha.Dialog.prototype.detachFromPanel=function(){var h=this;var g=h.rootElem;var f=g.style;var i=h.editor;h.attached=false;var j=Xinha.getElementTopLeft(g);f.position="absolute";f.top=j.top+"px";f.left=j.left+"px";h.resizer.style.display="";if(h.closable){h.closer.style.display=""}h.icon.style.display="";if(h.size.width){g.style.width=h.size.width+"px"}Xinha.removeClasses(g,"panel");i.removePanel(g);document.body.appendChild(g);h.captionBar.ondblclick=function(){h.attachToPanel(g.side)};this.background.style.display="";this.sizeBgToDialog()};Xinha.Dialog.calcFullBgSize=function(){var c=Xinha.pageSize();var d=Xinha.viewportSize();return{width:(c.x>d.x?c.x:d.x)+"px",height:(c.x>d.y?c.y:d.y)+"px"}};Xinha.Dialog.prototype.sizeBgToDialog=function(){var c=this.rootElem.style;var d=this.background.style;d.top=c.top;d.left=c.left;d.width=c.width;d.height=c.height};Xinha.Dialog.prototype.hideBackground=function(){Xinha.Dialog.fadeOut(this.background)};Xinha.Dialog.prototype.showBackground=function(){Xinha.Dialog.fadeIn(this.background,70)};Xinha.Dialog.prototype.posBackground=function(b){if(this.background.style.display!="none"){this.background.style.top=b.top;this.background.style.left=b.left}};Xinha.Dialog.prototype.resizeBackground=function(b){if(this.background.style.display!="none"){this.background.style.width=b.width;this.background.style.height=b.height}};Xinha.Dialog.prototype.posDialog=function(c){var d=this.rootElem.style;d.left=c.left;d.top=c.top};Xinha.Dialog.prototype.sizeDialog=function(g){var h=this.rootElem.style;h.height=g.height;h.width=g.width;var f=parseInt(g.width,10);var e=parseInt(g.height,10)-this.captionBar.offsetHeight;this.main.style.height=(e>20)?e:20+"px";this.main.style.width=(f>10)?f:10+"px"};Xinha.Dialog.prototype.setValues=function(n){for(var e in n){if(typeof e=="string"){var j=this.getElementsByName(e);if(!j){continue}for(var l=0;l<j.length;l++){var m=j[l];switch(m.tagName.toLowerCase()){case"select":for(var i=0;i<m.options.length;i++){if(typeof n[e]=="object"){for(var k=0;k<n[e].length;k++){if(n[e][k]==m.options[i].value){m.options[i].selected=true}}}else{if(n[e]==m.options[i].value){m.options[i].selected=true}}}break;case"textarea":case"input":switch(m.getAttribute("type")){case"radio":if(m.value==n[e]){m.checked=true}break;case"checkbox":if(typeof n[e]=="object"){for(i in n[e]){if(n[e][i]==m.value){m.checked=true}}}else{if(n[e]==m.value){m.checked=true}}break;default:m.value=n[e];break}}}}}};Xinha.Dialog.prototype.getValues=function(){var l=[];var k=Xinha.collectionToArray(this.rootElem.getElementsByTagName("input")).append(Xinha.collectionToArray(this.rootElem.getElementsByTagName("textarea"))).append(Xinha.collectionToArray(this.rootElem.getElementsByTagName("select")));for(var j=0;j<k.length;j++){var g=k[j];if(!(g.name&&this.r_id[g.name])){continue}if(typeof l[this.r_id[g.name]]=="undefined"){l[this.r_id[g.name]]=null}var i=l[this.r_id[g.name]];switch(g.tagName.toLowerCase()){case"select":if(g.multiple){if(!i.push){if(i!==null){i=[i]}else{i=[]}}for(var h=0;h<g.options.length;h++){if(g.options[h].selected){i.push(g.options[h].value)}}}else{if(g.selectedIndex>=0){i=g.options[g.selectedIndex]}}break;default:switch(g.type.toLowerCase()){case"radio":if(g.checked){i=g.value}break;case"checkbox":if(i===null){if(this.getElementsByName(this.r_id[g.name]).length>1){i=[]}}if(g.checked){if(i!==null&&typeof i=="object"&&i.push){i.push(g.value)}else{i=g.value}}break;default:i=g.value;break}}l[this.r_id[g.name]]=i}return l};Xinha.Dialog.prototype.setLocalizer=function(c){var d=this;if(typeof c=="function"){d._lc=c}else{if(c){this._lc=function(a){return Xinha._lc(a,c)}}else{this._lc=function(a){return a}}}};Xinha.Dialog.prototype.translateHtml=function(f,e){var d=this;if(e){this.setLocalizer(e)}f=f.replace(/((?:name)|(?:id))=(['"])\[([a-z0-9_]+)\]\2/ig,function(a,h,b,c){return h+"="+b+d.createId(c)+b}).replace(/<l10n>(.*?)<\/l10n>/ig,function(b,a){return d._lc(a)}).replace(/\="_\((.*?)\)"/g,function(b,a){return'="'+d._lc(a)+'"'});return f};Xinha.Dialog.prototype.fixupDOM=function(q,m){var n=this;if(typeof m!="string"){m="GenericPlugin"}var s=function(a,b){switch(b){case"editor":return _editor_url;case"plugin":return Xinha.getPluginDir(m);case"images":return n.editor.imgURL("images")}};var o=Xinha.collectionToArray(q.getElementsByTagName("img"));for(var t=0;t<o.length;++t){var l=o[t];var u=l.getAttribute("src");if(u){var v=u.replace(/^\[(editor|plugin|images)\]/,s);if(v!=u){l.setAttribute("src",v)}}}var p=Xinha.collectionToArray(q.getElementsByTagName("a"));for(var t=0;t<p.length;++t){var r=p[t];var u=r.getAttribute("href");if(u){var v=u.replace(/^\[(editor|plugin|images)\]/,s);if(v!=u){r.setAttribute("href",v)}}}};Xinha.Dialog.prototype.createId=function(c){var d=this;if(typeof d.id[c]=="undefined"){d.id[c]=Xinha.uniq("Dialog");d.r_id[d.id[c]]=c}return d.id[c]};Xinha.Dialog.activateModeless=function(b){if(Xinha.Dialog.activeModeless==b||b.attached){return}if(Xinha.Dialog.activeModeless){Xinha.Dialog.activeModeless.rootElem.style.zIndex=parseInt(Xinha.Dialog.activeModeless.rootElem.style.zIndex,10)-10}Xinha.Dialog.activeModeless=b;Xinha.Dialog.activeModeless.rootElem.style.zIndex=parseInt(Xinha.Dialog.activeModeless.rootElem.style.zIndex,10)+10};Xinha.Dialog.setOpacity=function(d,c){if(typeof d.style.filter!="undefined"){d.style.filter=(c<100)?"alpha(opacity="+c+")":""}else{d.style.opacity=c/100}};Xinha.Dialog.fadeIn=function(h,i,l,j,g){j=j||1;g=g||25;i=i||100;h.op=h.op||0;var k=h.op;if(h.style.display=="none"){Xinha.Dialog.setOpacity(h,0);h.style.display=""}if(k<i){h.op+=g;Xinha.Dialog.setOpacity(h,k);h.timeOut=setTimeout(function(){Xinha.Dialog.fadeIn(h,i,l,j,g)},j)}else{Xinha.Dialog.setOpacity(h,i);h.op=i;h.timeOut=null;if(typeof l=="function"){l.call()}}};Xinha.Dialog.fadeOut=function(g,h,f){h=h||1;f=f||30;if(typeof g.op=="undefined"){g.op=100}var e=g.op;if(e>=0){g.op-=f;Xinha.Dialog.setOpacity(g,e);g.timeOut=setTimeout(function(){Xinha.Dialog.fadeOut(g,h,f)},h)}else{Xinha.Dialog.setOpacity(g,0);g.style.display="none";g.op=0;g.timeOut=null}};