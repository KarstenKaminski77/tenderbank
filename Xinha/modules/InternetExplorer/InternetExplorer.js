/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
InternetExplorer._pluginInfo={name:"Internet Explorer",origin:"Xinha Core",version:"$LastChangedRevision: 1260 $".replace(/^[^:]*:\s*(.*)\s*\$$/,"$1"),developer:"The Xinha Core Developer Team",developer_url:"$HeadURL: http://svn.xinha.org/trunk/modules/InternetExplorer/InternetExplorer.js $".replace(/^[^:]*:\s*(.*)\s*\$$/,"$1"),sponsor:"",sponsor_url:"",license:"htmlArea"};function InternetExplorer(b){this.editor=b;b.InternetExplorer=this}InternetExplorer.prototype.onKeyPress=function(b){if(this.editor.isShortCut(b)){switch(this.editor.getKey(b).toLowerCase()){case"n":this.editor.execCommand("formatblock",false,"<p>");Xinha._stopEvent(b);return true;break;case"1":case"2":case"3":case"4":case"5":case"6":this.editor.execCommand("formatblock",false,"<h"+this.editor.getKey(b).toLowerCase()+">");Xinha._stopEvent(b);return true;break}}switch(b.keyCode){case 8:case 46:if(this.handleBackspace()){Xinha._stopEvent(b);return true}break;case 9:Xinha._stopEvent(b);return true}return false};InternetExplorer.prototype.handleBackspace=function(){var j=this.editor;var i=j.getSelection();if(i.type=="Control"){var h=j.activeElement(i);Xinha.removeFromParent(h);return true}var k=j.createRange(i);var l=k.duplicate();l.moveStart("character",-1);var a=l.parentElement();if(a!=k.parentElement()&&(/^a$/i.test(a.tagName))){l.collapse(true);l.moveEnd("character",1);l.pasteHTML("");l.select();return true}};InternetExplorer.prototype.inwardHtml=function(b){b=b.replace(/<(\/?)del(\s|>|\/)/ig,"<$1strike$2");b=b.replace(/(<script|<!--)/i,"&nbsp;$1");b=b.replace(/<span[^>]+id="__InsertSpan_Workaround_[a-z]+".*?>([\s\S]*?)<\/span>/i,"$1");return b};InternetExplorer.prototype.outwardHtml=function(b){b=b.replace(/&nbsp;(\s*)(<script|<!--)/i,"$1$2");b=b.replace(/<span[^>]+id="__InsertSpan_Workaround_[a-z]+".*?>([\s\S]*?)<\/span>/i,"$1");return b};InternetExplorer.prototype.onExecCommand=function(t,y,w){switch(t){case"saveas":var A=null;var z=this.editor;var u=document.createElement("iframe");u.src="about:blank";u.style.display="none";document.body.appendChild(u);try{if(u.contentDocument){A=u.contentDocument}else{A=u.contentWindow.document}}catch(C){}A.open("text/html","replace");var q="";if(z.config.browserQuirksMode===false){var v='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">'}else{if(z.config.browserQuirksMode===true){var v=""}else{var v=Xinha.getDoctype(document)}}if(!z.config.fullPage){q+=v+"\n";q+="<html>\n";q+="<head>\n";q+='<meta http-equiv="Content-Type" content="text/html; charset='+z.config.charSet+'">\n';if(typeof z.config.baseHref!="undefined"&&z.config.baseHref!==null){q+='<base href="'+z.config.baseHref+'"/>\n'}if(typeof z.config.pageStyleSheets!=="undefined"){for(var r=0;r<z.config.pageStyleSheets.length;r++){if(z.config.pageStyleSheets[r].length>0){q+='<link rel="stylesheet" type="text/css" href="'+z.config.pageStyleSheets[r]+'">'}}}if(z.config.pageStyle){q+='<style type="text/css">\n'+z.config.pageStyle+"\n</style>"}q+="</head>\n";q+="<body>\n";q+=z.getEditorContent();q+="</body>\n";q+="</html>"}else{q=z.getEditorContent();if(q.match(Xinha.RE_doctype)){z.setDoctype(RegExp.$1)}}A.write(q);A.close();A.execCommand(t,y,w);document.body.removeChild(u);return true;break;case"removeformat":var z=this.editor;var B=z.getSelection();var x=z.saveSelection(B);var r,D,s;function i(a){if(a.nodeType!=1){return}a.removeAttribute("style");for(var b=0;b<a.childNodes.length;b++){i(a.childNodes[b])}if((a.tagName.toLowerCase()=="span"&&!a.attributes.length)||a.tagName.toLowerCase()=="font"){a.outerHTML=a.innerHTML}}if(z.selectionEmpty(B)){s=z._doc.body.childNodes;for(r=0;r<s.length;r++){D=s[r];if(D.nodeType!=1){continue}if(D.tagName.toLowerCase()=="span"){newNode=z.convertNode(D,"div");D.parentNode.replaceChild(newNode,D);D=newNode}i(D)}}z._doc.execCommand(t,y,w);z.restoreSelection(x);return true;break}return false};Xinha.prototype.insertNodeAtSelection=function(b){this.insertHTML(b.outerHTML)};Xinha.prototype.getParentElement=function(e){if(typeof e=="undefined"){e=this.getSelection()}var h=this.createRange(e);switch(e.type){case"Text":var i=h.parentElement();while(true){var g=h.duplicate();g.moveToElementText(i);if(g.inRange(h)){break}if((i.nodeType!=1)||(i.tagName.toLowerCase()=="body")){break}i=i.parentElement}return i;case"None":try{return h.parentElement()}catch(j){return this._doc.body}case"Control":return h.item(0);default:return this._doc.body}};Xinha.prototype.activeElement=function(e){if((e===null)||this.selectionEmpty(e)){return null}if(e.type.toLowerCase()=="control"){return e.createRange().item(0)}else{var f=e.createRange();var d=this.getParentElement(e);if(d.innerHTML==f.htmlText){return d}return null}};Xinha.prototype.selectionEmpty=function(b){if(!b){return true}return this.createRange(b).htmlText===""};Xinha.prototype.saveSelection=function(b){return this.createRange(b?b:this.getSelection())};Xinha.prototype.restoreSelection=function(e){if(!e){return}var q=null;if(e.parentElement){q=e.parentElement()}else{q=e.item(0)}var t=this.createRange(this.getSelection());var x=null;if(t.parentElement){x=t.parentElement()}else{x=t.item(0)}var v=function(a){for(var b=a;b;b=b.parentNode){if(b.tagName.toLowerCase()=="html"){return b.parentNode}}return null};if(e.parentElement&&v(q)==v(x)){if(t.isEqual(e)){return}}try{e.select()}catch(s){}t=this.createRange(this.getSelection());if(t.parentElement){x=t.parentElement()}else{x=t.item(0)}if(x!=q){var r=this.config.selectWorkaround||"VisibleCue";switch(r){case"SimulateClick":case"InsertSpan":var o=v(q);var z=function(a){var c="";for(var b=0;b<26;++b){c+=String.fromCharCode("a".charCodeAt(0)+b)}var d="";for(var b=0;b<a;++b){d+=c.substr(Math.floor(Math.random()*c.length+1),1)}return d};var w=1;var p="__InsertSpan_Workaround_"+z(w);while(o.getElementById(p)){w+=1;p="__InsertSpan_Workaround_"+z(w)}e.pasteHTML('<span id="'+p+'"></span>');var y=o.getElementById(p);e.moveToElementText(y);e.select();break;case"JustificationHack":var u=String.fromCharCode(1);e.pasteHTML(u);e.findText(u,-1);e.select();e.execCommand("JustifyNone");e.pasteHTML("");break;case"VisibleCue":default:var u=String.fromCharCode(1);e.pasteHTML(u);e.findText(u,-1);e.select()}}};Xinha.prototype.selectNodeContents=function(h,l){this.focusEditor();this.forceRedraw();var k;var m=typeof l=="undefined"?true:false;if(m&&h.tagName&&h.tagName.toLowerCase().match(/table|img|input|select|textarea/)){k=this._doc.body.createControlRange();k.add(h)}else{k=this._doc.body.createTextRange();if(3==h.nodeType){if(h.parentNode){k.moveToElementText(h.parentNode)}else{k.moveToElementText(this._doc.body)}var n=this._doc.body.createTextRange();var i=0;var j=h.previousSibling;for(;j&&(1!=j.nodeType);j=j.previousSibling){if(3==j.nodeType){i+=j.nodeValue.length-j.nodeValue.split("\r").length-1}}if(j&&(1==j.nodeType)){n.moveToElementText(j);k.setEndPoint("StartToEnd",n)}if(i){k.moveStart("character",i)}i=0;j=h.nextSibling;for(;j&&(1!=j.nodeType);j=j.nextSibling){if(3==j.nodeType){i+=j.nodeValue.length-j.nodeValue.split("\r").length-1;if(!j.nextSibling){i+=1}}}if(j&&(1==j.nodeType)){n.moveToElementText(j);k.setEndPoint("EndToStart",n)}if(i){k.moveEnd("character",-i)}if(!h.nextSibling){k.moveEnd("character",-1)}}else{k.moveToElementText(h)}}if(typeof l!="undefined"){k.collapse(l);if(!l){k.moveStart("character",-1);k.moveEnd("character",-1)}}k.select()};Xinha.prototype.insertHTML=function(f){this.focusEditor();var e=this.getSelection();var d=this.createRange(e);d.pasteHTML(f)};Xinha.prototype.getSelectedHTML=function(){var c=this.getSelection();if(this.selectionEmpty(c)){return""}var d=this.createRange(c);if(d.htmlText){return d.htmlText}else{if(d.length>=1){return d.item(0).outerHTML}}return""};Xinha.prototype.getSelection=function(){return this._doc.selection};Xinha.prototype.createRange=function(b){if(!b){b=this.getSelection()}return b.createRange()};Xinha.prototype.isKeyEvent=function(b){return b.type=="keydown"};Xinha.prototype.getKey=function(b){return String.fromCharCode(b.keyCode)};Xinha.getOuterHTML=function(b){return b.outerHTML};Xinha.cc=String.fromCharCode(8201);Xinha.prototype.setCC=function(l){var u=Xinha.cc;if(l=="textarea"){var s=this._textArea;var q=document.selection.createRange();q.collapse();q.text=u;var r=s.value.indexOf(u);var p=s.value.substring(0,r);var m=s.value.substring(r+u.length,s.value.length);if(m.match(/^[^<]*>/)){var n=m.indexOf(">")+1;s.value=p+m.substring(0,n)+u+m.substring(n,m.length)}else{s.value=p+u+m}s.value=s.value.replace(new RegExp("(&[^"+u+"]*?)("+u+")([^"+u+"]*?;)"),"$1$3$2");s.value=s.value.replace(new RegExp("(<script[^>]*>[^"+u+"]*?)("+u+")([^"+u+"]*?<\/script>)"),"$1$3$2");s.value=s.value.replace(new RegExp("^([^"+u+"]*)("+u+")([^"+u+"]*<body[^>]*>)(.*?)"),"$1$3$2$4")}else{var v=this.getSelection();var o=v.createRange();if(v.type=="Control"){var t=o.item(0);t.outerHTML+=u}else{o.collapse();o.text=u}}};Xinha.prototype.findCC=function(c){var d=(c=="textarea")?this._textArea:this._doc.body;range=d.createTextRange();if(range.findText(escape(Xinha.cc))){range.select();range.text="";range.select()}if(range.findText(Xinha.cc)){range.select();range.text="";range.select()}if(c=="textarea"){this._textArea.focus()}};Xinha.getDoctype=function(b){return(b.compatMode=="CSS1Compat"&&Xinha.ie_version<8)?'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">':""};